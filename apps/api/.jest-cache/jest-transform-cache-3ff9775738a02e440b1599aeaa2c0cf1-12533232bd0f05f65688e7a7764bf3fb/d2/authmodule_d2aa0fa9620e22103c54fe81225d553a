7258698136dc5a7723ebfe84b8830870
"use strict";
// src/modules/auth/auth.module.ts
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthModule = void 0;
const common_1 = require("@nestjs/common");
const config_1 = require("@nestjs/config");
const jwt_1 = require("@nestjs/jwt");
const passport_1 = require("@nestjs/passport");
const users_1 = require("../users");
const auth_controller_1 = require("./auth.controller");
const auth_service_1 = require("./auth.service");
const jwt_auth_guard_1 = require("./guards/jwt-auth.guard");
const roles_guard_1 = require("./guards/roles.guard");
const jwt_strategy_1 = require("./strategies/jwt.strategy");
/**
 * AuthModule - Alles rund um Authentication
 *
 * IMPORTS:
 * - PassportModule:  Basis für Authentication Strategies
 * - JwtModule:  JWT Token Handling (Sign/Verify)
 * - UsersModule: Zugriff auf UsersService
 *
 * PROVIDERS:
 * - AuthService:  Business Logic
 * - JwtStrategy: Token Validierung
 * - Guards: JwtAuthGuard, RolesGuard
 *
 * EXPORTS:
 * - Guards und Service für Verwendung in anderen Modulen
 */
let AuthModule = class AuthModule {
};
exports.AuthModule = AuthModule;
exports.AuthModule = AuthModule = __decorate([
    (0, common_1.Module)({
        imports: [
            // Passport.js Basis-Modul
            passport_1.PassportModule.register({
                defaultStrategy: 'jwt',
            }),
            // JWT Modul mit async Konfiguration (braucht ConfigService)
            jwt_1.JwtModule.registerAsync({
                imports: [config_1.ConfigModule],
                inject: [config_1.ConfigService],
                useFactory: (configService) => {
                    const expiresIn = (configService.get('JWT_EXPIRES_IN') ||
                        '900s');
                    return {
                        secret: configService.get('JWT_SECRET'),
                        signOptions: {
                            expiresIn,
                            algorithm: 'HS256',
                        },
                    };
                },
            }),
            // UsersModule für Zugriff auf UsersService
            users_1.UsersModule,
        ],
        controllers: [auth_controller_1.AuthController],
        providers: [auth_service_1.AuthService, jwt_strategy_1.JwtStrategy, jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard],
        exports: [
            // Andere Module können diese nutzen
            auth_service_1.AuthService,
            jwt_auth_guard_1.JwtAuthGuard,
            roles_guard_1.RolesGuard,
        ],
    })
], AuthModule);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aW11clxcUHJvZ3JhbW1pbmdcXFByb2plY3RzXFxzbmlwcGV0Zm9yZ2VcXGFwcHNcXGFwaVxcc3JjXFxtb2R1bGVzXFxhdXRoXFxhdXRoLm1vZHVsZS50cyIsIm1hcHBpbmdzIjoiO0FBQUEsa0NBQWtDOzs7Ozs7Ozs7QUFFbEMsMkNBQXdDO0FBQ3hDLDJDQUE2RDtBQUM3RCxxQ0FBd0M7QUFDeEMsK0NBQWtEO0FBRWxELG9DQUF1QztBQUN2Qyx1REFBbUQ7QUFDbkQsaURBQTZDO0FBQzdDLDREQUF1RDtBQUN2RCxzREFBa0Q7QUFDbEQsNERBQXdEO0FBRXhEOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQXFDSSxJQUFNLFVBQVUsR0FBaEIsTUFBTSxVQUFVO0NBQUcsQ0FBQTtBQUFiLGdDQUFVO3FCQUFWLFVBQVU7SUFwQ3RCLElBQUEsZUFBTSxFQUFDO1FBQ04sT0FBTyxFQUFFO1lBQ1AsMEJBQTBCO1lBQzFCLHlCQUFjLENBQUMsUUFBUSxDQUFDO2dCQUN0QixlQUFlLEVBQUUsS0FBSzthQUN2QixDQUFDO1lBRUYsNERBQTREO1lBQzVELGVBQVMsQ0FBQyxhQUFhLENBQUM7Z0JBQ3RCLE9BQU8sRUFBRSxDQUFDLHFCQUFZLENBQUM7Z0JBQ3ZCLE1BQU0sRUFBRSxDQUFDLHNCQUFhLENBQUM7Z0JBQ3ZCLFVBQVUsRUFBRSxDQUFDLGFBQTRCLEVBQUUsRUFBRTtvQkFDM0MsTUFBTSxTQUFTLEdBQUcsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFTLGdCQUFnQixDQUFDO3dCQUM1RCxNQUFNLENBQWdCLENBQUM7b0JBQ3pCLE9BQU87d0JBQ0wsTUFBTSxFQUFFLGFBQWEsQ0FBQyxHQUFHLENBQVMsWUFBWSxDQUFDO3dCQUMvQyxXQUFXLEVBQUU7NEJBQ1gsU0FBUzs0QkFDVCxTQUFTLEVBQUUsT0FBZ0I7eUJBQzVCO3FCQUNGLENBQUM7Z0JBQ0osQ0FBQzthQUNGLENBQUM7WUFFRiwyQ0FBMkM7WUFDM0MsbUJBQVc7U0FDWjtRQUNELFdBQVcsRUFBRSxDQUFDLGdDQUFjLENBQUM7UUFDN0IsU0FBUyxFQUFFLENBQUMsMEJBQVcsRUFBRSwwQkFBVyxFQUFFLDZCQUFZLEVBQUUsd0JBQVUsQ0FBQztRQUMvRCxPQUFPLEVBQUU7WUFDUCxvQ0FBb0M7WUFDcEMsMEJBQVc7WUFDWCw2QkFBWTtZQUNaLHdCQUFVO1NBQ1g7S0FDRixDQUFDO0dBQ1csVUFBVSxDQUFHIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGltdXJcXFByb2dyYW1taW5nXFxQcm9qZWN0c1xcc25pcHBldGZvcmdlXFxhcHBzXFxhcGlcXHNyY1xcbW9kdWxlc1xcYXV0aFxcYXV0aC5tb2R1bGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL21vZHVsZXMvYXV0aC9hdXRoLm1vZHVsZS50c1xyXG5cclxuaW1wb3J0IHsgTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5pbXBvcnQgeyBDb25maWdNb2R1bGUsIENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XHJcbmltcG9ydCB7IEp3dE1vZHVsZSB9IGZyb20gJ0BuZXN0anMvand0JztcclxuaW1wb3J0IHsgUGFzc3BvcnRNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Bhc3Nwb3J0JztcclxuaW1wb3J0IHR5cGUgeyBTdHJpbmdWYWx1ZSB9IGZyb20gJ21zJztcclxuaW1wb3J0IHsgVXNlcnNNb2R1bGUgfSBmcm9tICcuLi91c2Vycyc7XHJcbmltcG9ydCB7IEF1dGhDb250cm9sbGVyIH0gZnJvbSAnLi9hdXRoLmNvbnRyb2xsZXInO1xyXG5pbXBvcnQgeyBBdXRoU2VydmljZSB9IGZyb20gJy4vYXV0aC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSnd0QXV0aEd1YXJkIH0gZnJvbSAnLi9ndWFyZHMvand0LWF1dGguZ3VhcmQnO1xyXG5pbXBvcnQgeyBSb2xlc0d1YXJkIH0gZnJvbSAnLi9ndWFyZHMvcm9sZXMuZ3VhcmQnO1xyXG5pbXBvcnQgeyBKd3RTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9qd3Quc3RyYXRlZ3knO1xyXG5cclxuLyoqXHJcbiAqIEF1dGhNb2R1bGUgLSBBbGxlcyBydW5kIHVtIEF1dGhlbnRpY2F0aW9uXHJcbiAqXHJcbiAqIElNUE9SVFM6XHJcbiAqIC0gUGFzc3BvcnRNb2R1bGU6ICBCYXNpcyBmw7xyIEF1dGhlbnRpY2F0aW9uIFN0cmF0ZWdpZXNcclxuICogLSBKd3RNb2R1bGU6ICBKV1QgVG9rZW4gSGFuZGxpbmcgKFNpZ24vVmVyaWZ5KVxyXG4gKiAtIFVzZXJzTW9kdWxlOiBadWdyaWZmIGF1ZiBVc2Vyc1NlcnZpY2VcclxuICpcclxuICogUFJPVklERVJTOlxyXG4gKiAtIEF1dGhTZXJ2aWNlOiAgQnVzaW5lc3MgTG9naWNcclxuICogLSBKd3RTdHJhdGVneTogVG9rZW4gVmFsaWRpZXJ1bmdcclxuICogLSBHdWFyZHM6IEp3dEF1dGhHdWFyZCwgUm9sZXNHdWFyZFxyXG4gKlxyXG4gKiBFWFBPUlRTOlxyXG4gKiAtIEd1YXJkcyB1bmQgU2VydmljZSBmw7xyIFZlcndlbmR1bmcgaW4gYW5kZXJlbiBNb2R1bGVuXHJcbiAqL1xyXG5ATW9kdWxlKHtcclxuICBpbXBvcnRzOiBbXHJcbiAgICAvLyBQYXNzcG9ydC5qcyBCYXNpcy1Nb2R1bFxyXG4gICAgUGFzc3BvcnRNb2R1bGUucmVnaXN0ZXIoe1xyXG4gICAgICBkZWZhdWx0U3RyYXRlZ3k6ICdqd3QnLFxyXG4gICAgfSksXHJcblxyXG4gICAgLy8gSldUIE1vZHVsIG1pdCBhc3luYyBLb25maWd1cmF0aW9uIChicmF1Y2h0IENvbmZpZ1NlcnZpY2UpXHJcbiAgICBKd3RNb2R1bGUucmVnaXN0ZXJBc3luYyh7XHJcbiAgICAgIGltcG9ydHM6IFtDb25maWdNb2R1bGVdLFxyXG4gICAgICBpbmplY3Q6IFtDb25maWdTZXJ2aWNlXSxcclxuICAgICAgdXNlRmFjdG9yeTogKGNvbmZpZ1NlcnZpY2U6IENvbmZpZ1NlcnZpY2UpID0+IHtcclxuICAgICAgICBjb25zdCBleHBpcmVzSW4gPSAoY29uZmlnU2VydmljZS5nZXQ8c3RyaW5nPignSldUX0VYUElSRVNfSU4nKSB8fFxyXG4gICAgICAgICAgJzkwMHMnKSBhcyBTdHJpbmdWYWx1ZTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc2VjcmV0OiBjb25maWdTZXJ2aWNlLmdldDxzdHJpbmc+KCdKV1RfU0VDUkVUJyksXHJcbiAgICAgICAgICBzaWduT3B0aW9uczoge1xyXG4gICAgICAgICAgICBleHBpcmVzSW4sXHJcbiAgICAgICAgICAgIGFsZ29yaXRobTogJ0hTMjU2JyBhcyBjb25zdCxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfTtcclxuICAgICAgfSxcclxuICAgIH0pLFxyXG5cclxuICAgIC8vIFVzZXJzTW9kdWxlIGbDvHIgWnVncmlmZiBhdWYgVXNlcnNTZXJ2aWNlXHJcbiAgICBVc2Vyc01vZHVsZSxcclxuICBdLFxyXG4gIGNvbnRyb2xsZXJzOiBbQXV0aENvbnRyb2xsZXJdLFxyXG4gIHByb3ZpZGVyczogW0F1dGhTZXJ2aWNlLCBKd3RTdHJhdGVneSwgSnd0QXV0aEd1YXJkLCBSb2xlc0d1YXJkXSxcclxuICBleHBvcnRzOiBbXHJcbiAgICAvLyBBbmRlcmUgTW9kdWxlIGvDtm5uZW4gZGllc2UgbnV0emVuXHJcbiAgICBBdXRoU2VydmljZSxcclxuICAgIEp3dEF1dGhHdWFyZCxcclxuICAgIFJvbGVzR3VhcmQsXHJcbiAgXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIEF1dGhNb2R1bGUge31cclxuIl0sInZlcnNpb24iOjN9