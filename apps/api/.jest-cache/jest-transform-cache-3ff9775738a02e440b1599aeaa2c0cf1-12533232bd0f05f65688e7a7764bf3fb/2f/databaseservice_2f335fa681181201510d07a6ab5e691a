c9540c54d1012ed68706551dafc02f55
"use strict";
// src/shared/database/database. service.ts
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var DatabaseService_1;
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DatabaseService = void 0;
const common_1 = require("@nestjs/common");
const config_1 = require("@nestjs/config");
const postgres_js_1 = require("drizzle-orm/postgres-js");
const postgres_1 = __importDefault(require("postgres"));
const schema = __importStar(require("../../lib/db/schema"));
/**
 * DatabaseService - Zentrale Datenbankverbindung fÃ¼r die gesamte Anwendung
 *
 * Verantwortlichkeiten:
 * - Connection Pool Management
 * - Lifecycle (Connect on Start, Disconnect on Shutdown)
 * - Health Checks
 * - Drizzle Client Bereitstellung
 *
 * Warum als Service und nicht als Modul-Export?
 * - Dependency Injection ermÃ¶glicht einfaches Mocking in Tests
 * - Lifecycle Hooks fÃ¼r sauberes Cleanup
 * - Zentrale Konfiguration an einer Stelle
 */
let DatabaseService = DatabaseService_1 = class DatabaseService {
    configService;
    logger = new common_1.Logger(DatabaseService_1.name);
    client;
    _drizzle;
    constructor(configService) {
        this.configService = configService;
    }
    /**
     * Getter fÃ¼r den Drizzle Client
     * Wird von Repositories verwendet fÃ¼r Type-Safe Queries
     */
    get drizzle() {
        if (!this._drizzle) {
            throw new Error('Database not initialized.  Call onModuleInit first.');
        }
        return this._drizzle;
    }
    /**
     * Lifecycle Hook:  Wird automatisch beim App-Start aufgerufen
     * Etabliert Datenbankverbindung mit Connection Pool
     */
    async onModuleInit() {
        const databaseUrl = this.configService.get('DATABASE_URL');
        if (!databaseUrl) {
            this.logger.error('DATABASE_URL is not defined in environment variables');
            throw new Error('DATABASE_URL is required');
        }
        this.logger.log('ðŸ”Œ Initializing database connection...');
        try {
            // PostgreSQL Client mit Connection Pool
            // Warum diese Einstellungen?
            // - max:  10 = Maximal 10 gleichzeitige Verbindungen (verhindert DB-Ãœberlastung)
            // - idle_timeout: 20 = Ungenutzte Verbindungen nach 20s schlieÃŸen (Resource-Freigabe)
            // - connect_timeout: 10 = Max 10s warten auf Connection (Fail Fast)
            this.client = (0, postgres_1.default)(databaseUrl, {
                max: 10,
                idle_timeout: 20,
                connect_timeout: 10,
                // SSL fÃ¼r Production (auskommentiert fÃ¼r lokale Entwicklung)
                // ssl: process.env.NODE_ENV === 'production' ? 'require' : false,
            });
            // Drizzle ORM Wrapper
            // Schema wird mitgegeben fÃ¼r Type-Safe Queries
            this._drizzle = (0, postgres_js_1.drizzle)(this.client, {
                schema,
                logger: this.configService.get('NODE_ENV') === 'development',
            });
            // Connection Test
            await this.healthCheck();
            this.logger.log('âœ… Database connection established successfully');
        }
        catch (error) {
            this.logger.error('âŒ Failed to connect to database', error);
            throw error;
        }
    }
    /**
     * Lifecycle Hook: Wird automatisch beim App-Shutdown aufgerufen
     * SchlieÃŸt alle Datenbankverbindungen sauber
     */
    async onModuleDestroy() {
        this.logger.log('ðŸ”Œ Closing database connection...');
        if (this.client) {
            await this.client.end();
            this.logger.log('âœ… Database connection closed');
        }
    }
    /**
     * Health Check fÃ¼r Monitoring/Readiness Probes
     * Wird auch beim Startup verwendet um Connection zu verifizieren
     *
     * @returns true wenn DB erreichbar, wirft Error wenn nicht
     */
    async healthCheck() {
        try {
            // Simple Query um Connection zu testen
            await this.client `SELECT 1 as health_check`;
            return true;
        }
        catch (error) {
            this.logger.error('Database health check failed', error);
            throw new Error('Database is not reachable');
        }
    }
    /**
     * FÃ¼hrt Raw SQL aus (fÃ¼r komplexe Queries, Migrations)
     * ACHTUNG: Nur verwenden wenn Drizzle Query Builder nicht ausreicht
     *
     * @param sql - Raw SQL String
     * @returns Query Result
     */
    async executeRaw(sql) {
        return this.client.unsafe(sql);
    }
};
exports.DatabaseService = DatabaseService;
exports.DatabaseService = DatabaseService = DatabaseService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _a : Object])
], DatabaseService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aW11clxcUHJvZ3JhbW1pbmdcXFByb2plY3RzXFxzbmlwcGV0Zm9yZ2VcXGFwcHNcXGFwaVxcc3JjXFxzaGFyZWRcXGRhdGFiYXNlXFxkYXRhYmFzZS5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7QUFBQSwyQ0FBMkM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRTNDLDJDQUt3QjtBQUN4QiwyQ0FBK0M7QUFDL0MseURBQXNFO0FBQ3RFLHdEQUFnQztBQUNoQyw0REFBOEM7QUFFOUM7Ozs7Ozs7Ozs7Ozs7R0FhRztBQUVJLElBQU0sZUFBZSx1QkFBckIsTUFBTSxlQUFlO0lBS0c7SUFKWixNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsaUJBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuRCxNQUFNLENBQWU7SUFDckIsUUFBUSxDQUFvQztJQUVwRCxZQUE2QixhQUE0QjtRQUE1QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtJQUFHLENBQUM7SUFFN0Q7OztPQUdHO0lBQ0gsSUFBSSxPQUFPO1FBQ1QsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNuQixNQUFNLElBQUksS0FBSyxDQUFDLHFEQUFxRCxDQUFDLENBQUM7UUFDekUsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN2QixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLFlBQVk7UUFDaEIsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQVMsY0FBYyxDQUFDLENBQUM7UUFFbkUsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2pCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLHNEQUFzRCxDQUFDLENBQUM7WUFDMUUsTUFBTSxJQUFJLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1FBQzlDLENBQUM7UUFFRCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1FBRTFELElBQUksQ0FBQztZQUNILHdDQUF3QztZQUN4Qyw2QkFBNkI7WUFDN0IsaUZBQWlGO1lBQ2pGLHNGQUFzRjtZQUN0RixvRUFBb0U7WUFDcEUsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFBLGtCQUFRLEVBQUMsV0FBVyxFQUFFO2dCQUNsQyxHQUFHLEVBQUUsRUFBRTtnQkFDUCxZQUFZLEVBQUUsRUFBRTtnQkFDaEIsZUFBZSxFQUFFLEVBQUU7Z0JBQ25CLDZEQUE2RDtnQkFDN0Qsa0VBQWtFO2FBQ25FLENBQUMsQ0FBQztZQUVILHNCQUFzQjtZQUN0QiwrQ0FBK0M7WUFDL0MsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFBLHFCQUFPLEVBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtnQkFDbkMsTUFBTTtnQkFDTixNQUFNLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEtBQUssYUFBYTthQUM3RCxDQUFDLENBQUM7WUFFSCxrQkFBa0I7WUFDbEIsTUFBTSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDekIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsZ0RBQWdELENBQUMsQ0FBQztRQUNwRSxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLGlDQUFpQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQzVELE1BQU0sS0FBSyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsZUFBZTtRQUNuQixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO1FBRXJELElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2hCLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1FBQ2xELENBQUM7SUFDSCxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxLQUFLLENBQUMsV0FBVztRQUNmLElBQUksQ0FBQztZQUNILHVDQUF1QztZQUN2QyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUEsMEJBQTBCLENBQUM7WUFDNUMsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLDhCQUE4QixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3pELE1BQU0sSUFBSSxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQztRQUMvQyxDQUFDO0lBQ0gsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNILEtBQUssQ0FBQyxVQUFVLENBQUksR0FBVztRQUM3QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBaUIsQ0FBQztJQUNqRCxDQUFDO0NBQ0YsQ0FBQTtBQXRHWSwwQ0FBZTswQkFBZixlQUFlO0lBRDNCLElBQUEsbUJBQVUsR0FBRTt5REFNaUMsc0JBQWEsb0JBQWIsc0JBQWE7R0FMOUMsZUFBZSxDQXNHM0IiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aW11clxcUHJvZ3JhbW1pbmdcXFByb2plY3RzXFxzbmlwcGV0Zm9yZ2VcXGFwcHNcXGFwaVxcc3JjXFxzaGFyZWRcXGRhdGFiYXNlXFxkYXRhYmFzZS5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zaGFyZWQvZGF0YWJhc2UvZGF0YWJhc2UuIHNlcnZpY2UudHNcclxuXHJcbmltcG9ydCB7XHJcbiAgSW5qZWN0YWJsZSxcclxuICBMb2dnZXIsXHJcbiAgT25Nb2R1bGVEZXN0cm95LFxyXG4gIE9uTW9kdWxlSW5pdCxcclxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XHJcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XHJcbmltcG9ydCB7IGRyaXp6bGUsIFBvc3RncmVzSnNEYXRhYmFzZSB9IGZyb20gJ2RyaXp6bGUtb3JtL3Bvc3RncmVzLWpzJztcclxuaW1wb3J0IHBvc3RncmVzIGZyb20gJ3Bvc3RncmVzJztcclxuaW1wb3J0ICogYXMgc2NoZW1hIGZyb20gJy4uLy4uL2xpYi9kYi9zY2hlbWEnO1xyXG5cclxuLyoqXHJcbiAqIERhdGFiYXNlU2VydmljZSAtIFplbnRyYWxlIERhdGVuYmFua3ZlcmJpbmR1bmcgZsO8ciBkaWUgZ2VzYW10ZSBBbndlbmR1bmdcclxuICpcclxuICogVmVyYW50d29ydGxpY2hrZWl0ZW46XHJcbiAqIC0gQ29ubmVjdGlvbiBQb29sIE1hbmFnZW1lbnRcclxuICogLSBMaWZlY3ljbGUgKENvbm5lY3Qgb24gU3RhcnQsIERpc2Nvbm5lY3Qgb24gU2h1dGRvd24pXHJcbiAqIC0gSGVhbHRoIENoZWNrc1xyXG4gKiAtIERyaXp6bGUgQ2xpZW50IEJlcmVpdHN0ZWxsdW5nXHJcbiAqXHJcbiAqIFdhcnVtIGFscyBTZXJ2aWNlIHVuZCBuaWNodCBhbHMgTW9kdWwtRXhwb3J0P1xyXG4gKiAtIERlcGVuZGVuY3kgSW5qZWN0aW9uIGVybcO2Z2xpY2h0IGVpbmZhY2hlcyBNb2NraW5nIGluIFRlc3RzXHJcbiAqIC0gTGlmZWN5Y2xlIEhvb2tzIGbDvHIgc2F1YmVyZXMgQ2xlYW51cFxyXG4gKiAtIFplbnRyYWxlIEtvbmZpZ3VyYXRpb24gYW4gZWluZXIgU3RlbGxlXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEYXRhYmFzZVNlcnZpY2UgaW1wbGVtZW50cyBPbk1vZHVsZUluaXQsIE9uTW9kdWxlRGVzdHJveSB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKERhdGFiYXNlU2VydmljZS5uYW1lKTtcclxuICBwcml2YXRlIGNsaWVudDogcG9zdGdyZXMuU3FsO1xyXG4gIHByaXZhdGUgX2RyaXp6bGU6IFBvc3RncmVzSnNEYXRhYmFzZTx0eXBlb2Ygc2NoZW1hPjtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlKSB7fVxyXG5cclxuICAvKipcclxuICAgKiBHZXR0ZXIgZsO8ciBkZW4gRHJpenpsZSBDbGllbnRcclxuICAgKiBXaXJkIHZvbiBSZXBvc2l0b3JpZXMgdmVyd2VuZGV0IGbDvHIgVHlwZS1TYWZlIFF1ZXJpZXNcclxuICAgKi9cclxuICBnZXQgZHJpenpsZSgpOiBQb3N0Z3Jlc0pzRGF0YWJhc2U8dHlwZW9mIHNjaGVtYT4ge1xyXG4gICAgaWYgKCF0aGlzLl9kcml6emxlKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2Ugbm90IGluaXRpYWxpemVkLiAgQ2FsbCBvbk1vZHVsZUluaXQgZmlyc3QuJyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5fZHJpenpsZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExpZmVjeWNsZSBIb29rOiAgV2lyZCBhdXRvbWF0aXNjaCBiZWltIEFwcC1TdGFydCBhdWZnZXJ1ZmVuXHJcbiAgICogRXRhYmxpZXJ0IERhdGVuYmFua3ZlcmJpbmR1bmcgbWl0IENvbm5lY3Rpb24gUG9vbFxyXG4gICAqL1xyXG4gIGFzeW5jIG9uTW9kdWxlSW5pdCgpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IGRhdGFiYXNlVXJsID0gdGhpcy5jb25maWdTZXJ2aWNlLmdldDxzdHJpbmc+KCdEQVRBQkFTRV9VUkwnKTtcclxuXHJcbiAgICBpZiAoIWRhdGFiYXNlVXJsKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdEQVRBQkFTRV9VUkwgaXMgbm90IGRlZmluZWQgaW4gZW52aXJvbm1lbnQgdmFyaWFibGVzJyk7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignREFUQUJBU0VfVVJMIGlzIHJlcXVpcmVkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5sb2dnZXIubG9nKCfwn5SMIEluaXRpYWxpemluZyBkYXRhYmFzZSBjb25uZWN0aW9uLi4uJyk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gUG9zdGdyZVNRTCBDbGllbnQgbWl0IENvbm5lY3Rpb24gUG9vbFxyXG4gICAgICAvLyBXYXJ1bSBkaWVzZSBFaW5zdGVsbHVuZ2VuP1xyXG4gICAgICAvLyAtIG1heDogIDEwID0gTWF4aW1hbCAxMCBnbGVpY2h6ZWl0aWdlIFZlcmJpbmR1bmdlbiAodmVyaGluZGVydCBEQi3DnGJlcmxhc3R1bmcpXHJcbiAgICAgIC8vIC0gaWRsZV90aW1lb3V0OiAyMCA9IFVuZ2VudXR6dGUgVmVyYmluZHVuZ2VuIG5hY2ggMjBzIHNjaGxpZcOfZW4gKFJlc291cmNlLUZyZWlnYWJlKVxyXG4gICAgICAvLyAtIGNvbm5lY3RfdGltZW91dDogMTAgPSBNYXggMTBzIHdhcnRlbiBhdWYgQ29ubmVjdGlvbiAoRmFpbCBGYXN0KVxyXG4gICAgICB0aGlzLmNsaWVudCA9IHBvc3RncmVzKGRhdGFiYXNlVXJsLCB7XHJcbiAgICAgICAgbWF4OiAxMCxcclxuICAgICAgICBpZGxlX3RpbWVvdXQ6IDIwLFxyXG4gICAgICAgIGNvbm5lY3RfdGltZW91dDogMTAsXHJcbiAgICAgICAgLy8gU1NMIGbDvHIgUHJvZHVjdGlvbiAoYXVza29tbWVudGllcnQgZsO8ciBsb2thbGUgRW50d2lja2x1bmcpXHJcbiAgICAgICAgLy8gc3NsOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nID8gJ3JlcXVpcmUnIDogZmFsc2UsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gRHJpenpsZSBPUk0gV3JhcHBlclxyXG4gICAgICAvLyBTY2hlbWEgd2lyZCBtaXRnZWdlYmVuIGbDvHIgVHlwZS1TYWZlIFF1ZXJpZXNcclxuICAgICAgdGhpcy5fZHJpenpsZSA9IGRyaXp6bGUodGhpcy5jbGllbnQsIHtcclxuICAgICAgICBzY2hlbWEsXHJcbiAgICAgICAgbG9nZ2VyOiB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0KCdOT0RFX0VOVicpID09PSAnZGV2ZWxvcG1lbnQnLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIENvbm5lY3Rpb24gVGVzdFxyXG4gICAgICBhd2FpdCB0aGlzLmhlYWx0aENoZWNrKCk7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmxvZygn4pyFIERhdGFiYXNlIGNvbm5lY3Rpb24gZXN0YWJsaXNoZWQgc3VjY2Vzc2Z1bGx5Jyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcign4p2MIEZhaWxlZCB0byBjb25uZWN0IHRvIGRhdGFiYXNlJywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExpZmVjeWNsZSBIb29rOiBXaXJkIGF1dG9tYXRpc2NoIGJlaW0gQXBwLVNodXRkb3duIGF1ZmdlcnVmZW5cclxuICAgKiBTY2hsaWXDn3QgYWxsZSBEYXRlbmJhbmt2ZXJiaW5kdW5nZW4gc2F1YmVyXHJcbiAgICovXHJcbiAgYXN5bmMgb25Nb2R1bGVEZXN0cm95KCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdGhpcy5sb2dnZXIubG9nKCfwn5SMIENsb3NpbmcgZGF0YWJhc2UgY29ubmVjdGlvbi4uLicpO1xyXG5cclxuICAgIGlmICh0aGlzLmNsaWVudCkge1xyXG4gICAgICBhd2FpdCB0aGlzLmNsaWVudC5lbmQoKTtcclxuICAgICAgdGhpcy5sb2dnZXIubG9nKCfinIUgRGF0YWJhc2UgY29ubmVjdGlvbiBjbG9zZWQnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEhlYWx0aCBDaGVjayBmw7xyIE1vbml0b3JpbmcvUmVhZGluZXNzIFByb2Jlc1xyXG4gICAqIFdpcmQgYXVjaCBiZWltIFN0YXJ0dXAgdmVyd2VuZGV0IHVtIENvbm5lY3Rpb24genUgdmVyaWZpemllcmVuXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB0cnVlIHdlbm4gREIgZXJyZWljaGJhciwgd2lyZnQgRXJyb3Igd2VubiBuaWNodFxyXG4gICAqL1xyXG4gIGFzeW5jIGhlYWx0aENoZWNrKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gU2ltcGxlIFF1ZXJ5IHVtIENvbm5lY3Rpb24genUgdGVzdGVuXHJcbiAgICAgIGF3YWl0IHRoaXMuY2xpZW50YFNFTEVDVCAxIGFzIGhlYWx0aF9jaGVja2A7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0RhdGFiYXNlIGhlYWx0aCBjaGVjayBmYWlsZWQnLCBlcnJvcik7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgaXMgbm90IHJlYWNoYWJsZScpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRsO8aHJ0IFJhdyBTUUwgYXVzIChmw7xyIGtvbXBsZXhlIFF1ZXJpZXMsIE1pZ3JhdGlvbnMpXHJcbiAgICogQUNIVFVORzogTnVyIHZlcndlbmRlbiB3ZW5uIERyaXp6bGUgUXVlcnkgQnVpbGRlciBuaWNodCBhdXNyZWljaHRcclxuICAgKlxyXG4gICAqIEBwYXJhbSBzcWwgLSBSYXcgU1FMIFN0cmluZ1xyXG4gICAqIEByZXR1cm5zIFF1ZXJ5IFJlc3VsdFxyXG4gICAqL1xyXG4gIGFzeW5jIGV4ZWN1dGVSYXc8VD4oc3FsOiBzdHJpbmcpOiBQcm9taXNlPFRbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY2xpZW50LnVuc2FmZShzcWwpIGFzIFByb21pc2U8VFtdPjtcclxuICB9XHJcbn1cclxuIl0sInZlcnNpb24iOjN9