{"version":3,"names":["cov_1wht5lqyhd","actualCoverage","s","pg_core_1","require","exports","roleEnum","pgEnum","users","pgTable","id","uuid","primaryKey","defaultRandom","email","varchar","length","notNull","unique","username","passwordHash","bio","text","avatarUrl","role","default","createdAt","timestamp","withTimezone","defaultNow","updatedAt","table","f","emailIdx","index","on","usernameIdx","roleIdx","snippets","title","description","code","language","userId","references","onDelete","isPublic","boolean","viewCount","integer","$onUpdate","Date","userIdIdx","languageIdx","createdAtIdx","publicCreatedAtIdx"],"sources":["C:\\Users\\timur\\Programming\\Projects\\snippetforge\\apps\\api\\src\\lib\\db\\schema.ts"],"sourcesContent":["import {\r\n  boolean,\r\n  index,\r\n  integer,\r\n  pgEnum,\r\n  pgTable,\r\n  text,\r\n  timestamp,\r\n  uuid,\r\n  varchar,\r\n} from 'drizzle-orm/pg-core';\r\n\r\n// Role Enum\r\nexport const roleEnum = pgEnum('role', ['USER', 'ADMIN', 'MODERATOR']);\r\n\r\n// Users Table\r\nexport const users = pgTable(\r\n  'users',\r\n  {\r\n    id: uuid('id').primaryKey().defaultRandom(),\r\n    email: varchar('email', { length: 255 }).notNull().unique(),\r\n    username: varchar('username', { length: 30 }).notNull().unique(),\r\n    passwordHash: varchar('password_hash', { length: 60 }).notNull(),\r\n    bio: text('bio'),\r\n    avatarUrl: text('avatar_url'),\r\n    role: roleEnum('role').default('USER').notNull(),\r\n    createdAt: timestamp('created_at', { withTimezone: true })\r\n      .defaultNow()\r\n      .notNull(),\r\n    updatedAt: timestamp('updated_at', { withTimezone: true })\r\n      .defaultNow()\r\n      .notNull(),\r\n  },\r\n  (table) => ({\r\n    emailIdx: index('users_email_idx').on(table.email),\r\n    usernameIdx: index('users_username_idx').on(table.username),\r\n    roleIdx: index('users_role_idx').on(table.role),\r\n  }),\r\n);\r\n\r\n// Types\r\nexport type User = typeof users.$inferSelect;\r\nexport type NewUser = typeof users.$inferInsert;\r\n\r\n/**\r\n * Snippets Table - Code Snippets created by Users\r\n *\r\n * BUSINESS RULES:\r\n * - Each snippet belongs to a user (Foreign Key with CASCADE DELETE)\r\n * - Title is required, max 200 characters\r\n * - Code is required, max 50,000 characters\r\n * - Language is required (e.g. \"typescript\", \"python\")\r\n * - Description is optional\r\n * - isPublic defaults to true (Snippets are public by default)\r\n * - viewCount is automatically incremented\r\n *\r\n * PERFORMANCE:\r\n * - Index on userId (for \"my snippets\" queries)\r\n * - Index on language (for \"all TypeScript snippets\" queries)\r\n * - Index on createdAt (for sorting)\r\n * - Composite index on (isPublic, createdAt) for common query pattern\r\n *\r\n * SECURITY:\r\n * - CASCADE DELETE: When user is deleted, their snippets are also deleted\r\n */\r\nexport const snippets = pgTable(\r\n  'snippets',\r\n  {\r\n    // ========================================\r\n    // PRIMARY KEY\r\n    // ========================================\r\n\r\n    id: uuid('id').primaryKey().defaultRandom(),\r\n\r\n    // ========================================\r\n    // SNIPPET CONTENT\r\n    // ========================================\r\n\r\n    /**\r\n     * Snippet title\r\n     * Max 200 characters (for clarity)\r\n     */\r\n    title: varchar('title', { length: 200 }).notNull(),\r\n\r\n    /**\r\n     * Optional description\r\n     * Explains what the code does\r\n     */\r\n    description: text('description'),\r\n\r\n    /**\r\n     * The actual code\r\n     * Max 50,000 characters (prevents excessively large files)\r\n     */\r\n    code: text('code').notNull(),\r\n\r\n    /**\r\n     * Programming language\r\n     * Used for syntax highlighting\r\n     * Examples: \"typescript\", \"python\", \"javascript\", \"rust\"\r\n     */\r\n    language: varchar('language', { length: 50 }).notNull(),\r\n\r\n    // ========================================\r\n    // RELATIONSHIPS\r\n    // ========================================\r\n    /**\r\n     * Foreign Key to Users\r\n     * CASCADE DELETE: When user is deleted, their snippets are also deleted\r\n     */\r\n    userId: uuid('user_id')\r\n      .notNull()\r\n      .references(() => users.id, { onDelete: 'cascade' }),\r\n\r\n    // ========================================\r\n    // VISIBILITY & METRICS\r\n    // ========================================\r\n\r\n    /**\r\n     * Visibility\r\n     * true = Public (everyone can see)\r\n     * false = Private (only owner can see)\r\n     */\r\n    isPublic: boolean('is_public').default(true).notNull(),\r\n\r\n    /**\r\n     * Number of views\r\n     * Incremented when someone opens the snippet\r\n     */\r\n    viewCount: integer('view_count').default(0).notNull(),\r\n\r\n    // ========================================\r\n    // TIMESTAMPS\r\n    // ========================================\r\n\r\n    createdAt: timestamp('created_at', { withTimezone: true })\r\n      .defaultNow()\r\n      .notNull(),\r\n    updatedAt: timestamp('updated_at', { withTimezone: true })\r\n      .defaultNow()\r\n      .$onUpdate(() => new Date())\r\n      .notNull(),\r\n  },\r\n  (table) => ({\r\n    // ========================================\r\n    // INDICES (Performance!)\r\n    // ========================================\r\n\r\n    /**\r\n     * Index on userId\r\n     * Query: \"All my snippets\" (SELECT * FROM snippets WHERE user_id = ?)\r\n     * Without index: Full Table Scan\r\n     * With index: Index Scan (10-1000x faster)\r\n     */\r\n    userIdIdx: index('snippets_user_id_idx').on(table.userId),\r\n\r\n    /**\r\n     * Index on language\r\n     * Query: \"All TypeScript snippets\" (SELECT * FROM snippets WHERE language = 'typescript')\r\n     */\r\n    languageIdx: index('snippets_language_idx').on(table.language),\r\n\r\n    /**\r\n     * Index on createdAt\r\n     * Query: Sort by date (ORDER BY created_at DESC)\r\n     */\r\n    createdAtIdx: index('snippets_created_at_idx').on(table.createdAt),\r\n\r\n    /**\r\n     * Composite index for most common query: \"Public snippets sorted by date\"\r\n     * Query: SELECT * FROM snippets WHERE is_public = true ORDER BY created_at DESC\r\n     */\r\n    publicCreatedAtIdx: index('snippets_public_created_at_idx').on(\r\n      table.isPublic,\r\n      table.createdAt,\r\n    ),\r\n  }),\r\n);\r\n\r\n/**\r\n * Snippet Type (read from database)\r\n */\r\nexport type Snippet = typeof snippets.$inferSelect;\r\n/**\r\n * New Snippet Type (for INSERT operations)\r\n */\r\nexport type NewSnippet = typeof snippets.$inferInsert;\r\n"],"mappings":"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","ignoreList":[]}