390bee4f11e389a38b9c3e1e322d4051
"use strict";
// test/unit/services/snippets.service.spec.ts
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("@nestjs/common");
const testing_1 = require("@nestjs/testing");
const snippets_repository_1 = require("../../../src/modules/snippets/snippets.repository");
const snippets_service_1 = require("../../../src/modules/snippets/snippets.service");
const mocks_1 = require("../../mocks");
/**
 * SnippetsService Unit Tests
 *
 * Tests:
 * - Business Logic (Ownership, Public/Private)
 * - Error Handling (NotFoundException, ForbiddenException)
 * - Input Validation
 * - Orchestration of Repository Calls
 */
describe('SnippetsService', () => {
    let service;
    let repository;
    const mockSnippet = (0, mocks_1.createMockSnippet)();
    const ownerId = 'owner-user-id';
    const otherUserId = 'other-user-id';
    beforeEach(async () => {
        repository = (0, mocks_1.createMockSnippetsRepository)();
        const module = await testing_1.Test.createTestingModule({
            providers: [
                snippets_service_1.SnippetsService,
                {
                    provide: snippets_repository_1.SnippetsRepository,
                    useValue: repository,
                },
            ],
        }).compile();
        service = module.get(snippets_service_1.SnippetsService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    // ============================================================
    // CREATE
    // ============================================================
    describe('create', () => {
        it('should create a new snippet', async () => {
            // Arrange
            const dto = {
                title: 'Test Snippet',
                code: 'console.log("test")',
                language: 'javascript',
            };
            repository.create.mockResolvedValue(mockSnippet);
            // Act
            const result = await service.create(ownerId, dto);
            // Assert
            expect(result).toEqual(mockSnippet);
            expect(repository.create).toHaveBeenCalledWith({
                ...dto,
                userId: ownerId,
                isPublic: true, // Default
            });
        });
        it('should use provided isPublic value', async () => {
            // Arrange
            const dto = {
                title: 'Private Snippet',
                code: 'console.log("secret")',
                language: 'javascript',
                isPublic: false,
            };
            repository.create.mockResolvedValue(mockSnippet);
            // Act
            await service.create(ownerId, dto);
            // Assert
            expect(repository.create).toHaveBeenCalledWith(expect.objectContaining({ isPublic: false }));
        });
        it('should throw BadRequestException for empty code', async () => {
            // Arrange
            const dto = {
                title: 'Test',
                code: '   ', // Only whitespace
                language: 'javascript',
            };
            // Act & Assert
            await expect(service.create(ownerId, dto)).rejects.toThrow(common_1.BadRequestException);
            await expect(service.create(ownerId, dto)).rejects.toThrow('Code cannot be empty or contain only whitespace');
        });
        it('should throw BadRequestException for code > 50000 chars', async () => {
            // Arrange
            const dto = {
                title: 'Test',
                code: 'x'.repeat(50001),
                language: 'javascript',
            };
            // Act & Assert
            await expect(service.create(ownerId, dto)).rejects.toThrow(common_1.BadRequestException);
            await expect(service.create(ownerId, dto)).rejects.toThrow('Code exceeds maximum length of 50,000 characters');
        });
        it('should throw BadRequestException for empty title', async () => {
            // Arrange
            const dto = {
                title: '   ', // Only whitespace
                code: 'console.log("test")',
                language: 'javascript',
            };
            // Act & Assert
            await expect(service.create(ownerId, dto)).rejects.toThrow(common_1.BadRequestException);
            await expect(service.create(ownerId, dto)).rejects.toThrow('Title cannot be empty or contain only whitespace');
        });
    });
    // ============================================================
    // READ - SINGLE
    // ============================================================
    describe('findById', () => {
        it('should return public snippet without userId', async () => {
            // Arrange
            const publicSnippet = (0, mocks_1.createMockSnippet)({ isPublic: true });
            repository.findById.mockResolvedValue(publicSnippet);
            // Act
            const result = await service.findById('snippet-id');
            // Assert
            expect(result).toEqual(publicSnippet);
        });
        it('should return public snippet with any userId', async () => {
            // Arrange
            const publicSnippet = (0, mocks_1.createMockSnippet)({
                isPublic: true,
                userId: ownerId,
            });
            repository.findById.mockResolvedValue(publicSnippet);
            // Act
            const result = await service.findById('snippet-id', otherUserId);
            // Assert
            expect(result).toEqual(publicSnippet);
        });
        it('should return private snippet for owner', async () => {
            // Arrange
            const privateSnippet = (0, mocks_1.createMockSnippet)({
                isPublic: false,
                userId: ownerId,
            });
            repository.findById.mockResolvedValue(privateSnippet);
            // Act
            const result = await service.findById('snippet-id', ownerId);
            // Assert
            expect(result).toEqual(privateSnippet);
        });
        it('should throw ForbiddenException for private snippet of other user', async () => {
            // Arrange
            const privateSnippet = (0, mocks_1.createMockSnippet)({
                isPublic: false,
                userId: ownerId,
            });
            repository.findById.mockResolvedValue(privateSnippet);
            // Act & Assert
            await expect(service.findById('snippet-id', otherUserId)).rejects.toThrow(common_1.ForbiddenException);
            await expect(service.findById('snippet-id', otherUserId)).rejects.toThrow('You do not have access to this snippet');
        });
        it('should throw NotFoundException when snippet not found', async () => {
            // Arrange
            repository.findById.mockResolvedValue(null);
            // Act & Assert
            await expect(service.findById('nonexistent')).rejects.toThrow(common_1.NotFoundException);
            await expect(service.findById('nonexistent')).rejects.toThrow('Snippet with ID nonexistent not found');
        });
    });
    describe('findByIdAndIncrementViews', () => {
        it('should return snippet and increment views', async () => {
            // Arrange
            const publicSnippet = (0, mocks_1.createMockSnippet)({ isPublic: true });
            repository.findById.mockResolvedValue(publicSnippet);
            repository.incrementViewCount.mockResolvedValue(true);
            // Act
            const result = await service.findByIdAndIncrementViews('snippet-id');
            // Assert
            expect(result).toEqual(publicSnippet);
            // incrementViewCount is fire-and-forget, so we can't reliably test it was called
        });
        it('should not fail if incrementViewCount fails', async () => {
            // Arrange
            const publicSnippet = (0, mocks_1.createMockSnippet)({ isPublic: true });
            repository.findById.mockResolvedValue(publicSnippet);
            repository.incrementViewCount.mockRejectedValue(new Error('DB Error'));
            // Act - Should NOT throw
            const result = await service.findByIdAndIncrementViews('snippet-id');
            // Assert
            expect(result).toEqual(publicSnippet);
        });
    });
    // ============================================================
    // READ - LISTS
    // ============================================================
    describe('findUserSnippets', () => {
        it('should return user snippets', async () => {
            // Arrange
            const snippets = [mockSnippet];
            repository.findByUserId.mockResolvedValue(snippets);
            // Act
            const result = await service.findUserSnippets(ownerId);
            // Assert
            expect(result).toEqual(snippets);
            expect(repository.findByUserId).toHaveBeenCalledWith(ownerId, 20);
        });
        it('should use custom limit', async () => {
            // Arrange
            repository.findByUserId.mockResolvedValue([]);
            // Act
            await service.findUserSnippets(ownerId, 50);
            // Assert
            expect(repository.findByUserId).toHaveBeenCalledWith(ownerId, 50);
        });
    });
    describe('findPublicSnippets', () => {
        it('should return paginated public snippets', async () => {
            // Arrange
            const paginatedResult = {
                data: [mockSnippet],
                meta: {
                    page: 1,
                    limit: 20,
                    total: 100,
                    totalPages: 5,
                    hasNextPage: true,
                    hasPreviousPage: false,
                },
            };
            repository.findPublic.mockResolvedValue(paginatedResult);
            // Act
            const result = await service.findPublicSnippets(1, 20);
            // Assert
            expect(result).toEqual(paginatedResult);
        });
        it('should enforce minimum page of 1', async () => {
            // Arrange
            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
            repository.findPublic.mockResolvedValue({ data: [], meta: {} });
            // Act
            await service.findPublicSnippets(0, 20);
            // Assert
            expect(repository.findPublic).toHaveBeenCalledWith(1, 20);
        });
        it('should enforce maximum limit of 100', async () => {
            // Arrange
            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
            repository.findPublic.mockResolvedValue({ data: [], meta: {} });
            // Act
            await service.findPublicSnippets(1, 200);
            // Assert
            expect(repository.findPublic).toHaveBeenCalledWith(1, 100);
        });
    });
    // ============================================================
    // UPDATE
    // ============================================================
    describe('update', () => {
        it('should update own snippet', async () => {
            // Arrange
            const existingSnippet = (0, mocks_1.createMockSnippet)({ userId: ownerId });
            const updatedSnippet = { ...existingSnippet, title: 'Updated' };
            repository.findById.mockResolvedValue(existingSnippet);
            repository.update.mockResolvedValue(updatedSnippet);
            // Act
            const result = await service.update('snippet-id', ownerId, 'USER', {
                title: 'Updated',
            });
            // Assert
            expect(result.title).toBe('Updated');
            expect(repository.update).toHaveBeenCalledWith('snippet-id', {
                title: 'Updated',
            });
        });
        it('should throw ForbiddenException when updating other user snippet', async () => {
            // Arrange
            const existingSnippet = (0, mocks_1.createMockSnippet)({ userId: ownerId });
            repository.findById.mockResolvedValue(existingSnippet);
            // Act & Assert
            await expect(service.update('snippet-id', otherUserId, 'USER', { title: 'Updated' })).rejects.toThrow(common_1.ForbiddenException);
            await expect(service.update('snippet-id', otherUserId, 'USER', { title: 'Updated' })).rejects.toThrow('You can only modify your own snippets');
        });
        it('should allow ADMIN to update any snippet', async () => {
            // Arrange
            const existingSnippet = (0, mocks_1.createMockSnippet)({ userId: ownerId });
            const updatedSnippet = { ...existingSnippet, title: 'Admin Updated' };
            repository.findById.mockResolvedValue(existingSnippet);
            repository.update.mockResolvedValue(updatedSnippet);
            // Act
            const result = await service.update('snippet-id', otherUserId, 'ADMIN', {
                title: 'Admin Updated',
            });
            // Assert
            expect(result.title).toBe('Admin Updated');
        });
        it('should throw NotFoundException when snippet not found', async () => {
            // Arrange
            repository.findById.mockResolvedValue(null);
            // Act & Assert
            await expect(service.update('nonexistent', ownerId, 'USER', { title: 'Updated' })).rejects.toThrow(common_1.NotFoundException);
        });
        it('should validate new data', async () => {
            // Arrange
            const existingSnippet = (0, mocks_1.createMockSnippet)({ userId: ownerId });
            repository.findById.mockResolvedValue(existingSnippet);
            // Act & Assert - Empty title
            await expect(service.update('snippet-id', ownerId, 'USER', { title: '   ' })).rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('togglePublic', () => {
        it('should toggle public to private', async () => {
            // Arrange
            const publicSnippet = (0, mocks_1.createMockSnippet)({
                userId: ownerId,
                isPublic: true,
            });
            const privateSnippet = { ...publicSnippet, isPublic: false };
            repository.findById.mockResolvedValue(publicSnippet);
            repository.update.mockResolvedValue(privateSnippet);
            // Act
            const result = await service.togglePublic('snippet-id', ownerId, 'USER');
            // Assert
            expect(result.isPublic).toBe(false);
            expect(repository.update).toHaveBeenCalledWith('snippet-id', {
                isPublic: false,
            });
        });
        it('should toggle private to public', async () => {
            // Arrange
            const privateSnippet = (0, mocks_1.createMockSnippet)({
                userId: ownerId,
                isPublic: false,
            });
            const publicSnippet = { ...privateSnippet, isPublic: true };
            repository.findById.mockResolvedValue(privateSnippet);
            repository.update.mockResolvedValue(publicSnippet);
            // Act
            const result = await service.togglePublic('snippet-id', ownerId, 'USER');
            // Assert
            expect(result.isPublic).toBe(true);
        });
        it('should throw ForbiddenException for other user', async () => {
            // Arrange
            const snippet = (0, mocks_1.createMockSnippet)({ userId: ownerId });
            repository.findById.mockResolvedValue(snippet);
            // Act & Assert
            await expect(service.togglePublic('snippet-id', otherUserId, 'USER')).rejects.toThrow(common_1.ForbiddenException);
        });
    });
    // ============================================================
    // DELETE
    // ============================================================
    describe('delete', () => {
        it('should delete own snippet', async () => {
            // Arrange
            const snippet = (0, mocks_1.createMockSnippet)({ userId: ownerId });
            repository.findById.mockResolvedValue(snippet);
            repository.delete.mockResolvedValue(true);
            // Act
            await service.delete('snippet-id', ownerId, 'USER');
            // Assert
            expect(repository.delete).toHaveBeenCalledWith('snippet-id');
        });
        it('should throw ForbiddenException when deleting other user snippet', async () => {
            // Arrange
            const snippet = (0, mocks_1.createMockSnippet)({ userId: ownerId });
            repository.findById.mockResolvedValue(snippet);
            // Act & Assert
            await expect(service.delete('snippet-id', otherUserId, 'USER')).rejects.toThrow(common_1.ForbiddenException);
            await expect(service.delete('snippet-id', otherUserId, 'USER')).rejects.toThrow('You can only delete your own snippets');
        });
        it('should allow ADMIN to delete any snippet', async () => {
            // Arrange
            const snippet = (0, mocks_1.createMockSnippet)({ userId: ownerId });
            repository.findById.mockResolvedValue(snippet);
            repository.delete.mockResolvedValue(true);
            // Act
            await service.delete('snippet-id', otherUserId, 'ADMIN');
            // Assert
            expect(repository.delete).toHaveBeenCalledWith('snippet-id');
        });
        it('should throw NotFoundException when snippet not found', async () => {
            // Arrange
            repository.findById.mockResolvedValue(null);
            // Act & Assert
            await expect(service.delete('nonexistent', ownerId, 'USER')).rejects.toThrow(common_1.NotFoundException);
        });
    });
    // ============================================================
    // STATISTICS
    // ============================================================
    describe('getUserStats', () => {
        it('should return user statistics', async () => {
            // Arrange
            const stats = {
                total: 10,
                public: 7,
                private: 3,
                totalViews: 150,
                mostViewed: mockSnippet,
                latestSnippet: mockSnippet,
            };
            repository.getUserStats.mockResolvedValue(stats);
            // Act
            const result = await service.getUserStats(ownerId);
            // Assert
            expect(result).toEqual(stats);
        });
    });
    describe('countUserSnippets', () => {
        it('should return count of user snippets', async () => {
            // Arrange
            repository.countByUserId.mockResolvedValue(42);
            // Act
            const result = await service.countUserSnippets(ownerId);
            // Assert
            expect(result).toBe(42);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aW11clxcUHJvZ3JhbW1pbmdcXFByb2plY3RzXFxzbmlwcGV0Zm9yZ2VcXGFwcHNcXGFwaVxcdGVzdFxcdW5pdFxcc2VydmljZXNcXHNuaXBwZXRzLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiO0FBQUEsOENBQThDOztBQUU5QywyQ0FJd0I7QUFDeEIsNkNBQXNEO0FBQ3RELDJGQUF1RjtBQUN2RixxRkFBaUY7QUFDakYsdUNBSXFCO0FBRXJCOzs7Ozs7OztHQVFHO0FBQ0gsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixJQUFJLE9BQXdCLENBQUM7SUFDN0IsSUFBSSxVQUFrQyxDQUFDO0lBRXZDLE1BQU0sV0FBVyxHQUFHLElBQUEseUJBQWlCLEdBQUUsQ0FBQztJQUN4QyxNQUFNLE9BQU8sR0FBRyxlQUFlLENBQUM7SUFDaEMsTUFBTSxXQUFXLEdBQUcsZUFBZSxDQUFDO0lBRXBDLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixVQUFVLEdBQUcsSUFBQSxvQ0FBNEIsR0FBRSxDQUFDO1FBRTVDLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUU7Z0JBQ1Qsa0NBQWU7Z0JBQ2Y7b0JBQ0UsT0FBTyxFQUFFLHdDQUFrQjtvQkFDM0IsUUFBUSxFQUFFLFVBQVU7aUJBQ3JCO2FBQ0Y7U0FDRixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBa0Isa0NBQWUsQ0FBQyxDQUFDO0lBQ3pELENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILCtEQUErRDtJQUMvRCxTQUFTO0lBQ1QsK0RBQStEO0lBRS9ELFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO1FBQ3RCLEVBQUUsQ0FBQyw2QkFBNkIs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QUFVO1lBQ1YsTUFBTSxLQUFLLEdBQUc7Z0JBQ1osS0FBSyxFQUFFLEVBQUU7Z0JBQ1QsTUFBTSxFQUFFLENBQUM7Z0JBQ1QsT0FBTyxFQUFFLENBQUM7Z0JBQ1YsVUFBVSxFQUFFLEdBQUc7Z0JBQ2YsVUFBVSxFQUFFLFdBQVc7Z0JBQ3ZCLGFBQWEsRUFBRSxXQUFXO2FBQzNCLENBQUM7WUFDRixVQUFVLENBQUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRWpELE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFbkQsU0FBUztZQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BELFVBQVU7WUFDVixVQUFVLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRS9DLE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUV4RCxTQUFTO1lBQ1QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aW11clxcUHJvZ3JhbW1pbmdcXFByb2plY3RzXFxzbmlwcGV0Zm9yZ2VcXGFwcHNcXGFwaVxcdGVzdFxcdW5pdFxcc2VydmljZXNcXHNuaXBwZXRzLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0ZXN0L3VuaXQvc2VydmljZXMvc25pcHBldHMuc2VydmljZS5zcGVjLnRzXHJcblxyXG5pbXBvcnQge1xyXG4gIEJhZFJlcXVlc3RFeGNlcHRpb24sXHJcbiAgRm9yYmlkZGVuRXhjZXB0aW9uLFxyXG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxyXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcclxuaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XHJcbmltcG9ydCB7IFNuaXBwZXRzUmVwb3NpdG9yeSB9IGZyb20gJy4uLy4uLy4uL3NyYy9tb2R1bGVzL3NuaXBwZXRzL3NuaXBwZXRzLnJlcG9zaXRvcnknO1xyXG5pbXBvcnQgeyBTbmlwcGV0c1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zcmMvbW9kdWxlcy9zbmlwcGV0cy9zbmlwcGV0cy5zZXJ2aWNlJztcclxuaW1wb3J0IHtcclxuICBjcmVhdGVNb2NrU25pcHBldCxcclxuICBjcmVhdGVNb2NrU25pcHBldHNSZXBvc2l0b3J5LFxyXG4gIHR5cGUgTW9ja1NuaXBwZXRzUmVwb3NpdG9yeSxcclxufSBmcm9tICcuLi8uLi9tb2Nrcyc7XHJcblxyXG4vKipcclxuICogU25pcHBldHNTZXJ2aWNlIFVuaXQgVGVzdHNcclxuICpcclxuICogVGVzdHM6XHJcbiAqIC0gQnVzaW5lc3MgTG9naWMgKE93bmVyc2hpcCwgUHVibGljL1ByaXZhdGUpXHJcbiAqIC0gRXJyb3IgSGFuZGxpbmcgKE5vdEZvdW5kRXhjZXB0aW9uLCBGb3JiaWRkZW5FeGNlcHRpb24pXHJcbiAqIC0gSW5wdXQgVmFsaWRhdGlvblxyXG4gKiAtIE9yY2hlc3RyYXRpb24gb2YgUmVwb3NpdG9yeSBDYWxsc1xyXG4gKi9cclxuZGVzY3JpYmUoJ1NuaXBwZXRzU2VydmljZScsICgpID0+IHtcclxuICBsZXQgc2VydmljZTogU25pcHBldHNTZXJ2aWNlO1xyXG4gIGxldCByZXBvc2l0b3J5OiBNb2NrU25pcHBldHNSZXBvc2l0b3J5O1xyXG5cclxuICBjb25zdCBtb2NrU25pcHBldCA9IGNyZWF0ZU1vY2tTbmlwcGV0KCk7XHJcbiAgY29uc3Qgb3duZXJJZCA9ICdvd25lci11c2VyLWlkJztcclxuICBjb25zdCBvdGhlclVzZXJJZCA9ICdvdGhlci11c2VyLWlkJztcclxuXHJcbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XHJcbiAgICByZXBvc2l0b3J5ID0gY3JlYXRlTW9ja1NuaXBwZXRzUmVwb3NpdG9yeSgpO1xyXG5cclxuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XHJcbiAgICAgIHByb3ZpZGVyczogW1xyXG4gICAgICAgIFNuaXBwZXRzU2VydmljZSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBwcm92aWRlOiBTbmlwcGV0c1JlcG9zaXRvcnksXHJcbiAgICAgICAgICB1c2VWYWx1ZTogcmVwb3NpdG9yeSxcclxuICAgICAgICB9LFxyXG4gICAgICBdLFxyXG4gICAgfSkuY29tcGlsZSgpO1xyXG5cclxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PFNuaXBwZXRzU2VydmljZT4oU25pcHBldHNTZXJ2aWNlKTtcclxuICB9KTtcclxuXHJcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBDUkVBVEVcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgZGVzY3JpYmUoJ2NyZWF0ZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgbmV3IHNuaXBwZXQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZHRvID0ge1xyXG4gICAgICAgIHRpdGxlOiAnVGVzdCBTbmlwcGV0JyxcclxuICAgICAgICBjb2RlOiAnY29uc29sZS5sb2coXCJ0ZXN0XCIpJyxcclxuICAgICAgICBsYW5ndWFnZTogJ2phdmFzY3JpcHQnLFxyXG4gICAgICB9O1xyXG4gICAgICByZXBvc2l0b3J5LmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU25pcHBldCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGUob3duZXJJZCwgZHRvKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tTbmlwcGV0KTtcclxuICAgICAgZXhwZWN0KHJlcG9zaXRvcnkuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgLi4uZHRvLFxyXG4gICAgICAgIHVzZXJJZDogb3duZXJJZCxcclxuICAgICAgICBpc1B1YmxpYzogdHJ1ZSwgLy8gRGVmYXVsdFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdXNlIHByb3ZpZGVkIGlzUHVibGljIHZhbHVlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGR0byA9IHtcclxuICAgICAgICB0aXRsZTogJ1ByaXZhdGUgU25pcHBldCcsXHJcbiAgICAgICAgY29kZTogJ2NvbnNvbGUubG9nKFwic2VjcmV0XCIpJyxcclxuICAgICAgICBsYW5ndWFnZTogJ2phdmFzY3JpcHQnLFxyXG4gICAgICAgIGlzUHVibGljOiBmYWxzZSxcclxuICAgICAgfTtcclxuICAgICAgcmVwb3NpdG9yeS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1NuaXBwZXQpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IHNlcnZpY2UuY3JlYXRlKG93bmVySWQsIGR0byk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlcG9zaXRvcnkuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IGlzUHVibGljOiBmYWxzZSB9KSxcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgQmFkUmVxdWVzdEV4Y2VwdGlvbiBmb3IgZW1wdHkgY29kZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBkdG8gPSB7XHJcbiAgICAgICAgdGl0bGU6ICdUZXN0JyxcclxuICAgICAgICBjb2RlOiAnICAgJywgLy8gT25seSB3aGl0ZXNwYWNlXHJcbiAgICAgICAgbGFuZ3VhZ2U6ICdqYXZhc2NyaXB0JyxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIEFjdCAmIEFzc2VydFxyXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5jcmVhdGUob3duZXJJZCwgZHRvKSkucmVqZWN0cy50b1Rocm93KFxyXG4gICAgICAgIEJhZFJlcXVlc3RFeGNlcHRpb24sXHJcbiAgICAgICk7XHJcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmNyZWF0ZShvd25lcklkLCBkdG8pKS5yZWplY3RzLnRvVGhyb3coXHJcbiAgICAgICAgJ0NvZGUgY2Fubm90IGJlIGVtcHR5IG9yIGNvbnRhaW4gb25seSB3aGl0ZXNwYWNlJyxcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgQmFkUmVxdWVzdEV4Y2VwdGlvbiBmb3IgY29kZSA+IDUwMDAwIGNoYXJzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IGR0byA9IHtcclxuICAgICAgICB0aXRsZTogJ1Rlc3QnLFxyXG4gICAgICAgIGNvZGU6ICd4Jy5yZXBlYXQoNTAwMDEpLFxyXG4gICAgICAgIGxhbmd1YWdlOiAnamF2YXNjcmlwdCcsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcclxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKG93bmVySWQsIGR0bykpLnJlamVjdHMudG9UaHJvdyhcclxuICAgICAgICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxyXG4gICAgICApO1xyXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5jcmVhdGUob3duZXJJZCwgZHRvKSkucmVqZWN0cy50b1Rocm93KFxyXG4gICAgICAgICdDb2RlIGV4Y2VlZHMgbWF4aW11bSBsZW5ndGggb2YgNTAsMDAwIGNoYXJhY3RlcnMnLFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGZvciBlbXB0eSB0aXRsZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBkdG8gPSB7XHJcbiAgICAgICAgdGl0bGU6ICcgICAnLCAvLyBPbmx5IHdoaXRlc3BhY2VcclxuICAgICAgICBjb2RlOiAnY29uc29sZS5sb2coXCJ0ZXN0XCIpJyxcclxuICAgICAgICBsYW5ndWFnZTogJ2phdmFzY3JpcHQnLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmNyZWF0ZShvd25lcklkLCBkdG8pKS5yZWplY3RzLnRvVGhyb3coXHJcbiAgICAgICAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcclxuICAgICAgKTtcclxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKG93bmVySWQsIGR0bykpLnJlamVjdHMudG9UaHJvdyhcclxuICAgICAgICAnVGl0bGUgY2Fubm90IGJlIGVtcHR5IG9yIGNvbnRhaW4gb25seSB3aGl0ZXNwYWNlJyxcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBSRUFEIC0gU0lOR0xFXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIGRlc2NyaWJlKCdmaW5kQnlJZCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHB1YmxpYyBzbmlwcGV0IHdpdGhvdXQgdXNlcklkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHB1YmxpY1NuaXBwZXQgPSBjcmVhdGVNb2NrU25pcHBldCh7IGlzUHVibGljOiB0cnVlIH0pO1xyXG4gICAgICByZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHB1YmxpY1NuaXBwZXQpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZEJ5SWQoJ3NuaXBwZXQtaWQnKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHB1YmxpY1NuaXBwZXQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHVibGljIHNuaXBwZXQgd2l0aCBhbnkgdXNlcklkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHB1YmxpY1NuaXBwZXQgPSBjcmVhdGVNb2NrU25pcHBldCh7XHJcbiAgICAgICAgaXNQdWJsaWM6IHRydWUsXHJcbiAgICAgICAgdXNlcklkOiBvd25lcklkLFxyXG4gICAgICB9KTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShwdWJsaWNTbmlwcGV0KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRCeUlkKCdzbmlwcGV0LWlkJywgb3RoZXJVc2VySWQpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwocHVibGljU25pcHBldCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwcml2YXRlIHNuaXBwZXQgZm9yIG93bmVyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHByaXZhdGVTbmlwcGV0ID0gY3JlYXRlTW9ja1NuaXBwZXQoe1xyXG4gICAgICAgIGlzUHVibGljOiBmYWxzZSxcclxuICAgICAgICB1c2VySWQ6IG93bmVySWQsXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHByaXZhdGVTbmlwcGV0KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRCeUlkKCdzbmlwcGV0LWlkJywgb3duZXJJZCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChwcml2YXRlU25pcHBldCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IEZvcmJpZGRlbkV4Y2VwdGlvbiBmb3IgcHJpdmF0ZSBzbmlwcGV0IG9mIG90aGVyIHVzZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgcHJpdmF0ZVNuaXBwZXQgPSBjcmVhdGVNb2NrU25pcHBldCh7XHJcbiAgICAgICAgaXNQdWJsaWM6IGZhbHNlLFxyXG4gICAgICAgIHVzZXJJZDogb3duZXJJZCxcclxuICAgICAgfSk7XHJcbiAgICAgIHJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUocHJpdmF0ZVNuaXBwZXQpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmZpbmRCeUlkKCdzbmlwcGV0LWlkJywgb3RoZXJVc2VySWQpKS5yZWplY3RzLnRvVGhyb3coXHJcbiAgICAgICAgRm9yYmlkZGVuRXhjZXB0aW9uLFxyXG4gICAgICApO1xyXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kQnlJZCgnc25pcHBldC1pZCcsIG90aGVyVXNlcklkKSkucmVqZWN0cy50b1Rocm93KFxyXG4gICAgICAgICdZb3UgZG8gbm90IGhhdmUgYWNjZXNzIHRvIHRoaXMgc25pcHBldCcsXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIHdoZW4gc25pcHBldCBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcclxuXHJcbiAgICAgIC8vIEFjdCAmIEFzc2VydFxyXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kQnlJZCgnbm9uZXhpc3RlbnQnKSkucmVqZWN0cy50b1Rocm93KFxyXG4gICAgICAgIE5vdEZvdW5kRXhjZXB0aW9uLFxyXG4gICAgICApO1xyXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kQnlJZCgnbm9uZXhpc3RlbnQnKSkucmVqZWN0cy50b1Rocm93KFxyXG4gICAgICAgICdTbmlwcGV0IHdpdGggSUQgbm9uZXhpc3RlbnQgbm90IGZvdW5kJyxcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZmluZEJ5SWRBbmRJbmNyZW1lbnRWaWV3cycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHNuaXBwZXQgYW5kIGluY3JlbWVudCB2aWV3cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBwdWJsaWNTbmlwcGV0ID0gY3JlYXRlTW9ja1NuaXBwZXQoeyBpc1B1YmxpYzogdHJ1ZSB9KTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShwdWJsaWNTbmlwcGV0KTtcclxuICAgICAgcmVwb3NpdG9yeS5pbmNyZW1lbnRWaWV3Q291bnQubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQnlJZEFuZEluY3JlbWVudFZpZXdzKCdzbmlwcGV0LWlkJyk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChwdWJsaWNTbmlwcGV0KTtcclxuICAgICAgLy8gaW5jcmVtZW50Vmlld0NvdW50IGlzIGZpcmUtYW5kLWZvcmdldCwgc28gd2UgY2FuJ3QgcmVsaWFibHkgdGVzdCBpdCB3YXMgY2FsbGVkXHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIG5vdCBmYWlsIGlmIGluY3JlbWVudFZpZXdDb3VudCBmYWlscycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBwdWJsaWNTbmlwcGV0ID0gY3JlYXRlTW9ja1NuaXBwZXQoeyBpc1B1YmxpYzogdHJ1ZSB9KTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShwdWJsaWNTbmlwcGV0KTtcclxuICAgICAgcmVwb3NpdG9yeS5pbmNyZW1lbnRWaWV3Q291bnQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdEQiBFcnJvcicpKTtcclxuXHJcbiAgICAgIC8vIEFjdCAtIFNob3VsZCBOT1QgdGhyb3dcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQnlJZEFuZEluY3JlbWVudFZpZXdzKCdzbmlwcGV0LWlkJyk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChwdWJsaWNTbmlwcGV0KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBSRUFEIC0gTElTVFNcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgZGVzY3JpYmUoJ2ZpbmRVc2VyU25pcHBldHMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiB1c2VyIHNuaXBwZXRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHNuaXBwZXRzID0gW21vY2tTbmlwcGV0XTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlVc2VySWQubW9ja1Jlc29sdmVkVmFsdWUoc25pcHBldHMpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZFVzZXJTbmlwcGV0cyhvd25lcklkKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHNuaXBwZXRzKTtcclxuICAgICAgZXhwZWN0KHJlcG9zaXRvcnkuZmluZEJ5VXNlcklkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChvd25lcklkLCAyMCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHVzZSBjdXN0b20gbGltaXQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlVc2VySWQubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IHNlcnZpY2UuZmluZFVzZXJTbmlwcGV0cyhvd25lcklkLCA1MCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlcG9zaXRvcnkuZmluZEJ5VXNlcklkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChvd25lcklkLCA1MCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2ZpbmRQdWJsaWNTbmlwcGV0cycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHBhZ2luYXRlZCBwdWJsaWMgc25pcHBldHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgcGFnaW5hdGVkUmVzdWx0ID0ge1xyXG4gICAgICAgIGRhdGE6IFttb2NrU25pcHBldF0sXHJcbiAgICAgICAgbWV0YToge1xyXG4gICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgIGxpbWl0OiAyMCxcclxuICAgICAgICAgIHRvdGFsOiAxMDAsXHJcbiAgICAgICAgICB0b3RhbFBhZ2VzOiA1LFxyXG4gICAgICAgICAgaGFzTmV4dFBhZ2U6IHRydWUsXHJcbiAgICAgICAgICBoYXNQcmV2aW91c1BhZ2U6IGZhbHNlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH07XHJcbiAgICAgIHJlcG9zaXRvcnkuZmluZFB1YmxpYy5tb2NrUmVzb2x2ZWRWYWx1ZShwYWdpbmF0ZWRSZXN1bHQpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZFB1YmxpY1NuaXBwZXRzKDEsIDIwKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHBhZ2luYXRlZFJlc3VsdCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGVuZm9yY2UgbWluaW11bSBwYWdlIG9mIDEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuXHJcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFzc2lnbm1lbnRcclxuICAgICAgcmVwb3NpdG9yeS5maW5kUHVibGljLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogW10sIG1ldGE6IHt9IGFzIGFueSB9KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBhd2FpdCBzZXJ2aWNlLmZpbmRQdWJsaWNTbmlwcGV0cygwLCAyMCk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlcG9zaXRvcnkuZmluZFB1YmxpYykudG9IYXZlQmVlbkNhbGxlZFdpdGgoMSwgMjApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBlbmZvcmNlIG1heGltdW0gbGltaXQgb2YgMTAwJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcblxyXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hc3NpZ25tZW50XHJcbiAgICAgIHJlcG9zaXRvcnkuZmluZFB1YmxpYy5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6IFtdLCBtZXRhOiB7fSBhcyBhbnkgfSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgc2VydmljZS5maW5kUHVibGljU25pcHBldHMoMSwgMjAwKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVwb3NpdG9yeS5maW5kUHVibGljKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgxLCAxMDApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gIC8vIFVQREFURVxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICBkZXNjcmliZSgndXBkYXRlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgb3duIHNuaXBwZXQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhpc3RpbmdTbmlwcGV0ID0gY3JlYXRlTW9ja1NuaXBwZXQoeyB1c2VySWQ6IG93bmVySWQgfSk7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZWRTbmlwcGV0ID0geyAuLi5leGlzdGluZ1NuaXBwZXQsIHRpdGxlOiAnVXBkYXRlZCcgfTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShleGlzdGluZ1NuaXBwZXQpO1xyXG4gICAgICByZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkU25pcHBldCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS51cGRhdGUoJ3NuaXBwZXQtaWQnLCBvd25lcklkLCAnVVNFUicsIHtcclxuICAgICAgICB0aXRsZTogJ1VwZGF0ZWQnLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0LnRpdGxlKS50b0JlKCdVcGRhdGVkJyk7XHJcbiAgICAgIGV4cGVjdChyZXBvc2l0b3J5LnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3NuaXBwZXQtaWQnLCB7XHJcbiAgICAgICAgdGl0bGU6ICdVcGRhdGVkJyxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IEZvcmJpZGRlbkV4Y2VwdGlvbiB3aGVuIHVwZGF0aW5nIG90aGVyIHVzZXIgc25pcHBldCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleGlzdGluZ1NuaXBwZXQgPSBjcmVhdGVNb2NrU25pcHBldCh7IHVzZXJJZDogb3duZXJJZCB9KTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShleGlzdGluZ1NuaXBwZXQpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChcclxuICAgICAgICBzZXJ2aWNlLnVwZGF0ZSgnc25pcHBldC1pZCcsIG90aGVyVXNlcklkLCAnVVNFUicsIHsgdGl0bGU6ICdVcGRhdGVkJyB9KSxcclxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coRm9yYmlkZGVuRXhjZXB0aW9uKTtcclxuICAgICAgYXdhaXQgZXhwZWN0KFxyXG4gICAgICAgIHNlcnZpY2UudXBkYXRlKCdzbmlwcGV0LWlkJywgb3RoZXJVc2VySWQsICdVU0VSJywgeyB0aXRsZTogJ1VwZGF0ZWQnIH0pLFxyXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnWW91IGNhbiBvbmx5IG1vZGlmeSB5b3VyIG93biBzbmlwcGV0cycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBBRE1JTiB0byB1cGRhdGUgYW55IHNuaXBwZXQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIEFycmFuZ2VcclxuICAgICAgY29uc3QgZXhpc3RpbmdTbmlwcGV0ID0gY3JlYXRlTW9ja1NuaXBwZXQoeyB1c2VySWQ6IG93bmVySWQgfSk7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZWRTbmlwcGV0ID0geyAuLi5leGlzdGluZ1NuaXBwZXQsIHRpdGxlOiAnQWRtaW4gVXBkYXRlZCcgfTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShleGlzdGluZ1NuaXBwZXQpO1xyXG4gICAgICByZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkU25pcHBldCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS51cGRhdGUoJ3NuaXBwZXQtaWQnLCBvdGhlclVzZXJJZCwgJ0FETUlOJywge1xyXG4gICAgICAgIHRpdGxlOiAnQWRtaW4gVXBkYXRlZCcsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudGl0bGUpLnRvQmUoJ0FkbWluIFVwZGF0ZWQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gd2hlbiBzbmlwcGV0IG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICByZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChcclxuICAgICAgICBzZXJ2aWNlLnVwZGF0ZSgnbm9uZXhpc3RlbnQnLCBvd25lcklkLCAnVVNFUicsIHsgdGl0bGU6ICdVcGRhdGVkJyB9KSxcclxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBuZXcgZGF0YScsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBleGlzdGluZ1NuaXBwZXQgPSBjcmVhdGVNb2NrU25pcHBldCh7IHVzZXJJZDogb3duZXJJZCB9KTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShleGlzdGluZ1NuaXBwZXQpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0IC0gRW1wdHkgdGl0bGVcclxuICAgICAgYXdhaXQgZXhwZWN0KFxyXG4gICAgICAgIHNlcnZpY2UudXBkYXRlKCdzbmlwcGV0LWlkJywgb3duZXJJZCwgJ1VTRVInLCB7IHRpdGxlOiAnICAgJyB9KSxcclxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3RvZ2dsZVB1YmxpYycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdG9nZ2xlIHB1YmxpYyB0byBwcml2YXRlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHB1YmxpY1NuaXBwZXQgPSBjcmVhdGVNb2NrU25pcHBldCh7XHJcbiAgICAgICAgdXNlcklkOiBvd25lcklkLFxyXG4gICAgICAgIGlzUHVibGljOiB0cnVlLFxyXG4gICAgICB9KTtcclxuICAgICAgY29uc3QgcHJpdmF0ZVNuaXBwZXQgPSB7IC4uLnB1YmxpY1NuaXBwZXQsIGlzUHVibGljOiBmYWxzZSB9O1xyXG4gICAgICByZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHB1YmxpY1NuaXBwZXQpO1xyXG4gICAgICByZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShwcml2YXRlU25pcHBldCk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS50b2dnbGVQdWJsaWMoJ3NuaXBwZXQtaWQnLCBvd25lcklkLCAnVVNFUicpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuaXNQdWJsaWMpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzbmlwcGV0LWlkJywge1xyXG4gICAgICAgIGlzUHVibGljOiBmYWxzZSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRvZ2dsZSBwcml2YXRlIHRvIHB1YmxpYycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBwcml2YXRlU25pcHBldCA9IGNyZWF0ZU1vY2tTbmlwcGV0KHtcclxuICAgICAgICB1c2VySWQ6IG93bmVySWQsXHJcbiAgICAgICAgaXNQdWJsaWM6IGZhbHNlLFxyXG4gICAgICB9KTtcclxuICAgICAgY29uc3QgcHVibGljU25pcHBldCA9IHsgLi4ucHJpdmF0ZVNuaXBwZXQsIGlzUHVibGljOiB0cnVlIH07XHJcbiAgICAgIHJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUocHJpdmF0ZVNuaXBwZXQpO1xyXG4gICAgICByZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShwdWJsaWNTbmlwcGV0KTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnRvZ2dsZVB1YmxpYygnc25pcHBldC1pZCcsIG93bmVySWQsICdVU0VSJyk7XHJcblxyXG4gICAgICAvLyBBc3NlcnRcclxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1B1YmxpYykudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgRm9yYmlkZGVuRXhjZXB0aW9uIGZvciBvdGhlciB1c2VyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHNuaXBwZXQgPSBjcmVhdGVNb2NrU25pcHBldCh7IHVzZXJJZDogb3duZXJJZCB9KTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShzbmlwcGV0KTtcclxuXHJcbiAgICAgIC8vIEFjdCAmIEFzc2VydFxyXG4gICAgICBhd2FpdCBleHBlY3QoXHJcbiAgICAgICAgc2VydmljZS50b2dnbGVQdWJsaWMoJ3NuaXBwZXQtaWQnLCBvdGhlclVzZXJJZCwgJ1VTRVInKSxcclxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coRm9yYmlkZGVuRXhjZXB0aW9uKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBERUxFVEVcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHJcbiAgZGVzY3JpYmUoJ2RlbGV0ZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgZGVsZXRlIG93biBzbmlwcGV0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHNuaXBwZXQgPSBjcmVhdGVNb2NrU25pcHBldCh7IHVzZXJJZDogb3duZXJJZCB9KTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShzbmlwcGV0KTtcclxuICAgICAgcmVwb3NpdG9yeS5kZWxldGUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgYXdhaXQgc2VydmljZS5kZWxldGUoJ3NuaXBwZXQtaWQnLCBvd25lcklkLCAnVVNFUicpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXBvc2l0b3J5LmRlbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3NuaXBwZXQtaWQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgRm9yYmlkZGVuRXhjZXB0aW9uIHdoZW4gZGVsZXRpbmcgb3RoZXIgdXNlciBzbmlwcGV0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHNuaXBwZXQgPSBjcmVhdGVNb2NrU25pcHBldCh7IHVzZXJJZDogb3duZXJJZCB9KTtcclxuICAgICAgcmVwb3NpdG9yeS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShzbmlwcGV0KTtcclxuXHJcbiAgICAgIC8vIEFjdCAmIEFzc2VydFxyXG4gICAgICBhd2FpdCBleHBlY3QoXHJcbiAgICAgICAgc2VydmljZS5kZWxldGUoJ3NuaXBwZXQtaWQnLCBvdGhlclVzZXJJZCwgJ1VTRVInKSxcclxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coRm9yYmlkZGVuRXhjZXB0aW9uKTtcclxuICAgICAgYXdhaXQgZXhwZWN0KFxyXG4gICAgICAgIHNlcnZpY2UuZGVsZXRlKCdzbmlwcGV0LWlkJywgb3RoZXJVc2VySWQsICdVU0VSJyksXHJcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdZb3UgY2FuIG9ubHkgZGVsZXRlIHlvdXIgb3duIHNuaXBwZXRzJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGFsbG93IEFETUlOIHRvIGRlbGV0ZSBhbnkgc25pcHBldCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICBjb25zdCBzbmlwcGV0ID0gY3JlYXRlTW9ja1NuaXBwZXQoeyB1c2VySWQ6IG93bmVySWQgfSk7XHJcbiAgICAgIHJlcG9zaXRvcnkuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoc25pcHBldCk7XHJcbiAgICAgIHJlcG9zaXRvcnkuZGVsZXRlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xyXG5cclxuICAgICAgLy8gQWN0XHJcbiAgICAgIGF3YWl0IHNlcnZpY2UuZGVsZXRlKCdzbmlwcGV0LWlkJywgb3RoZXJVc2VySWQsICdBRE1JTicpO1xyXG5cclxuICAgICAgLy8gQXNzZXJ0XHJcbiAgICAgIGV4cGVjdChyZXBvc2l0b3J5LmRlbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3NuaXBwZXQtaWQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gd2hlbiBzbmlwcGV0IG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gQXJyYW5nZVxyXG4gICAgICByZXBvc2l0b3J5LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG5cclxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XHJcbiAgICAgIGF3YWl0IGV4cGVjdChcclxuICAgICAgICBzZXJ2aWNlLmRlbGV0ZSgnbm9uZXhpc3RlbnQnLCBvd25lcklkLCAnVVNFUicpLFxyXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgLy8gU1RBVElTVElDU1xyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICBkZXNjcmliZSgnZ2V0VXNlclN0YXRzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdXNlciBzdGF0aXN0aWNzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIGNvbnN0IHN0YXRzID0ge1xyXG4gICAgICAgIHRvdGFsOiAxMCxcclxuICAgICAgICBwdWJsaWM6IDcsXHJcbiAgICAgICAgcHJpdmF0ZTogMyxcclxuICAgICAgICB0b3RhbFZpZXdzOiAxNTAsXHJcbiAgICAgICAgbW9zdFZpZXdlZDogbW9ja1NuaXBwZXQsXHJcbiAgICAgICAgbGF0ZXN0U25pcHBldDogbW9ja1NuaXBwZXQsXHJcbiAgICAgIH07XHJcbiAgICAgIHJlcG9zaXRvcnkuZ2V0VXNlclN0YXRzLm1vY2tSZXNvbHZlZFZhbHVlKHN0YXRzKTtcclxuXHJcbiAgICAgIC8vIEFjdFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldFVzZXJTdGF0cyhvd25lcklkKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHN0YXRzKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY291bnRVc2VyU25pcHBldHMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb3VudCBvZiB1c2VyIHNuaXBwZXRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBBcnJhbmdlXHJcbiAgICAgIHJlcG9zaXRvcnkuY291bnRCeVVzZXJJZC5tb2NrUmVzb2x2ZWRWYWx1ZSg0Mik7XHJcblxyXG4gICAgICAvLyBBY3RcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jb3VudFVzZXJTbmlwcGV0cyhvd25lcklkKTtcclxuXHJcbiAgICAgIC8vIEFzc2VydFxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKDQyKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9