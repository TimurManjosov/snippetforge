{"file":"C:\\Users\\timur\\Programming\\Projects\\snippetforge\\apps\\api\\test\\setup\\test-utils.ts","mappings":"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","names":[],"sources":["C:\\Users\\timur\\Programming\\Projects\\snippetforge\\apps\\api\\test\\setup\\test-utils.ts"],"sourcesContent":["// test/setup/test-utils.ts\r\n\r\nimport { INestApplication, ModuleMetadata, Type } from '@nestjs/common';\r\nimport { Test, TestingModule } from '@nestjs/testing';\r\nimport {\r\n  AllExceptionsFilter,\r\n  HttpExceptionFilter,\r\n} from '../../src/shared/filters';\r\n\r\n/**\r\n * Test Utilities\r\n *\r\n * Wiederverwendbare Funktionen für Tests.\r\n * Reduziert Boilerplate und sorgt für Konsistenz.\r\n */\r\n\r\n/**\r\n * Erstellt ein NestJS Testing Module mit Standard-Konfiguration\r\n *\r\n * @param metadata - Module Metadata (providers, imports, etc.)\r\n * @returns Kompiliertes Test-Module\r\n */\r\nexport async function createTestingModule(\r\n  metadata: ModuleMetadata,\r\n): Promise<TestingModule> {\r\n  return Test.createTestingModule(metadata).compile();\r\n}\r\n\r\n/**\r\n * Erstellt eine vollständige NestJS Test-Application\r\n * Verwendet für E2E Tests\r\n *\r\n * @param moduleType - Das zu testende Module\r\n * @returns Initialisierte Nest Application\r\n */\r\nexport async function createTestingApp(\r\n  moduleType: Type<unknown>,\r\n): Promise<INestApplication> {\r\n  const moduleFixture = await Test.createTestingModule({\r\n    imports: [moduleType],\r\n  }).compile();\r\n\r\n  const app = moduleFixture.createNestApplication();\r\n\r\n  // Gleiche Konfiguration wie Production\r\n  app.setGlobalPrefix('api');\r\n  app.useGlobalFilters(new AllExceptionsFilter(), new HttpExceptionFilter());\r\n\r\n  await app.init();\r\n  return app;\r\n}\r\n\r\n/**\r\n * Wartet eine bestimmte Zeit (für async Tests)\r\n */\r\nexport function delay(ms: number): Promise<void> {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * Generiert eine zufällige Email für Tests\r\n * Verhindert Konflikte bei parallelen Tests\r\n */\r\nexport function randomEmail(): string {\r\n  const timestamp = Date.now();\r\n  const random = Math.random().toString(36).substring(2, 8);\r\n  return `test-${timestamp}-${random}@test.com`;\r\n}\r\n\r\n/**\r\n * Generiert einen zufälligen Username für Tests\r\n */\r\nexport function randomUsername(): string {\r\n  const timestamp = Date.now();\r\n  const random = Math.random().toString(36).substring(2, 8);\r\n  return `user_${timestamp}_${random}`.substring(0, 30);\r\n}\r\n\r\n/**\r\n * Mock Request Object für Filter/Guard Tests\r\n */\r\nexport function createMockRequest(\r\n  overrides: Partial<{\r\n    url: string;\r\n    method: string;\r\n    headers: Record<string, string>;\r\n    user: unknown;\r\n  }> = {},\r\n) {\r\n  return {\r\n    url: '/api/test',\r\n    method: 'GET',\r\n    headers: {},\r\n    user: undefined,\r\n    ...overrides,\r\n  };\r\n}\r\n\r\n/**\r\n * Mock Response Object für Filter Tests\r\n */\r\nexport function createMockResponse() {\r\n  const response = {\r\n    status: jest.fn().mockReturnThis(),\r\n    json: jest.fn().mockReturnThis(),\r\n    send: jest.fn().mockReturnThis(),\r\n  };\r\n  return response;\r\n}\r\n\r\n/**\r\n * Mock Execution Context für Guards\r\n */\r\nexport function createMockExecutionContext(\r\n  overrides: {\r\n    request?: Partial<{ user: unknown; headers: Record<string, string> }>;\r\n    handler?: unknown;\r\n    class?: unknown;\r\n  } = {},\r\n) {\r\n  const mockRequest = {\r\n    user: undefined,\r\n    headers: {},\r\n    ...overrides.request,\r\n  };\r\n\r\n  return {\r\n    switchToHttp: () => ({\r\n      getRequest: () => mockRequest,\r\n      getResponse: () => createMockResponse(),\r\n    }),\r\n    getHandler: () => overrides.handler || jest.fn(),\r\n    getClass: () => overrides.class || class TestController {},\r\n  };\r\n}\r\n\r\n/**\r\n * Mock ArgumentsHost für Filters\r\n */\r\nexport function createMockArgumentsHost(\r\n  request = createMockRequest(),\r\n  response = createMockResponse(),\r\n) {\r\n  return {\r\n    switchToHttp: () => ({\r\n      getRequest: () => request,\r\n      getResponse: () => response,\r\n    }),\r\n    getArgs: () => [],\r\n    getArgByIndex: () => undefined,\r\n    switchToRpc: () => ({ getData: () => undefined }),\r\n    switchToWs: () => ({ getData: () => undefined }),\r\n    getType: () => 'http' as const,\r\n  };\r\n}\r\n"],"version":3}