2a87dc964423d05dcd21b8c0be02cf1d
"use strict";
// src/modules/auth/decorators/current-user.decorator.ts
Object.defineProperty(exports, "__esModule", { value: true });
exports.CurrentUser = void 0;
const common_1 = require("@nestjs/common");
/**
 * @CurrentUser() Decorator - Injiziert aktuellen User in Controller-Methode
 *
 * WARUM als Decorator statt request.user?
 * 1. Typsicherheit:  Decorator gibt SafeUser zur端ck, nicht any
 * 2. Clean Code: Controller-Methode zeigt klar welche Daten sie braucht
 * 3. Testbar: Decorator kann gemockt werden
 *
 * VERWENDUNG:
 * @Get('me')
 * @UseGuards(JwtAuthGuard)
 * getProfile(@CurrentUser() user: SafeUser) {
 *   return user
 * }
 *
 * // Mit Property-Zugriff
 * @Get('my-email')
 * @UseGuards(JwtAuthGuard)
 * getEmail(@CurrentUser('email') email: string) {
 *   return { email }
 * }
 *
 * VORAUSSETZUNG: JwtAuthGuard muss aktiv sein!
 * Sonst ist request.user undefined
 */
exports.CurrentUser = (0, common_1.createParamDecorator)(
/**
 * @param data - Optionaler Property-Name (z.B. 'email', 'id')
 * @param ctx - Execution Context
 * @returns User oder User-Property
 */
(data, ctx) => {
    const request = ctx.switchToHttp().getRequest();
    const user = request.user;
    // Wenn kein User (Guard nicht aktiv?), undefined zur端ckgeben
    if (!user) {
        return undefined;
    }
    // Wenn Property angefragt, nur diese zur端ckgeben
    if (data) {
        return user[data];
    }
    // Sonst ganzen User zur端ckgeben
    return user;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aW11clxcUHJvZ3JhbW1pbmdcXFByb2plY3RzXFxzbmlwcGV0Zm9yZ2VcXGFwcHNcXGFwaVxcc3JjXFxtb2R1bGVzXFxhdXRoXFxkZWNvcmF0b3JzXFxjdXJyZW50LXVzZXIuZGVjb3JhdG9yLnRzIiwibWFwcGluZ3MiOiI7QUFBQSx3REFBd0Q7OztBQUV4RCwyQ0FBd0U7QUFJeEU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXdCRztBQUNVLFFBQUEsV0FBVyxHQUFHLElBQUEsNkJBQW9CO0FBQzdDOzs7O0dBSUc7QUFDSCxDQUFDLElBQWdDLEVBQUUsR0FBcUIsRUFBRSxFQUFFO0lBQzFELE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxVQUFVLEVBQVcsQ0FBQztJQUN6RCxNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsSUFBNEIsQ0FBQztJQUVsRCw2REFBNkQ7SUFDN0QsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ1YsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVELGlEQUFpRDtJQUNqRCxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ1QsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELGdDQUFnQztJQUNoQyxPQUFPLElBQUksQ0FBQztBQUNkLENBQUMsQ0FDRixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGltdXJcXFByb2dyYW1taW5nXFxQcm9qZWN0c1xcc25pcHBldGZvcmdlXFxhcHBzXFxhcGlcXHNyY1xcbW9kdWxlc1xcYXV0aFxcZGVjb3JhdG9yc1xcY3VycmVudC11c2VyLmRlY29yYXRvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbW9kdWxlcy9hdXRoL2RlY29yYXRvcnMvY3VycmVudC11c2VyLmRlY29yYXRvci50c1xyXG5cclxuaW1wb3J0IHsgY3JlYXRlUGFyYW1EZWNvcmF0b3IsIEV4ZWN1dGlvbkNvbnRleHQgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XHJcbmltcG9ydCB7IFJlcXVlc3QgfSBmcm9tICdleHByZXNzJztcclxuaW1wb3J0IHsgdHlwZSBTYWZlVXNlciB9IGZyb20gJy4uLy4uL3VzZXJzJztcclxuXHJcbi8qKlxyXG4gKiBAQ3VycmVudFVzZXIoKSBEZWNvcmF0b3IgLSBJbmppemllcnQgYWt0dWVsbGVuIFVzZXIgaW4gQ29udHJvbGxlci1NZXRob2RlXHJcbiAqXHJcbiAqIFdBUlVNIGFscyBEZWNvcmF0b3Igc3RhdHQgcmVxdWVzdC51c2VyP1xyXG4gKiAxLiBUeXBzaWNoZXJoZWl0OiAgRGVjb3JhdG9yIGdpYnQgU2FmZVVzZXIgenVyw7xjaywgbmljaHQgYW55XHJcbiAqIDIuIENsZWFuIENvZGU6IENvbnRyb2xsZXItTWV0aG9kZSB6ZWlndCBrbGFyIHdlbGNoZSBEYXRlbiBzaWUgYnJhdWNodFxyXG4gKiAzLiBUZXN0YmFyOiBEZWNvcmF0b3Iga2FubiBnZW1vY2t0IHdlcmRlblxyXG4gKlxyXG4gKiBWRVJXRU5EVU5HOlxyXG4gKiBAR2V0KCdtZScpXHJcbiAqIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxyXG4gKiBnZXRQcm9maWxlKEBDdXJyZW50VXNlcigpIHVzZXI6IFNhZmVVc2VyKSB7XHJcbiAqICAgcmV0dXJuIHVzZXJcclxuICogfVxyXG4gKlxyXG4gKiAvLyBNaXQgUHJvcGVydHktWnVncmlmZlxyXG4gKiBAR2V0KCdteS1lbWFpbCcpXHJcbiAqIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkKVxyXG4gKiBnZXRFbWFpbChAQ3VycmVudFVzZXIoJ2VtYWlsJykgZW1haWw6IHN0cmluZykge1xyXG4gKiAgIHJldHVybiB7IGVtYWlsIH1cclxuICogfVxyXG4gKlxyXG4gKiBWT1JBVVNTRVRaVU5HOiBKd3RBdXRoR3VhcmQgbXVzcyBha3RpdiBzZWluIVxyXG4gKiBTb25zdCBpc3QgcmVxdWVzdC51c2VyIHVuZGVmaW5lZFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IEN1cnJlbnRVc2VyID0gY3JlYXRlUGFyYW1EZWNvcmF0b3IoXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIGRhdGEgLSBPcHRpb25hbGVyIFByb3BlcnR5LU5hbWUgKHouQi4gJ2VtYWlsJywgJ2lkJylcclxuICAgKiBAcGFyYW0gY3R4IC0gRXhlY3V0aW9uIENvbnRleHRcclxuICAgKiBAcmV0dXJucyBVc2VyIG9kZXIgVXNlci1Qcm9wZXJ0eVxyXG4gICAqL1xyXG4gIChkYXRhOiBrZXlvZiBTYWZlVXNlciB8IHVuZGVmaW5lZCwgY3R4OiBFeGVjdXRpb25Db250ZXh0KSA9PiB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gY3R4LnN3aXRjaFRvSHR0cCgpLmdldFJlcXVlc3Q8UmVxdWVzdD4oKTtcclxuICAgIGNvbnN0IHVzZXIgPSByZXF1ZXN0LnVzZXIgYXMgU2FmZVVzZXIgfCB1bmRlZmluZWQ7XHJcblxyXG4gICAgLy8gV2VubiBrZWluIFVzZXIgKEd1YXJkIG5pY2h0IGFrdGl2PyksIHVuZGVmaW5lZCB6dXLDvGNrZ2ViZW5cclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFdlbm4gUHJvcGVydHkgYW5nZWZyYWd0LCBudXIgZGllc2UgenVyw7xja2dlYmVuXHJcbiAgICBpZiAoZGF0YSkge1xyXG4gICAgICByZXR1cm4gdXNlcltkYXRhXTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTb25zdCBnYW56ZW4gVXNlciB6dXLDvGNrZ2ViZW5cclxuICAgIHJldHVybiB1c2VyO1xyXG4gIH0sXHJcbik7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==