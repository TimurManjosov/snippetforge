{"file":"C:\\Users\\timur\\Programming\\Projects\\snippetforge\\apps\\api\\test\\unit\\filters\\http-exception.filter.spec.ts","mappings":";AAAA,0DAA0D;AAC1D,4DAA4D;AAC5D,kDAAkD;;AAElD,2CAOwB;AACxB,6DAA2D;AAC3D,6FAAwF;AACxF,uDAIgC;AAEhC;;;;;;;GAOG;AACH,QAAQ,CAAC,qBAAqB,EAAE,GAAG,EAAE;IACnC,IAAI,MAA2B,CAAC;IAChC,IAAI,YAAmD,CAAC;IACxD,IAAI,WAAiD,CAAC;IAEtD,UAAU,CAAC,GAAG,EAAE;QACd,MAAM,GAAG,IAAI,2CAAmB,EAAE,CAAC;QACnC,YAAY,GAAG,IAAA,+BAAkB,GAAE,CAAC;QACpC,WAAW,GAAG,IAAA,8BAAiB,GAAE,CAAC;IACpC,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,OAAO,EAAE,GAAG,EAAE;QACrB,QAAQ,CAAC,iBAAiB,EAAE,GAAG,EAAE;YAC/B,EAAE,CAAC,kDAAkD,EAAE,GAAG,EAAE;gBAC1D,UAAU;gBACV,MAAM,SAAS,GAAG,IAAI,4BAAmB,CAAC,YAAY,CAAC,CAAC;gBACxD,MAAM,IAAI,GAAG,IAAA,oCAAuB,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;gBAEhE,MAAM;gBACN,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,IAAW,CAAC,CAAC;gBAErC,SAAS;gBACT,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,oBAAoB,CAC9C,mBAAU,CAAC,WAAW,CACvB,CAAC;gBACF,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,oBAAoB,CAC5C,MAAM,CAAC,gBAAgB,CAAC;oBACtB,OAAO,EAAE,KAAK;oBACd,KAAK,EAAE,MAAM,CAAC,gBAAgB,CAAC;wBAC7B,OAAO,EAAE,YAAY;wBACrB,UAAU,EAAE,GAAG;qBAChB,CAAC;oBACF,IAAI,EAAE,MAAM,CAAC,gBAAgB,CAAC;wBAC5B,IAAI,EAAE,WAAW,CAAC,GAAG;wBACrB,MAAM,EAAE,WAAW,CAAC,MAAM;wBAC1B,SAAS,EAAE,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC;qBAC9B,CAAC;iBACH,CAAC,CACH,CAAC;YACJ,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,sBAAsB,EAAE,GAAG,EAAE;YACpC,EAAE,CAAC,6DAA6D,EAAE,GAAG,EAAE;gBACrE,UAAU;gBACV,MAAM,SAAS,GAAG,IAAI,8BAAqB,CACzC,8BAA8B,CAC/B,CAAC;gBACF,MAAM,IAAI,GAAG,IAAA,oCAAuB,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;gBAEhE,MAAM;gBACN,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,IAAW,CAAC,CAAC;gBAErC,SAAS;gBACT,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,oBAAoB,CAC5C,MAAM,CAAC,gBAAgB,CAAC;oBACtB,KAAK,EAAE,MAAM,CAAC,gBAAgB,CAAC;wBAC7B,IAAI,EAAE,sBAAU,CAAC,kBAAkB;qBACpC,CAAC;iBACH,CAAC,CACH,CAAC;YACJ,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,uDAAuD,EAAE,GAAG,EAAE;gBAC/D,UAAU;gBACV,MAAM,SAAS,GAAG,IAAI,8BAAqB,CAAC,mBAAmB,CAAC,CAAC;gBACjE,MAAM,IAAI,GAAG,IAAA,oCAAuB,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;gBAEhE,MAAM;gBACN,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,IAAW,CAAC,CAAC;gBAErC,SAAS;gBACT,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,oBAAoB,CAC5C,MAAM,CAAC,gBAAgB,CAAC;oBACtB,KAAK,EAAE,MAAM,CAAC,gBAAgB,CAAC;wBAC7B,IAAI,EAAE,sBAAU,CAAC,kBAAkB;qBACpC,CAAC;iBACH,CAAC,CACH,CAAC;YACJ,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,yDAAyD,EAAE,GAAG,EAAE;gBACjE,UAAU;gBACV,MAAM,SAAS,GAAG,IAAI,8BAAqB,CACzC,2BAA2B,CAC5B,CAAC;gBACF,MAAM,IAAI,GAAG,IAAA,oCAAuB,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;gBAEhE,MAAM;gBACN,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,IAAW,CAAC,CAAC;gBAErC,SAAS;gBACT,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,oBAAoB,CAC5C,MAAM,CAAC,gBAAgB,CAAC;oBACtB,KAAK,EAAE,MAAM,CAAC,gBAAgB,CAAC;wBAC7B,IAAI,EAAE,sBAAU,CAAC,wBAAwB;qBAC1C,CAAC;iBACH,CAAC,CACH,CAAC;YACJ,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,mDAAmD,EAAE,GAAG,EAAE;gBAC3D,UAAU;gBACV,MAAM,SAAS,GAAG,IAAI,0BAAiB,CAAC,6BAA6B,CAAC,CAAC;gBACvE,MAAM,IAAI,GAAG,IAAA,oCAAuB,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;gBAEhE,MAAM;gBACN,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,IAAW,CAAC,CAAC;gBAErC,SAAS;gBACT,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,oBAAoB,CAC5C,MAAM,CAAC,gBAAgB,CAAC;oBACtB,KAAK,EAAE,MAAM,CAAC,gBAAgB,CAAC;wBAC7B,IAAI,EAAE,sBAAU,CAAC,iBAAiB;qBACnC,CAAC;iBACH,CAAC,CACH,CAAC;YACJ,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,gDAAgD,EAAE,GAAG,EAAE;gBACxD,UAAU;gBACV,MAAM,SAAS,GAAG,IAAI,0BAAiB,CAAC,gBAAgB,CAAC,CAAC;gBAC1D,MAAM,IAAI,GAAG,IAAA,oCAAuB,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;gBAEhE,MAAM;gBACN,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,IAAW,CAAC,CAAC;gBAErC,SAAS;gBACT,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,oBAAoB,CAC5C,MAAM,CAAC,gBAAgB,CAAC;oBACtB,KAAK,EAAE,MAAM,CAAC,gBAAgB,CAAC;wBAC7B,IAAI,EAAE,sBAAU,CAAC,cAAc;qBAChC,CAAC;iBACH,CAAC,CACH,CAAC;YACJ,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,2BAA2B,EAAE,GAAG,EAAE;YACzC,EAAE,CAAC,+CAA+C,EAAE,GAAG,EAAE;gBACvD,UAAU;gBACV,MAAM,SAAS,GAAG,IAAI,4BAAmB,CAAC;oBACxC,OAAO,EAAE,mBAAmB;oBAC5B,IAAI,EAAE,kBAAkB;oBACxB,MAAM,EAAE;wBACN,KAAK,EAAE,CAAC,sBAAsB,CAAC;wBAC/B,QAAQ,EAAE,CAAC,WAAW,CAAC;qBACxB;iBACF,CAAC,CAAC;gBACH,MAAM,IAAI,GAAG,IAAA,oCAAuB,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;gBAEhE,MAAM;gBACN,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,IAAW,CAAC,CAAC;gBAErC,SAAS;gBACT,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,oBAAoB,CAC5C,MAAM,CAAC,gBAAgB,CAAC;oBACtB,KAAK,EAAE,MAAM,CAAC,gBAAgB,CAAC;wBAC7B,OAAO,EAAE,MAAM,CAAC,gBAAgB,CAAC;4BAC/B,MAAM,EAAE,MAAM,CAAC,gBAAgB,CAAC;gCAC9B,KAAK,EAAE,CAAC,sBAAsB,CAAC;gCAC/B,QAAQ,EAAE,CAAC,WAAW,CAAC;6BACxB,CAAC;yBACH,CAAC;qBACH,CAAC;iBACH,CAAC,CACH,CAAC;YACJ,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;YACjC,MAAM,WAAW,GAAG;gBAClB,EAAE,MAAM,EAAE,mBAAU,CAAC,WAAW,EAAE,IAAI,EAAE,aAAa,EAAE;gBACvD,EAAE,MAAM,EAAE,mBAAU,CAAC,YAAY,EAAE,IAAI,EAAE,cAAc,EAAE;gBACzD,EAAE,MAAM,EAAE,mBAAU,CAAC,SAAS,EAAE,IAAI,EAAE,WAAW,EAAE;gBACnD,EAAE,MAAM,EAAE,mBAAU,CAAC,SAAS,EAAE,IAAI,EAAE,WAAW,EAAE;gBACnD,EAAE,MAAM,EAAE,mBAAU,CAAC,QAAQ,EAAE,IAAI,EAAE,UAAU,EAAE;gBACjD;oBACE,MAAM,EAAE,mBAAU,CAAC,qBAAqB;oBACxC,IAAI,EAAE,uBAAuB;iBAC9B;aACF,CAAC;YAEF,WAAW,CAAC,OAAO,CAAC,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE;gBACvC,EAAE,CAAC,iBAAiB,MAAM,KAAK,IAAI,GAAG,EAAE,GAAG,EAAE;oBAC3C,UAAU;oBACV,MAAM,SAAS,GAAG,IAAI,sBAAa,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;oBACpD,MAAM,IAAI,GAAG,IAAA,oCAAuB,EAAC,WAAW,EAAE,YAAY,CAAC,CAAC;oBAEhE,MAAM;oBACN,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE,IAAW,CAAC,CAAC;oBAErC,SAAS;oBACT,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC;oBACzD,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,oBAAoB,CAC5C,MAAM,CAAC,gBAAgB,CAAC;wBACtB,KAAK,EAAE,MAAM,CAAC,gBAAgB,CAAC;4BAC7B,UAAU,EAAE,MAAM;yBACnB,CAAC;qBACH,CAAC,CACH,CAAC;gBACJ,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\timur\\Programming\\Projects\\snippetforge\\apps\\api\\test\\unit\\filters\\http-exception.filter.spec.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-argument */\r\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\r\n// test/unit/filters/http-exception.filter.spec.ts\r\n\r\nimport {\r\n  BadRequestException,\r\n  ConflictException,\r\n  HttpException,\r\n  HttpStatus,\r\n  NotFoundException,\r\n  UnauthorizedException,\r\n} from '@nestjs/common';\r\nimport { ErrorCodes } from '../../../src/shared/constants';\r\nimport { HttpExceptionFilter } from '../../../src/shared/filters/http-exception.filter';\r\nimport {\r\n  createMockArgumentsHost,\r\n  createMockRequest,\r\n  createMockResponse,\r\n} from '../../setup/test-utils';\r\n\r\n/**\r\n * HttpExceptionFilter Unit Tests\r\n *\r\n * Testet:\r\n * - Verschiedene HTTP Status Codes\r\n * - Error Code Inferenz\r\n * - Response Format\r\n */\r\ndescribe('HttpExceptionFilter', () => {\r\n  let filter: HttpExceptionFilter;\r\n  let mockResponse: ReturnType<typeof createMockResponse>;\r\n  let mockRequest: ReturnType<typeof createMockRequest>;\r\n\r\n  beforeEach(() => {\r\n    filter = new HttpExceptionFilter();\r\n    mockResponse = createMockResponse();\r\n    mockRequest = createMockRequest();\r\n  });\r\n\r\n  afterEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('catch', () => {\r\n    describe('response format', () => {\r\n      it('should return standardized error response format', () => {\r\n        // Arrange\r\n        const exception = new BadRequestException('Test error');\r\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\r\n\r\n        // Act\r\n        filter.catch(exception, host as any);\r\n\r\n        // Assert\r\n        expect(mockResponse.status).toHaveBeenCalledWith(\r\n          HttpStatus.BAD_REQUEST,\r\n        );\r\n        expect(mockResponse.json).toHaveBeenCalledWith(\r\n          expect.objectContaining({\r\n            success: false,\r\n            error: expect.objectContaining({\r\n              message: 'Test error',\r\n              statusCode: 400,\r\n            }),\r\n            meta: expect.objectContaining({\r\n              path: mockRequest.url,\r\n              method: mockRequest.method,\r\n              timestamp: expect.any(String),\r\n            }),\r\n          }),\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('error code inference', () => {\r\n      it('should infer AUTH_TOKEN_MISSING for \"missing token\" message', () => {\r\n        // Arrange\r\n        const exception = new UnauthorizedException(\r\n          'Missing authentication token',\r\n        );\r\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\r\n\r\n        // Act\r\n        filter.catch(exception, host as any);\r\n\r\n        // Assert\r\n        expect(mockResponse.json).toHaveBeenCalledWith(\r\n          expect.objectContaining({\r\n            error: expect.objectContaining({\r\n              code: ErrorCodes.AUTH_TOKEN_MISSING,\r\n            }),\r\n          }),\r\n        );\r\n      });\r\n\r\n      it('should infer AUTH_TOKEN_EXPIRED for \"expired\" message', () => {\r\n        // Arrange\r\n        const exception = new UnauthorizedException('Token has expired');\r\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\r\n\r\n        // Act\r\n        filter.catch(exception, host as any);\r\n\r\n        // Assert\r\n        expect(mockResponse.json).toHaveBeenCalledWith(\r\n          expect.objectContaining({\r\n            error: expect.objectContaining({\r\n              code: ErrorCodes.AUTH_TOKEN_EXPIRED,\r\n            }),\r\n          }),\r\n        );\r\n      });\r\n\r\n      it('should infer AUTH_INVALID_CREDENTIALS for login failure', () => {\r\n        // Arrange\r\n        const exception = new UnauthorizedException(\r\n          'Invalid email or password',\r\n        );\r\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\r\n\r\n        // Act\r\n        filter.catch(exception, host as any);\r\n\r\n        // Assert\r\n        expect(mockResponse.json).toHaveBeenCalledWith(\r\n          expect.objectContaining({\r\n            error: expect.objectContaining({\r\n              code: ErrorCodes.AUTH_INVALID_CREDENTIALS,\r\n            }),\r\n          }),\r\n        );\r\n      });\r\n\r\n      it('should infer USER_EMAIL_EXISTS for email conflict', () => {\r\n        // Arrange\r\n        const exception = new ConflictException('Email is already registered');\r\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\r\n\r\n        // Act\r\n        filter.catch(exception, host as any);\r\n\r\n        // Assert\r\n        expect(mockResponse.json).toHaveBeenCalledWith(\r\n          expect.objectContaining({\r\n            error: expect.objectContaining({\r\n              code: ErrorCodes.USER_EMAIL_EXISTS,\r\n            }),\r\n          }),\r\n        );\r\n      });\r\n\r\n      it('should infer USER_NOT_FOUND for user not found', () => {\r\n        // Arrange\r\n        const exception = new NotFoundException('User not found');\r\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\r\n\r\n        // Act\r\n        filter.catch(exception, host as any);\r\n\r\n        // Assert\r\n        expect(mockResponse.json).toHaveBeenCalledWith(\r\n          expect.objectContaining({\r\n            error: expect.objectContaining({\r\n              code: ErrorCodes.USER_NOT_FOUND,\r\n            }),\r\n          }),\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('validation error handling', () => {\r\n      it('should include validation details in response', () => {\r\n        // Arrange\r\n        const exception = new BadRequestException({\r\n          message: 'Validation failed',\r\n          code: 'VALIDATION_ERROR',\r\n          errors: {\r\n            email: ['Invalid email format'],\r\n            password: ['Too short'],\r\n          },\r\n        });\r\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\r\n\r\n        // Act\r\n        filter.catch(exception, host as any);\r\n\r\n        // Assert\r\n        expect(mockResponse.json).toHaveBeenCalledWith(\r\n          expect.objectContaining({\r\n            error: expect.objectContaining({\r\n              details: expect.objectContaining({\r\n                fields: expect.objectContaining({\r\n                  email: ['Invalid email format'],\r\n                  password: ['Too short'],\r\n                }),\r\n              }),\r\n            }),\r\n          }),\r\n        );\r\n      });\r\n    });\r\n\r\n    describe('HTTP status codes', () => {\r\n      const statusCases = [\r\n        { status: HttpStatus.BAD_REQUEST, name: 'Bad Request' },\r\n        { status: HttpStatus.UNAUTHORIZED, name: 'Unauthorized' },\r\n        { status: HttpStatus.FORBIDDEN, name: 'Forbidden' },\r\n        { status: HttpStatus.NOT_FOUND, name: 'Not Found' },\r\n        { status: HttpStatus.CONFLICT, name: 'Conflict' },\r\n        {\r\n          status: HttpStatus.INTERNAL_SERVER_ERROR,\r\n          name: 'Internal Server Error',\r\n        },\r\n      ];\r\n\r\n      statusCases.forEach(({ status, name }) => {\r\n        it(`should handle ${status} (${name})`, () => {\r\n          // Arrange\r\n          const exception = new HttpException('Test', status);\r\n          const host = createMockArgumentsHost(mockRequest, mockResponse);\r\n\r\n          // Act\r\n          filter.catch(exception, host as any);\r\n\r\n          // Assert\r\n          expect(mockResponse.status).toHaveBeenCalledWith(status);\r\n          expect(mockResponse.json).toHaveBeenCalledWith(\r\n            expect.objectContaining({\r\n              error: expect.objectContaining({\r\n                statusCode: status,\r\n              }),\r\n            }),\r\n          );\r\n        });\r\n      });\r\n    });\r\n  });\r\n});\r\n"],"version":3}