2ee6884911d40490c40b7fabb76984eb
"use strict";
// src/modules/auth/auth.controller.ts
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var AuthController_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthController = void 0;
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const pipes_1 = require("../../shared/pipes");
const swagger_2 = require("../../shared/swagger");
const auth_service_1 = require("./auth.service");
const current_user_decorator_1 = require("./decorators/current-user.decorator");
const public_decorator_1 = require("./decorators/public.decorator");
const loginDto = __importStar(require("./dto/login.dto"));
const registerDto = __importStar(require("./dto/register.dto"));
const jwt_auth_guard_1 = require("./guards/jwt-auth.guard");
/**
 * AuthController - Authentication HTTP Endpoints
 *
 * ENDPOINTS:
 * - POST /api/auth/register - Neuen Account erstellen
 * - POST /api/auth/login    - Einloggen und Token erhalten
 * - GET  /api/auth/me       - Eigenes Profil abrufen
 *
 * SWAGGER DECORATORS:
 * - @ApiTags:  Gruppiert Endpoints unter "Auth"
 * - @ApiOperation: Beschreibt einzelnen Endpoint
 * - @ApiResponse: Dokumentiert mögliche Responses
 * - @ApiBody:  Dokumentiert Request Body
 * - @ApiBearerAuth: Markiert als Auth-geschützt
 */
let AuthController = AuthController_1 = class AuthController {
    authService;
    logger = new common_1.Logger(AuthController_1.name);
    constructor(authService) {
        this.authService = authService;
    }
    /**
     * POST /api/auth/register
     *
     * Registriert neuen User und gibt Tokens zurück.
     * User ist sofort eingeloggt (kein separater Login nötig).
     *
     * REQUEST BODY:
     * {
     *   "email": "user@example.com",
     *   "username": "johndoe",
     *   "password": "SecurePass123"
     * }
     *
     * RESPONSE (201 Created):
     * {
     *   "user": { "id": "...", "email": "...", ... },
     *   "tokens": { "accessToken": "...", "tokenType": "Bearer", "expiresIn": 900 }
     * }
     *
     * ERRORS:
     * - 400 Bad Request: Validation Error
     * - 409 Conflict: Email/Username already exists
     */
    async register(dto) {
        this.logger.debug(`Register request for: ${dto.email}`);
        return this.authService.register(dto);
    }
    /**
     * POST /api/auth/login
     *
     * Loggt User ein und gibt Tokens zurück.
     *
     * REQUEST BODY:
     * {
     *   "email": "user@example.com",
     *   "password": "SecurePass123"
     * }
     *
     * RESPONSE (200 OK):
     * {
     *   "user": { "id": "...", "email": "...", ... },
     *   "tokens": { "accessToken": "...", "tokenType": "Bearer", "expiresIn": 900 }
     * }
     *
     * ERRORS:
     * - 400 Bad Request: Validation Error
     * - 401 Unauthorized: Invalid credentials
     */
    async login(dto) {
        this.logger.debug(`Login request for: ${dto.email}`);
        return this.authService.login(dto);
    }
    /**
     * GET /api/auth/me
     *
     * Gibt aktuellen User zurück (aus JWT Token).
     * Erfordert gültigen Bearer Token.
     *
     * HEADERS:
     * Authorization: Bearer <token>
     *
     * RESPONSE (200 OK):
     * {
     *   "id": "uuid",
     *   "email": "user@example.com",
     *   "username": "johndoe",
     *   "bio": null,
     *   "avatarUrl": null,
     *   "role": "USER",
     *   "createdAt": "2026-01-04T...",
     *   "updatedAt": "2026-01-04T..."
     * }
     *
     * ERRORS:
     * - 401 Unauthorized: Missing/Invalid token
     */
    getMe(user) {
        this.logger.debug(`Get profile for user: ${user.id}`);
        return user;
    }
};
exports.AuthController = AuthController;
__decorate([
    (0, public_decorator_1.Public)() // Keine Auth nötig für Registration
    ,
    (0, common_1.Post)('register'),
    (0, common_1.HttpCode)(common_1.HttpStatus.CREATED),
    (0, swagger_1.ApiOperation)({
        summary: 'Register a new user account',
        description: `
Creates a new user account and returns authentication tokens.
The user is immediately logged in after registration.

**Password Requirements:**
- Minimum 8 characters
- At least one uppercase letter
- At least one lowercase letter
- At least one number

**Username Requirements:**
- 3-30 characters
- Only letters, numbers, and underscores
    `,
    }),
    (0, swagger_1.ApiBody)({
        type: swagger_2.RegisterRequestSchema,
        description: 'User registration data',
        examples: {
            valid: {
                summary: 'Valid registration',
                value: {
                    email: 'newuser@example.com',
                    username: 'newuser',
                    password: 'SecurePass123',
                },
            },
            minimal: {
                summary: 'Minimal valid data',
                value: {
                    email: 'min@test.com',
                    username: 'usr',
                    password: 'Test1234',
                },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.CREATED,
        description: 'User successfully registered',
        type: swagger_2.AuthResponseSchema,
    }),
    (0, swagger_1.ApiBadRequestResponse)({
        description: 'Validation error - Invalid input data',
        type: swagger_2.ValidationErrorResponseSchema,
    }),
    (0, swagger_1.ApiConflictResponse)({
        description: 'Email or username already exists',
        type: swagger_2.ConflictErrorResponseSchema,
    }),
    __param(0, (0, common_1.Body)(new pipes_1.ZodValidationPipe(registerDto.RegisterSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof registerDto !== "undefined" && registerDto.RegisterDto) === "function" ? _b : Object]),
    __metadata("design:returntype", typeof (_c = typeof Promise !== "undefined" && Promise) === "function" ? _c : Object)
], AuthController.prototype, "register", null);
__decorate([
    (0, public_decorator_1.Public)() // Keine Auth nötig für Login
    ,
    (0, common_1.Post)('login'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, swagger_1.ApiOperation)({
        summary: 'Login with email and password',
        description: `
Authenticates a user with email and password.
Returns JWT tokens on successful authentication.

**Token Usage:**
Include the access token in the Authorization header:
\`\`\`
Authorization: Bearer <accessToken>
\`\`\`
    `,
    }),
    (0, swagger_1.ApiBody)({
        type: swagger_2.LoginRequestSchema,
        description: 'User credentials',
        examples: {
            valid: {
                summary: 'Valid credentials',
                value: {
                    email: 'user@example.com',
                    password: 'SecurePass123',
                },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.OK,
        description: 'Login successful',
        type: swagger_2.AuthResponseSchema,
    }),
    (0, swagger_1.ApiBadRequestResponse)({
        description: 'Validation error - Invalid input format',
        type: swagger_2.ValidationErrorResponseSchema,
    }),
    (0, swagger_1.ApiUnauthorizedResponse)({
        description: 'Invalid email or password',
        type: swagger_2.UnauthorizedErrorResponseSchema,
    }),
    __param(0, (0, common_1.Body)(new pipes_1.ZodValidationPipe(loginDto.LoginSchema))),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_d = typeof loginDto !== "undefined" && loginDto.LoginDto) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], AuthController.prototype, "login", null);
__decorate([
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, common_1.Get)('me'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, swagger_1.ApiBearerAuth)('JWT-Auth'),
    (0, swagger_1.ApiOperation)({
        summary: 'Get current user profile',
        description: `
Returns the profile of the currently authenticated user.
Requires a valid JWT token in the Authorization header.

**Note:** This endpoint validates the token and returns fresh user data from the database.
    `,
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.OK,
        description: 'Current user profile',
        type: swagger_2.UserResponseSchema,
    }),
    (0, swagger_1.ApiUnauthorizedResponse)({
        description: 'Missing or invalid authentication token',
        type: swagger_2.UnauthorizedErrorResponseSchema,
    }),
    __param(0, (0, current_user_decorator_1.CurrentUser)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object]),
    __metadata("design:returntype", Object)
], AuthController.prototype, "getMe", null);
exports.AuthController = AuthController = AuthController_1 = __decorate([
    (0, swagger_1.ApiTags)('Auth'),
    (0, common_1.Controller)('auth'),
    __metadata("design:paramtypes", [typeof (_a = typeof auth_service_1.AuthService !== "undefined" && auth_service_1.AuthService) === "function" ? _a : Object])
], AuthController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aW11clxcUHJvZ3JhbW1pbmdcXFByb2plY3RzXFxzbmlwcGV0Zm9yZ2VcXGFwcHNcXGFwaVxcc3JjXFxtb2R1bGVzXFxhdXRoXFxhdXRoLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBLHNDQUFzQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFdEMsMkNBU3dCO0FBQ3hCLDZDQVN5QjtBQUN6Qiw4Q0FBdUQ7QUFDdkQsa0RBUThCO0FBRTlCLGlEQUE2QztBQUU3QyxnRkFBa0U7QUFDbEUsb0VBQXVEO0FBQ3ZELDBEQUE0QztBQUM1QyxnRUFBa0Q7QUFDbEQsNERBQXVEO0FBRXZEOzs7Ozs7Ozs7Ozs7OztHQWNHO0FBR0ksSUFBTSxjQUFjLHNCQUFwQixNQUFNLGNBQWM7SUFHSTtJQUZaLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyxnQkFBYyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTFELFlBQTZCLFdBQXdCO1FBQXhCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO0lBQUcsQ0FBQztJQUV6RDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztPQXNCRztJQXdERyxBQUFOLEtBQUssQ0FBQyxRQUFRLENBRVosR0FBNEI7UUFFNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMseUJBQXlCLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ3hELE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztPQW9CRztJQTJDRyxBQUFOLEtBQUssQ0FBQyxLQUFLLENBQzBDLEdBQXNCO1FBRXpFLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLHNCQUFzQixHQUFHLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNyRCxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lB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QyxJQUFJLEVBQUUseUNBQStCO0tBQ3RDLENBQUM7SUFFQyxXQUFBLElBQUEsYUFBSSxFQUFDLElBQUkseUJBQWlCLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUE7O3lEQUFNLFFBQVEsb0JBQVIsUUFBUSxDQUFDLFFBQVE7d0RBQ3hFLE9BQU8sb0JBQVAsT0FBTzsyQ0FHVDtBQWdERDtJQXRCQyxJQUFBLGtCQUFTLEVBQUMsNkJBQVksQ0FBQztJQUN2QixJQUFBLFlBQUcsRUFBQyxJQUFJLENBQUM7SUFDVCxJQUFBLGlCQUFRLEVBQUMsbUJBQVUsQ0FBQyxFQUFFLENBQUM7SUFDdkIsSUFBQSx1QkFBYSxFQUFDLFVBQVUsQ0FBQztJQUN6QixJQUFBLHNCQUFZLEVBQUM7UUFDWixPQUFPLEVBQUUsMEJBQTBCO1FBQ25DLFdBQVcsRUFBRTs7Ozs7S0FLWjtLQUNGLENBQUM7SUFDRCxJQUFBLHFCQUFXLEVBQUM7UUFDWCxNQUFNLEVBQUUsbUJBQVUsQ0FBQyxFQUFFO1FBQ3JCLFdBQVcsRUFBRSxzQkFBc0I7UUFDbkMsSUFBSSxFQUFFLDRCQUFrQjtLQUN6QixDQUFDO0lBQ0QsSUFBQSxpQ0FBdUIsRUFBQztRQUN2QixXQUFXLEVBQUUseUNBQXlDO1FBQ3RELElBQUksRUFBRSx5Q0FBK0I7S0FDdEMsQ0FBQztJQUNLLFdBQUEsSUFBQSxvQ0FBVyxHQUFFLENBQUE7Ozs7MkNBR25CO3lCQWxOVSxjQUFjO0lBRjFCLElBQUEsaUJBQU8sRUFBQyxNQUFNLENBQUM7SUFDZixJQUFBLG1CQUFVLEVBQUMsTUFBTSxDQUFDO3lEQUl5QiwwQkFBVyxvQkFBWCwwQkFBVztHQUgxQyxjQUFjLENBbU4xQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpbXVyXFxQcm9ncmFtbWluZ1xcUHJvamVjdHNcXHNuaXBwZXRmb3JnZVxcYXBwc1xcYXBpXFxzcmNcXG1vZHVsZXNcXGF1dGhcXGF1dGguY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbW9kdWxlcy9hdXRoL2F1dGguY29udHJvbGxlci50c1xyXG5cclxuaW1wb3J0IHtcclxuICBCb2R5LFxyXG4gIENvbnRyb2xsZXIsXHJcbiAgR2V0LFxyXG4gIEh0dHBDb2RlLFxyXG4gIEh0dHBTdGF0dXMsXHJcbiAgTG9nZ2VyLFxyXG4gIFBvc3QsXHJcbiAgVXNlR3VhcmRzLFxyXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcclxuaW1wb3J0IHtcclxuICBBcGlCYWRSZXF1ZXN0UmVzcG9uc2UsXHJcbiAgQXBpQmVhcmVyQXV0aCxcclxuICBBcGlCb2R5LFxyXG4gIEFwaUNvbmZsaWN0UmVzcG9uc2UsXHJcbiAgQXBpT3BlcmF0aW9uLFxyXG4gIEFwaVJlc3BvbnNlLFxyXG4gIEFwaVRhZ3MsXHJcbiAgQXBpVW5hdXRob3JpemVkUmVzcG9uc2UsXHJcbn0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcclxuaW1wb3J0IHsgWm9kVmFsaWRhdGlvblBpcGUgfSBmcm9tICcuLi8uLi9zaGFyZWQvcGlwZXMnO1xyXG5pbXBvcnQge1xyXG4gIEF1dGhSZXNwb25zZVNjaGVtYSxcclxuICBDb25mbGljdEVycm9yUmVzcG9uc2VTY2hlbWEsXHJcbiAgTG9naW5SZXF1ZXN0U2NoZW1hLFxyXG4gIFJlZ2lzdGVyUmVxdWVzdFNjaGVtYSxcclxuICBVbmF1dGhvcml6ZWRFcnJvclJlc3BvbnNlU2NoZW1hLFxyXG4gIFVzZXJSZXNwb25zZVNjaGVtYSxcclxuICBWYWxpZGF0aW9uRXJyb3JSZXNwb25zZVNjaGVtYSxcclxufSBmcm9tICcuLi8uLi9zaGFyZWQvc3dhZ2dlcic7XHJcbmltcG9ydCB7IHR5cGUgU2FmZVVzZXIgfSBmcm9tICcuLi91c2Vycyc7XHJcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnLi9hdXRoLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyB0eXBlIEF1dGhSZXNwb25zZSB9IGZyb20gJy4vYXV0aC50eXBlcyc7XHJcbmltcG9ydCB7IEN1cnJlbnRVc2VyIH0gZnJvbSAnLi9kZWNvcmF0b3JzL2N1cnJlbnQtdXNlci5kZWNvcmF0b3InO1xyXG5pbXBvcnQgeyBQdWJsaWMgfSBmcm9tICcuL2RlY29yYXRvcnMvcHVibGljLmRlY29yYXRvcic7XHJcbmltcG9ydCAqIGFzIGxvZ2luRHRvIGZyb20gJy4vZHRvL2xvZ2luLmR0byc7XHJcbmltcG9ydCAqIGFzIHJlZ2lzdGVyRHRvIGZyb20gJy4vZHRvL3JlZ2lzdGVyLmR0byc7XHJcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4vZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcclxuXHJcbi8qKlxyXG4gKiBBdXRoQ29udHJvbGxlciAtIEF1dGhlbnRpY2F0aW9uIEhUVFAgRW5kcG9pbnRzXHJcbiAqXHJcbiAqIEVORFBPSU5UUzpcclxuICogLSBQT1NUIC9hcGkvYXV0aC9yZWdpc3RlciAtIE5ldWVuIEFjY291bnQgZXJzdGVsbGVuXHJcbiAqIC0gUE9TVCAvYXBpL2F1dGgvbG9naW4gICAgLSBFaW5sb2dnZW4gdW5kIFRva2VuIGVyaGFsdGVuXHJcbiAqIC0gR0VUICAvYXBpL2F1dGgvbWUgICAgICAgLSBFaWdlbmVzIFByb2ZpbCBhYnJ1ZmVuXHJcbiAqXHJcbiAqIFNXQUdHRVIgREVDT1JBVE9SUzpcclxuICogLSBAQXBpVGFnczogIEdydXBwaWVydCBFbmRwb2ludHMgdW50ZXIgXCJBdXRoXCJcclxuICogLSBAQXBpT3BlcmF0aW9uOiBCZXNjaHJlaWJ0IGVpbnplbG5lbiBFbmRwb2ludFxyXG4gKiAtIEBBcGlSZXNwb25zZTogRG9rdW1lbnRpZXJ0IG3DtmdsaWNoZSBSZXNwb25zZXNcclxuICogLSBAQXBpQm9keTogIERva3VtZW50aWVydCBSZXF1ZXN0IEJvZHlcclxuICogLSBAQXBpQmVhcmVyQXV0aDogTWFya2llcnQgYWxzIEF1dGgtZ2VzY2jDvHR6dFxyXG4gKi9cclxuQEFwaVRhZ3MoJ0F1dGgnKVxyXG5AQ29udHJvbGxlcignYXV0aCcpXHJcbmV4cG9ydCBjbGFzcyBBdXRoQ29udHJvbGxlciB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKEF1dGhDb250cm9sbGVyLm5hbWUpO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGF1dGhTZXJ2aWNlOiBBdXRoU2VydmljZSkge31cclxuXHJcbiAgLyoqXHJcbiAgICogUE9TVCAvYXBpL2F1dGgvcmVnaXN0ZXJcclxuICAgKlxyXG4gICAqIFJlZ2lzdHJpZXJ0IG5ldWVuIFVzZXIgdW5kIGdpYnQgVG9rZW5zIHp1csO8Y2suXHJcbiAgICogVXNlciBpc3Qgc29mb3J0IGVpbmdlbG9nZ3QgKGtlaW4gc2VwYXJhdGVyIExvZ2luIG7DtnRpZykuXHJcbiAgICpcclxuICAgKiBSRVFVRVNUIEJPRFk6XHJcbiAgICoge1xyXG4gICAqICAgXCJlbWFpbFwiOiBcInVzZXJAZXhhbXBsZS5jb21cIixcclxuICAgKiAgIFwidXNlcm5hbWVcIjogXCJqb2huZG9lXCIsXHJcbiAgICogICBcInBhc3N3b3JkXCI6IFwiU2VjdXJlUGFzczEyM1wiXHJcbiAgICogfVxyXG4gICAqXHJcbiAgICogUkVTUE9OU0UgKDIwMSBDcmVhdGVkKTpcclxuICAgKiB7XHJcbiAgICogICBcInVzZXJcIjogeyBcImlkXCI6IFwiLi4uXCIsIFwiZW1haWxcIjogXCIuLi5cIiwgLi4uIH0sXHJcbiAgICogICBcInRva2Vuc1wiOiB7IFwiYWNjZXNzVG9rZW5cIjogXCIuLi5cIiwgXCJ0b2tlblR5cGVcIjogXCJCZWFyZXJcIiwgXCJleHBpcmVzSW5cIjogOTAwIH1cclxuICAgKiB9XHJcbiAgICpcclxuICAgKiBFUlJPUlM6XHJcbiAgICogLSA0MDAgQmFkIFJlcXVlc3Q6IFZhbGlkYXRpb24gRXJyb3JcclxuICAgKiAtIDQwOSBDb25mbGljdDogRW1haWwvVXNlcm5hbWUgYWxyZWFkeSBleGlzdHNcclxuICAgKi9cclxuICBAUHVibGljKCkgLy8gS2VpbmUgQXV0aCBuw7Z0aWcgZsO8ciBSZWdpc3RyYXRpb25cclxuICBAUG9zdCgncmVnaXN0ZXInKVxyXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLkNSRUFURUQpXHJcbiAgQEFwaU9wZXJhdGlvbih7XHJcbiAgICBzdW1tYXJ5OiAnUmVnaXN0ZXIgYSBuZXcgdXNlciBhY2NvdW50JyxcclxuICAgIGRlc2NyaXB0aW9uOiBgXHJcbkNyZWF0ZXMgYSBuZXcgdXNlciBhY2NvdW50IGFuZCByZXR1cm5zIGF1dGhlbnRpY2F0aW9uIHRva2Vucy5cclxuVGhlIHVzZXIgaXMgaW1tZWRpYXRlbHkgbG9nZ2VkIGluIGFmdGVyIHJlZ2lzdHJhdGlvbi5cclxuXHJcbioqUGFzc3dvcmQgUmVxdWlyZW1lbnRzOioqXHJcbi0gTWluaW11bSA4IGNoYXJhY3RlcnNcclxuLSBBdCBsZWFzdCBvbmUgdXBwZXJjYXNlIGxldHRlclxyXG4tIEF0IGxlYXN0IG9uZSBsb3dlcmNhc2UgbGV0dGVyXHJcbi0gQXQgbGVhc3Qgb25lIG51bWJlclxyXG5cclxuKipVc2VybmFtZSBSZXF1aXJlbWVudHM6KipcclxuLSAzLTMwIGNoYXJhY3RlcnNcclxuLSBPbmx5IGxldHRlcnMsIG51bWJlcnMsIGFuZCB1bmRlcnNjb3Jlc1xyXG4gICAgYCxcclxuICB9KVxyXG4gIEBBcGlCb2R5KHtcclxuICAgIHR5cGU6IFJlZ2lzdGVyUmVxdWVzdFNjaGVtYSxcclxuICAgIGRlc2NyaXB0aW9uOiAnVXNlciByZWdpc3RyYXRpb24gZGF0YScsXHJcbiAgICBleGFtcGxlczoge1xyXG4gICAgICB2YWxpZDoge1xyXG4gICAgICAgIHN1bW1hcnk6ICdWYWxpZCByZWdpc3RyYXRpb24nLFxyXG4gICAgICAgIHZhbHVlOiB7XHJcbiAgICAgICAgICBlbWFpbDogJ25ld3VzZXJAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgdXNlcm5hbWU6ICduZXd1c2VyJyxcclxuICAgICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMycsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgICAgbWluaW1hbDoge1xyXG4gICAgICAgIHN1bW1hcnk6ICdNaW5pbWFsIHZhbGlkIGRhdGEnLFxyXG4gICAgICAgIHZhbHVlOiB7XHJcbiAgICAgICAgICBlbWFpbDogJ21pbkB0ZXN0LmNvbScsXHJcbiAgICAgICAgICB1c2VybmFtZTogJ3VzcicsXHJcbiAgICAgICAgICBwYXNzd29yZDogJ1Rlc3QxMjM0JyxcclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICB9KVxyXG4gIEBBcGlSZXNwb25zZSh7XHJcbiAgICBzdGF0dXM6IEh0dHBTdGF0dXMuQ1JFQVRFRCxcclxuICAgIGRlc2NyaXB0aW9uOiAnVXNlciBzdWNjZXNzZnVsbHkgcmVnaXN0ZXJlZCcsXHJcbiAgICB0eXBlOiBBdXRoUmVzcG9uc2VTY2hlbWEsXHJcbiAgfSlcclxuICBAQXBpQmFkUmVxdWVzdFJlc3BvbnNlKHtcclxuICAgIGRlc2NyaXB0aW9uOiAnVmFsaWRhdGlvbiBlcnJvciAtIEludmFsaWQgaW5wdXQgZGF0YScsXHJcbiAgICB0eXBlOiBWYWxpZGF0aW9uRXJyb3JSZXNwb25zZVNjaGVtYSxcclxuICB9KVxyXG4gIEBBcGlDb25mbGljdFJlc3BvbnNlKHtcclxuICAgIGRlc2NyaXB0aW9uOiAnRW1haWwgb3IgdXNlcm5hbWUgYWxyZWFkeSBleGlzdHMnLFxyXG4gICAgdHlwZTogQ29uZmxpY3RFcnJvclJlc3BvbnNlU2NoZW1hLFxyXG4gIH0pXHJcbiAgYXN5bmMgcmVnaXN0ZXIoXHJcbiAgICBAQm9keShuZXcgWm9kVmFsaWRhdGlvblBpcGUocmVnaXN0ZXJEdG8uUmVnaXN0ZXJTY2hlbWEpKVxyXG4gICAgZHRvOiByZWdpc3RlckR0by5SZWdpc3RlckR0byxcclxuICApOiBQcm9taXNlPEF1dGhSZXNwb25zZT4ge1xyXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYFJlZ2lzdGVyIHJlcXVlc3QgZm9yOiAke2R0by5lbWFpbH1gKTtcclxuICAgIHJldHVybiB0aGlzLmF1dGhTZXJ2aWNlLnJlZ2lzdGVyKGR0byk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQT1NUIC9hcGkvYXV0aC9sb2dpblxyXG4gICAqXHJcbiAgICogTG9nZ3QgVXNlciBlaW4gdW5kIGdpYnQgVG9rZW5zIHp1csO8Y2suXHJcbiAgICpcclxuICAgKiBSRVFVRVNUIEJPRFk6XHJcbiAgICoge1xyXG4gICAqICAgXCJlbWFpbFwiOiBcInVzZXJAZXhhbXBsZS5jb21cIixcclxuICAgKiAgIFwicGFzc3dvcmRcIjogXCJTZWN1cmVQYXNzMTIzXCJcclxuICAgKiB9XHJcbiAgICpcclxuICAgKiBSRVNQT05TRSAoMjAwIE9LKTpcclxuICAgKiB7XHJcbiAgICogICBcInVzZXJcIjogeyBcImlkXCI6IFwiLi4uXCIsIFwiZW1haWxcIjogXCIuLi5cIiwgLi4uIH0sXHJcbiAgICogICBcInRva2Vuc1wiOiB7IFwiYWNjZXNzVG9rZW5cIjogXCIuLi5cIiwgXCJ0b2tlblR5cGVcIjogXCJCZWFyZXJcIiwgXCJleHBpcmVzSW5cIjogOTAwIH1cclxuICAgKiB9XHJcbiAgICpcclxuICAgKiBFUlJPUlM6XHJcbiAgICogLSA0MDAgQmFkIFJlcXVlc3Q6IFZhbGlkYXRpb24gRXJyb3JcclxuICAgKiAtIDQwMSBVbmF1dGhvcml6ZWQ6IEludmFsaWQgY3JlZGVudGlhbHNcclxuICAgKi9cclxuICBAUHVibGljKCkgLy8gS2VpbmUgQXV0aCBuw7Z0aWcgZsO8ciBMb2dpblxyXG4gIEBQb3N0KCdsb2dpbicpXHJcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXHJcbiAgQEFwaU9wZXJhdGlvbih7XHJcbiAgICBzdW1tYXJ5OiAnTG9naW4gd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmQnLFxyXG4gICAgZGVzY3JpcHRpb246IGBcclxuQXV0aGVudGljYXRlcyBhIHVzZXIgd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmQuXHJcblJldHVybnMgSldUIHRva2VucyBvbiBzdWNjZXNzZnVsIGF1dGhlbnRpY2F0aW9uLlxyXG5cclxuKipUb2tlbiBVc2FnZToqKlxyXG5JbmNsdWRlIHRoZSBhY2Nlc3MgdG9rZW4gaW4gdGhlIEF1dGhvcml6YXRpb24gaGVhZGVyOlxyXG5cXGBcXGBcXGBcclxuQXV0aG9yaXphdGlvbjogQmVhcmVyIDxhY2Nlc3NUb2tlbj5cclxuXFxgXFxgXFxgXHJcbiAgICBgLFxyXG4gIH0pXHJcbiAgQEFwaUJvZHkoe1xyXG4gICAgdHlwZTogTG9naW5SZXF1ZXN0U2NoZW1hLFxyXG4gICAgZGVzY3JpcHRpb246ICdVc2VyIGNyZWRlbnRpYWxzJyxcclxuICAgIGV4YW1wbGVzOiB7XHJcbiAgICAgIHZhbGlkOiB7XHJcbiAgICAgICAgc3VtbWFyeTogJ1ZhbGlkIGNyZWRlbnRpYWxzJyxcclxuICAgICAgICB2YWx1ZToge1xyXG4gICAgICAgICAgZW1haWw6ICd1c2VyQGV4YW1wbGUuY29tJyxcclxuICAgICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMycsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgIH0sXHJcbiAgfSlcclxuICBAQXBpUmVzcG9uc2Uoe1xyXG4gICAgc3RhdHVzOiBIdHRwU3RhdHVzLk9LLFxyXG4gICAgZGVzY3JpcHRpb246ICdMb2dpbiBzdWNjZXNzZnVsJyxcclxuICAgIHR5cGU6IEF1dGhSZXNwb25zZVNjaGVtYSxcclxuICB9KVxyXG4gIEBBcGlCYWRSZXF1ZXN0UmVzcG9uc2Uoe1xyXG4gICAgZGVzY3JpcHRpb246ICdWYWxpZGF0aW9uIGVycm9yIC0gSW52YWxpZCBpbnB1dCBmb3JtYXQnLFxyXG4gICAgdHlwZTogVmFsaWRhdGlvbkVycm9yUmVzcG9uc2VTY2hlbWEsXHJcbiAgfSlcclxuICBAQXBpVW5hdXRob3JpemVkUmVzcG9uc2Uoe1xyXG4gICAgZGVzY3JpcHRpb246ICdJbnZhbGlkIGVtYWlsIG9yIHBhc3N3b3JkJyxcclxuICAgIHR5cGU6IFVuYXV0aG9yaXplZEVycm9yUmVzcG9uc2VTY2hlbWEsXHJcbiAgfSlcclxuICBhc3luYyBsb2dpbihcclxuICAgIEBCb2R5KG5ldyBab2RWYWxpZGF0aW9uUGlwZShsb2dpbkR0by5Mb2dpblNjaGVtYSkpIGR0bzogbG9naW5EdG8uTG9naW5EdG8sXHJcbiAgKTogUHJvbWlzZTxBdXRoUmVzcG9uc2U+IHtcclxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBMb2dpbiByZXF1ZXN0IGZvcjogJHtkdG8uZW1haWx9YCk7XHJcbiAgICByZXR1cm4gdGhpcy5hdXRoU2VydmljZS5sb2dpbihkdG8pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR0VUIC9hcGkvYXV0aC9tZVxyXG4gICAqXHJcbiAgICogR2lidCBha3R1ZWxsZW4gVXNlciB6dXLDvGNrIChhdXMgSldUIFRva2VuKS5cclxuICAgKiBFcmZvcmRlcnQgZ8O8bHRpZ2VuIEJlYXJlciBUb2tlbi5cclxuICAgKlxyXG4gICAqIEhFQURFUlM6XHJcbiAgICogQXV0aG9yaXphdGlvbjogQmVhcmVyIDx0b2tlbj5cclxuICAgKlxyXG4gICAqIFJFU1BPTlNFICgyMDAgT0spOlxyXG4gICAqIHtcclxuICAgKiAgIFwiaWRcIjogXCJ1dWlkXCIsXHJcbiAgICogICBcImVtYWlsXCI6IFwidXNlckBleGFtcGxlLmNvbVwiLFxyXG4gICAqICAgXCJ1c2VybmFtZVwiOiBcImpvaG5kb2VcIixcclxuICAgKiAgIFwiYmlvXCI6IG51bGwsXHJcbiAgICogICBcImF2YXRhclVybFwiOiBudWxsLFxyXG4gICAqICAgXCJyb2xlXCI6IFwiVVNFUlwiLFxyXG4gICAqICAgXCJjcmVhdGVkQXRcIjogXCIyMDI2LTAxLTA0VC4uLlwiLFxyXG4gICAqICAgXCJ1cGRhdGVkQXRcIjogXCIyMDI2LTAxLTA0VC4uLlwiXHJcbiAgICogfVxyXG4gICAqXHJcbiAgICogRVJST1JTOlxyXG4gICAqIC0gNDAxIFVuYXV0aG9yaXplZDogTWlzc2luZy9JbnZhbGlkIHRva2VuXHJcbiAgICovXHJcbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQpXHJcbiAgQEdldCgnbWUnKVxyXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxyXG4gIEBBcGlCZWFyZXJBdXRoKCdKV1QtQXV0aCcpXHJcbiAgQEFwaU9wZXJhdGlvbih7XHJcbiAgICBzdW1tYXJ5OiAnR2V0IGN1cnJlbnQgdXNlciBwcm9maWxlJyxcclxuICAgIGRlc2NyaXB0aW9uOiBgXHJcblJldHVybnMgdGhlIHByb2ZpbGUgb2YgdGhlIGN1cnJlbnRseSBhdXRoZW50aWNhdGVkIHVzZXIuXHJcblJlcXVpcmVzIGEgdmFsaWQgSldUIHRva2VuIGluIHRoZSBBdXRob3JpemF0aW9uIGhlYWRlci5cclxuXHJcbioqTm90ZToqKiBUaGlzIGVuZHBvaW50IHZhbGlkYXRlcyB0aGUgdG9rZW4gYW5kIHJldHVybnMgZnJlc2ggdXNlciBkYXRhIGZyb20gdGhlIGRhdGFiYXNlLlxyXG4gICAgYCxcclxuICB9KVxyXG4gIEBBcGlSZXNwb25zZSh7XHJcbiAgICBzdGF0dXM6IEh0dHBTdGF0dXMuT0ssXHJcbiAgICBkZXNjcmlwdGlvbjogJ0N1cnJlbnQgdXNlciBwcm9maWxlJyxcclxuICAgIHR5cGU6IFVzZXJSZXNwb25zZVNjaGVtYSxcclxuICB9KVxyXG4gIEBBcGlVbmF1dGhvcml6ZWRSZXNwb25zZSh7XHJcbiAgICBkZXNjcmlwdGlvbjogJ01pc3Npbmcgb3IgaW52YWxpZCBhdXRoZW50aWNhdGlvbiB0b2tlbicsXHJcbiAgICB0eXBlOiBVbmF1dGhvcml6ZWRFcnJvclJlc3BvbnNlU2NoZW1hLFxyXG4gIH0pXHJcbiAgZ2V0TWUoQEN1cnJlbnRVc2VyKCkgdXNlcjogU2FmZVVzZXIpOiBTYWZlVXNlciB7XHJcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgR2V0IHByb2ZpbGUgZm9yIHVzZXI6ICR7dXNlci5pZH1gKTtcclxuICAgIHJldHVybiB1c2VyO1xyXG4gIH1cclxufVxyXG4iXSwidmVyc2lvbiI6M30=