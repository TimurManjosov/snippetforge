{"file":"C:\\Users\\timur\\Programming\\Projects\\snippetforge\\apps\\api\\src\\modules\\auth\\auth.controller.ts","mappings":"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","names":[],"sources":["C:\\Users\\timur\\Programming\\Projects\\snippetforge\\apps\\api\\src\\modules\\auth\\auth.controller.ts"],"sourcesContent":["// src/modules/auth/auth.controller.ts\r\n\r\nimport {\r\n  Body,\r\n  Controller,\r\n  Get,\r\n  HttpCode,\r\n  HttpStatus,\r\n  Logger,\r\n  Post,\r\n  UseGuards,\r\n} from '@nestjs/common';\r\nimport {\r\n  ApiBadRequestResponse,\r\n  ApiBearerAuth,\r\n  ApiBody,\r\n  ApiConflictResponse,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiTags,\r\n  ApiUnauthorizedResponse,\r\n} from '@nestjs/swagger';\r\nimport { ZodValidationPipe } from '../../shared/pipes';\r\nimport {\r\n  AuthResponseSchema,\r\n  ConflictErrorResponseSchema,\r\n  LoginRequestSchema,\r\n  RegisterRequestSchema,\r\n  UnauthorizedErrorResponseSchema,\r\n  UserResponseSchema,\r\n  ValidationErrorResponseSchema,\r\n} from '../../shared/swagger';\r\nimport { type SafeUser } from '../users';\r\nimport { AuthService } from './auth.service';\r\nimport { type AuthResponse } from './auth.types';\r\nimport { CurrentUser } from './decorators/current-user.decorator';\r\nimport { Public } from './decorators/public.decorator';\r\nimport * as loginDto from './dto/login.dto';\r\nimport * as registerDto from './dto/register.dto';\r\nimport { JwtAuthGuard } from './guards/jwt-auth.guard';\r\n\r\n/**\r\n * AuthController - Authentication HTTP Endpoints\r\n *\r\n * ENDPOINTS:\r\n * - POST /api/auth/register - Neuen Account erstellen\r\n * - POST /api/auth/login    - Einloggen und Token erhalten\r\n * - GET  /api/auth/me       - Eigenes Profil abrufen\r\n *\r\n * SWAGGER DECORATORS:\r\n * - @ApiTags:  Gruppiert Endpoints unter \"Auth\"\r\n * - @ApiOperation: Beschreibt einzelnen Endpoint\r\n * - @ApiResponse: Dokumentiert mögliche Responses\r\n * - @ApiBody:  Dokumentiert Request Body\r\n * - @ApiBearerAuth: Markiert als Auth-geschützt\r\n */\r\n@ApiTags('Auth')\r\n@Controller('auth')\r\nexport class AuthController {\r\n  private readonly logger = new Logger(AuthController.name);\r\n\r\n  constructor(private readonly authService: AuthService) {}\r\n\r\n  /**\r\n   * POST /api/auth/register\r\n   *\r\n   * Registriert neuen User und gibt Tokens zurück.\r\n   * User ist sofort eingeloggt (kein separater Login nötig).\r\n   *\r\n   * REQUEST BODY:\r\n   * {\r\n   *   \"email\": \"user@example.com\",\r\n   *   \"username\": \"johndoe\",\r\n   *   \"password\": \"SecurePass123\"\r\n   * }\r\n   *\r\n   * RESPONSE (201 Created):\r\n   * {\r\n   *   \"user\": { \"id\": \"...\", \"email\": \"...\", ... },\r\n   *   \"tokens\": { \"accessToken\": \"...\", \"tokenType\": \"Bearer\", \"expiresIn\": 900 }\r\n   * }\r\n   *\r\n   * ERRORS:\r\n   * - 400 Bad Request: Validation Error\r\n   * - 409 Conflict: Email/Username already exists\r\n   */\r\n  @Public() // Keine Auth nötig für Registration\r\n  @Post('register')\r\n  @HttpCode(HttpStatus.CREATED)\r\n  @ApiOperation({\r\n    summary: 'Register a new user account',\r\n    description: `\r\nCreates a new user account and returns authentication tokens.\r\nThe user is immediately logged in after registration.\r\n\r\n**Password Requirements:**\r\n- Minimum 8 characters\r\n- At least one uppercase letter\r\n- At least one lowercase letter\r\n- At least one number\r\n\r\n**Username Requirements:**\r\n- 3-30 characters\r\n- Only letters, numbers, and underscores\r\n    `,\r\n  })\r\n  @ApiBody({\r\n    type: RegisterRequestSchema,\r\n    description: 'User registration data',\r\n    examples: {\r\n      valid: {\r\n        summary: 'Valid registration',\r\n        value: {\r\n          email: 'newuser@example.com',\r\n          username: 'newuser',\r\n          password: 'SecurePass123',\r\n        },\r\n      },\r\n      minimal: {\r\n        summary: 'Minimal valid data',\r\n        value: {\r\n          email: 'min@test.com',\r\n          username: 'usr',\r\n          password: 'Test1234',\r\n        },\r\n      },\r\n    },\r\n  })\r\n  @ApiResponse({\r\n    status: HttpStatus.CREATED,\r\n    description: 'User successfully registered',\r\n    type: AuthResponseSchema,\r\n  })\r\n  @ApiBadRequestResponse({\r\n    description: 'Validation error - Invalid input data',\r\n    type: ValidationErrorResponseSchema,\r\n  })\r\n  @ApiConflictResponse({\r\n    description: 'Email or username already exists',\r\n    type: ConflictErrorResponseSchema,\r\n  })\r\n  async register(\r\n    @Body(new ZodValidationPipe(registerDto.RegisterSchema))\r\n    dto: registerDto.RegisterDto,\r\n  ): Promise<AuthResponse> {\r\n    this.logger.debug(`Register request for: ${dto.email}`);\r\n    return this.authService.register(dto);\r\n  }\r\n\r\n  /**\r\n   * POST /api/auth/login\r\n   *\r\n   * Loggt User ein und gibt Tokens zurück.\r\n   *\r\n   * REQUEST BODY:\r\n   * {\r\n   *   \"email\": \"user@example.com\",\r\n   *   \"password\": \"SecurePass123\"\r\n   * }\r\n   *\r\n   * RESPONSE (200 OK):\r\n   * {\r\n   *   \"user\": { \"id\": \"...\", \"email\": \"...\", ... },\r\n   *   \"tokens\": { \"accessToken\": \"...\", \"tokenType\": \"Bearer\", \"expiresIn\": 900 }\r\n   * }\r\n   *\r\n   * ERRORS:\r\n   * - 400 Bad Request: Validation Error\r\n   * - 401 Unauthorized: Invalid credentials\r\n   */\r\n  @Public() // Keine Auth nötig für Login\r\n  @Post('login')\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({\r\n    summary: 'Login with email and password',\r\n    description: `\r\nAuthenticates a user with email and password.\r\nReturns JWT tokens on successful authentication.\r\n\r\n**Token Usage:**\r\nInclude the access token in the Authorization header:\r\n\\`\\`\\`\r\nAuthorization: Bearer <accessToken>\r\n\\`\\`\\`\r\n    `,\r\n  })\r\n  @ApiBody({\r\n    type: LoginRequestSchema,\r\n    description: 'User credentials',\r\n    examples: {\r\n      valid: {\r\n        summary: 'Valid credentials',\r\n        value: {\r\n          email: 'user@example.com',\r\n          password: 'SecurePass123',\r\n        },\r\n      },\r\n    },\r\n  })\r\n  @ApiResponse({\r\n    status: HttpStatus.OK,\r\n    description: 'Login successful',\r\n    type: AuthResponseSchema,\r\n  })\r\n  @ApiBadRequestResponse({\r\n    description: 'Validation error - Invalid input format',\r\n    type: ValidationErrorResponseSchema,\r\n  })\r\n  @ApiUnauthorizedResponse({\r\n    description: 'Invalid email or password',\r\n    type: UnauthorizedErrorResponseSchema,\r\n  })\r\n  async login(\r\n    @Body(new ZodValidationPipe(loginDto.LoginSchema)) dto: loginDto.LoginDto,\r\n  ): Promise<AuthResponse> {\r\n    this.logger.debug(`Login request for: ${dto.email}`);\r\n    return this.authService.login(dto);\r\n  }\r\n\r\n  /**\r\n   * GET /api/auth/me\r\n   *\r\n   * Gibt aktuellen User zurück (aus JWT Token).\r\n   * Erfordert gültigen Bearer Token.\r\n   *\r\n   * HEADERS:\r\n   * Authorization: Bearer <token>\r\n   *\r\n   * RESPONSE (200 OK):\r\n   * {\r\n   *   \"id\": \"uuid\",\r\n   *   \"email\": \"user@example.com\",\r\n   *   \"username\": \"johndoe\",\r\n   *   \"bio\": null,\r\n   *   \"avatarUrl\": null,\r\n   *   \"role\": \"USER\",\r\n   *   \"createdAt\": \"2026-01-04T...\",\r\n   *   \"updatedAt\": \"2026-01-04T...\"\r\n   * }\r\n   *\r\n   * ERRORS:\r\n   * - 401 Unauthorized: Missing/Invalid token\r\n   */\r\n  @UseGuards(JwtAuthGuard)\r\n  @Get('me')\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiBearerAuth('JWT-Auth')\r\n  @ApiOperation({\r\n    summary: 'Get current user profile',\r\n    description: `\r\nReturns the profile of the currently authenticated user.\r\nRequires a valid JWT token in the Authorization header.\r\n\r\n**Note:** This endpoint validates the token and returns fresh user data from the database.\r\n    `,\r\n  })\r\n  @ApiResponse({\r\n    status: HttpStatus.OK,\r\n    description: 'Current user profile',\r\n    type: UserResponseSchema,\r\n  })\r\n  @ApiUnauthorizedResponse({\r\n    description: 'Missing or invalid authentication token',\r\n    type: UnauthorizedErrorResponseSchema,\r\n  })\r\n  getMe(@CurrentUser() user: SafeUser): SafeUser {\r\n    this.logger.debug(`Get profile for user: ${user.id}`);\r\n    return user;\r\n  }\r\n}\r\n"],"version":3}