877129974073f14e99869600f9357b0f
"use strict";
// src/shared/filters/http-exception.filter.spec.ts
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("@nestjs/common");
const testing_1 = require("@nestjs/testing");
const http_exception_filter_1 = require("./http-exception.filter");
const constants_1 = require("../constants");
describe('HttpExceptionFilter', () => {
    let filter;
    let mockResponse;
    let mockRequest;
    let mockArgumentsHost;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [http_exception_filter_1.HttpExceptionFilter],
        }).compile();
        filter = module.get(http_exception_filter_1.HttpExceptionFilter);
        // Mock Response
        mockResponse = {
            status: jest.fn().mockReturnThis(),
            json: jest.fn().mockReturnThis(),
        };
        // Mock Request
        mockRequest = {
            url: '/api/test',
            method: 'GET',
            ip: '127.0.0.1',
            headers: {
                'user-agent': 'test-agent',
            },
        };
        // Mock ArgumentsHost
        mockArgumentsHost = {
            switchToHttp: jest.fn().mockReturnValue({
                getResponse: () => mockResponse,
                getRequest: () => mockRequest,
            }),
        };
    });
    describe('catch', () => {
        it('should handle string exception response', () => {
            const exception = new common_1.HttpException('Not found', common_1.HttpStatus.NOT_FOUND);
            filter.catch(exception, mockArgumentsHost);
            expect(mockResponse.status).toHaveBeenCalledWith(404);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                error: {
                    code: constants_1.ErrorCodes.RESOURCE_NOT_FOUND,
                    message: 'Not found',
                    statusCode: 404,
                },
                meta: {
                    timestamp: expect.any(String),
                    path: '/api/test',
                    method: 'GET',
                },
            });
        });
        it('should handle object exception response', () => {
            const exception = new common_1.HttpException({
                message: 'Validation failed',
                error: 'Bad Request',
            }, common_1.HttpStatus.BAD_REQUEST);
            filter.catch(exception, mockArgumentsHost);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                error: {
                    code: constants_1.ErrorCodes.VALIDATION_ERROR,
                    message: 'Validation failed',
                    statusCode: 400,
                },
                meta: {
                    timestamp: expect.any(String),
                    path: '/api/test',
                    method: 'GET',
                },
            });
        });
        it('should handle exception with array of messages', () => {
            const exception = new common_1.HttpException({
                message: ['Error 1', 'Error 2'],
            }, common_1.HttpStatus.BAD_REQUEST);
            filter.catch(exception, mockArgumentsHost);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                error: {
                    code: constants_1.ErrorCodes.VALIDATION_ERROR,
                    message: 'Error 1',
                    statusCode: 400,
                    details: {
                        context: {
                            messages: ['Error 1', 'Error 2'],
                        },
                    },
                },
                meta: {
                    timestamp: expect.any(String),
                    path: '/api/test',
                    method: 'GET',
                },
            });
        });
        it('should handle exception with custom error code', () => {
            const exception = new common_1.HttpException({
                message: 'User not found',
                code: constants_1.ErrorCodes.USER_NOT_FOUND,
            }, common_1.HttpStatus.NOT_FOUND);
            filter.catch(exception, mockArgumentsHost);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                error: {
                    code: constants_1.ErrorCodes.USER_NOT_FOUND,
                    message: 'User not found',
                    statusCode: 404,
                },
                meta: {
                    timestamp: expect.any(String),
                    path: '/api/test',
                    method: 'GET',
                },
            });
        });
        it('should handle exception with Zod validation errors', () => {
            const exception = new common_1.HttpException({
                message: 'Validation failed',
                code: constants_1.ErrorCodes.VALIDATION_ERROR,
                errors: {
                    email: ['Invalid email format'],
                    password: ['Too short', 'Must contain number'],
                },
            }, common_1.HttpStatus.BAD_REQUEST);
            filter.catch(exception, mockArgumentsHost);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                error: {
                    code: constants_1.ErrorCodes.VALIDATION_ERROR,
                    message: 'Validation failed',
                    statusCode: 400,
                    details: {
                        fields: {
                            email: ['Invalid email format'],
                            password: ['Too short', 'Must contain number'],
                        },
                    },
                },
                meta: {
                    timestamp: expect.any(String),
                    path: '/api/test',
                    method: 'GET',
                },
            });
        });
        it('should extract request ID from headers', () => {
            mockRequest.headers['x-request-id'] = 'test-request-id-123';
            const exception = new common_1.HttpException('Error', common_1.HttpStatus.BAD_REQUEST);
            filter.catch(exception, mockArgumentsHost);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                error: expect.any(Object),
                meta: {
                    timestamp: expect.any(String),
                    path: '/api/test',
                    method: 'GET',
                    requestId: 'test-request-id-123',
                },
            });
        });
        it('should extract correlation ID if request ID is not present', () => {
            mockRequest.headers['x-correlation-id'] = 'correlation-456';
            const exception = new common_1.HttpException('Error', common_1.HttpStatus.BAD_REQUEST);
            filter.catch(exception, mockArgumentsHost);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                error: expect.any(Object),
                meta: {
                    timestamp: expect.any(String),
                    path: '/api/test',
                    method: 'GET',
                    requestId: 'correlation-456',
                },
            });
        });
    });
    describe('error code inference', () => {
        it('should infer AUTH_TOKEN_EXPIRED for 401 with expired message', () => {
            const exception = new common_1.HttpException({ message: 'Token expired' }, common_1.HttpStatus.UNAUTHORIZED);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.AUTH_TOKEN_EXPIRED);
        });
        it('should infer AUTH_TOKEN_MISSING for 401 with missing token message', () => {
            const exception = new common_1.HttpException({ message: 'No token provided' }, common_1.HttpStatus.UNAUTHORIZED);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.AUTH_TOKEN_MISSING);
        });
        it('should infer AUTH_INVALID_CREDENTIALS for 401 with invalid credentials', () => {
            const exception = new common_1.HttpException({ message: 'Invalid credentials' }, common_1.HttpStatus.UNAUTHORIZED);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.AUTH_INVALID_CREDENTIALS);
        });
        it('should infer AUTH_TOKEN_INVALID for generic 401', () => {
            const exception = new common_1.HttpException({ message: 'Unauthorized' }, common_1.HttpStatus.UNAUTHORIZED);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.AUTH_TOKEN_INVALID);
        });
        it('should infer AUTH_INSUFFICIENT_ROLE for 403 with role message', () => {
            const exception = new common_1.HttpException({ message: 'Insufficient role' }, common_1.HttpStatus.FORBIDDEN);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.AUTH_INSUFFICIENT_ROLE);
        });
        it('should infer AUTH_ACCESS_DENIED for generic 403', () => {
            const exception = new common_1.HttpException({ message: 'Forbidden' }, common_1.HttpStatus.FORBIDDEN);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.AUTH_ACCESS_DENIED);
        });
        it('should infer USER_EMAIL_EXISTS for 409 with email message', () => {
            const exception = new common_1.HttpException({ message: 'Email already exists' }, common_1.HttpStatus.CONFLICT);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.USER_EMAIL_EXISTS);
        });
        it('should infer USER_USERNAME_EXISTS for 409 with username message', () => {
            const exception = new common_1.HttpException({ message: 'Username already taken' }, common_1.HttpStatus.CONFLICT);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.USER_USERNAME_EXISTS);
        });
        it('should infer USER_NOT_FOUND for 404 with user message', () => {
            const exception = new common_1.HttpException({ message: 'User not found' }, common_1.HttpStatus.NOT_FOUND);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.USER_NOT_FOUND);
        });
        it('should use default code for unknown status', () => {
            const exception = new common_1.HttpException('Internal Server Error', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.SERVER_ERROR);
        });
    });
    describe('logging behavior', () => {
        it('should log error level for 5xx errors', () => {
            const loggerErrorSpy = jest.spyOn(filter['logger'], 'error');
            const exception = new common_1.HttpException('Internal Error', common_1.HttpStatus.INTERNAL_SERVER_ERROR);
            filter.catch(exception, mockArgumentsHost);
            expect(loggerErrorSpy).toHaveBeenCalled();
        });
        it('should log warn level for 401 errors', () => {
            const loggerWarnSpy = jest.spyOn(filter['logger'], 'warn');
            const exception = new common_1.HttpException('Unauthorized', common_1.HttpStatus.UNAUTHORIZED);
            filter.catch(exception, mockArgumentsHost);
            expect(loggerWarnSpy).toHaveBeenCalled();
        });
        it('should log warn level for 403 errors', () => {
            const loggerWarnSpy = jest.spyOn(filter['logger'], 'warn');
            const exception = new common_1.HttpException('Forbidden', common_1.HttpStatus.FORBIDDEN);
            filter.catch(exception, mockArgumentsHost);
            expect(loggerWarnSpy).toHaveBeenCalled();
        });
        it('should log debug level for 4xx errors (except 401/403)', () => {
            const loggerDebugSpy = jest.spyOn(filter['logger'], 'debug');
            const exception = new common_1.HttpException('Bad Request', common_1.HttpStatus.BAD_REQUEST);
            filter.catch(exception, mockArgumentsHost);
            expect(loggerDebugSpy).toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aW11clxcUHJvZ3JhbW1pbmdcXFByb2plY3RzXFxzbmlwcGV0Zm9yZ2VcXGFwcHNcXGFwaVxcc3JjXFxzaGFyZWRcXGZpbHRlcnNcXGh0dHAtZXhjZXB0aW9uLmZpbHRlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQSxtREFBbUQ7O0FBRW5ELDJDQUEyRDtBQUMzRCw2Q0FBc0Q7QUFDdEQsbUVBQThEO0FBQzlELDRDQUEwQztBQUUxQyxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLElBQUksTUFBMkIsQ0FBQztJQUNoQyxJQUFJLFlBQWlCLENBQUM7SUFDdEIsSUFBSSxXQUFnQixDQUFDO0lBQ3JCLElBQUksaUJBQXNCLENBQUM7SUFFM0IsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUUsQ0FBQywyQ0FBbUIsQ0FBQztTQUNqQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixNQUFNLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBc0IsMkNBQW1CLENBQUMsQ0FBQztRQUU5RCxnQkFBZ0I7UUFDaEIsWUFBWSxHQUFHO1lBQ2IsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDbEMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7U0FDakMsQ0FBQztRQUVGLGVBQWU7UUFDZixXQUFXLEdBQUc7WUFDWixHQUFHLEVBQUUsV0FBVztZQUNoQixNQUFNLEVBQUUsS0FBSztZQUNiLEVBQUUsRUFBRSxXQUFXO1lBQ2YsT0FBTyxFQUFFO2dCQUNQLFlBQVksRUFBRSxZQUFZO2FBQzNCO1NBQ0YsQ0FBQztRQUVGLHFCQUFxQjtRQUNyQixpQkFBaUIsR0FBRztZQUNsQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztnQkFDdEMsV0FB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LFdBQVcsRUFBRSxtQkFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRXZFLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLGlCQUFpQixDQUFDLENBQUM7WUFFM0MsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0RBQXdELEVBQUUsR0FBRyxFQUFFO1lBQ2hFLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBRTdELE1BQU0sU0FBUyxHQUFHLElBQUksc0JBQWEsQ0FDakMsYUFBYSxFQUNiLG1CQUFVLENBQUMsV0FBVyxDQUN2QixDQUFDO1lBRUYsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztZQUUzQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aW11clxcUHJvZ3JhbW1pbmdcXFByb2plY3RzXFxzbmlwcGV0Zm9yZ2VcXGFwcHNcXGFwaVxcc3JjXFxzaGFyZWRcXGZpbHRlcnNcXGh0dHAtZXhjZXB0aW9uLmZpbHRlci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zaGFyZWQvZmlsdGVycy9odHRwLWV4Y2VwdGlvbi5maWx0ZXIuc3BlYy50c1xyXG5cclxuaW1wb3J0IHsgSHR0cEV4Y2VwdGlvbiwgSHR0cFN0YXR1cyB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcclxuaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XHJcbmltcG9ydCB7IEh0dHBFeGNlcHRpb25GaWx0ZXIgfSBmcm9tICcuL2h0dHAtZXhjZXB0aW9uLmZpbHRlcic7XHJcbmltcG9ydCB7IEVycm9yQ29kZXMgfSBmcm9tICcuLi9jb25zdGFudHMnO1xyXG5cclxuZGVzY3JpYmUoJ0h0dHBFeGNlcHRpb25GaWx0ZXInLCAoKSA9PiB7XHJcbiAgbGV0IGZpbHRlcjogSHR0cEV4Y2VwdGlvbkZpbHRlcjtcclxuICBsZXQgbW9ja1Jlc3BvbnNlOiBhbnk7XHJcbiAgbGV0IG1vY2tSZXF1ZXN0OiBhbnk7XHJcbiAgbGV0IG1vY2tBcmd1bWVudHNIb3N0OiBhbnk7XHJcblxyXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcclxuICAgICAgcHJvdmlkZXJzOiBbSHR0cEV4Y2VwdGlvbkZpbHRlcl0sXHJcbiAgICB9KS5jb21waWxlKCk7XHJcblxyXG4gICAgZmlsdGVyID0gbW9kdWxlLmdldDxIdHRwRXhjZXB0aW9uRmlsdGVyPihIdHRwRXhjZXB0aW9uRmlsdGVyKTtcclxuXHJcbiAgICAvLyBNb2NrIFJlc3BvbnNlXHJcbiAgICBtb2NrUmVzcG9uc2UgPSB7XHJcbiAgICAgIHN0YXR1czogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgIGpzb246IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBNb2NrIFJlcXVlc3RcclxuICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICB1cmw6ICcvYXBpL3Rlc3QnLFxyXG4gICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICBpcDogJzEyNy4wLjAuMScsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyxcclxuICAgICAgfSxcclxuICAgIH07XHJcblxyXG4gICAgLy8gTW9jayBBcmd1bWVudHNIb3N0XHJcbiAgICBtb2NrQXJndW1lbnRzSG9zdCA9IHtcclxuICAgICAgc3dpdGNoVG9IdHRwOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICBnZXRSZXNwb25zZTogKCkgPT4gbW9ja1Jlc3BvbnNlLFxyXG4gICAgICAgIGdldFJlcXVlc3Q6ICgpID0+IG1vY2tSZXF1ZXN0LFxyXG4gICAgICB9KSxcclxuICAgIH07XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjYXRjaCcsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHN0cmluZyBleGNlcHRpb24gcmVzcG9uc2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBIdHRwRXhjZXB0aW9uKCdOb3QgZm91bmQnLCBIdHRwU3RhdHVzLk5PVF9GT1VORCk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDA0KTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IHtcclxuICAgICAgICAgIGNvZGU6IEVycm9yQ29kZXMuUkVTT1VSQ0VfTk9UX0ZPVU5ELFxyXG4gICAgICAgICAgbWVzc2FnZTogJ05vdCBmb3VuZCcsXHJcbiAgICAgICAgICBzdGF0dXNDb2RlOiA0MDQsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtZXRhOiB7XHJcbiAgICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoU3RyaW5nKSxcclxuICAgICAgICAgIHBhdGg6ICcvYXBpL3Rlc3QnLFxyXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG9iamVjdCBleGNlcHRpb24gcmVzcG9uc2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBIdHRwRXhjZXB0aW9uKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXHJcbiAgICAgICAgICBlcnJvcjogJ0JhZCBSZXF1ZXN0JyxcclxuICAgICAgICB9LFxyXG4gICAgICAgIEh0dHBTdGF0dXMuQkFEX1JFUVVFU1QsXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IHtcclxuICAgICAgICAgIGNvZGU6IEVycm9yQ29kZXMuVkFMSURBVElPTl9FUlJPUixcclxuICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXHJcbiAgICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtZXRhOiB7XHJcbiAgICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoU3RyaW5nKSxcclxuICAgICAgICAgIHBhdGg6ICcvYXBpL3Rlc3QnLFxyXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGV4Y2VwdGlvbiB3aXRoIGFycmF5IG9mIG1lc3NhZ2VzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgSHR0cEV4Y2VwdGlvbihcclxuICAgICAgICB7XHJcbiAgICAgICAgICBtZXNzYWdlOiBbJ0Vycm9yIDEnLCAnRXJyb3IgMiddLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgSHR0cFN0YXR1cy5CQURfUkVRVUVTVCxcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiB7XHJcbiAgICAgICAgICBjb2RlOiBFcnJvckNvZGVzLlZBTElEQVRJT05fRVJST1IsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnRXJyb3IgMScsXHJcbiAgICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXHJcbiAgICAgICAgICBkZXRhaWxzOiB7XHJcbiAgICAgICAgICAgIGNvbnRleHQ6IHtcclxuICAgICAgICAgICAgICBtZXNzYWdlczogWydFcnJvciAxJywgJ0Vycm9yIDInXSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtZXRhOiB7XHJcbiAgICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoU3RyaW5nKSxcclxuICAgICAgICAgIHBhdGg6ICcvYXBpL3Rlc3QnLFxyXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGV4Y2VwdGlvbiB3aXRoIGN1c3RvbSBlcnJvciBjb2RlJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgSHR0cEV4Y2VwdGlvbihcclxuICAgICAgICB7XHJcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxyXG4gICAgICAgICAgY29kZTogRXJyb3JDb2Rlcy5VU0VSX05PVF9GT1VORCxcclxuICAgICAgICB9LFxyXG4gICAgICAgIEh0dHBTdGF0dXMuTk9UX0ZPVU5ELFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IHtcclxuICAgICAgICAgIGNvZGU6IEVycm9yQ29kZXMuVVNFUl9OT1RfRk9VTkQsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxyXG4gICAgICAgICAgc3RhdHVzQ29kZTogNDA0LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbWV0YToge1xyXG4gICAgICAgICAgdGltZXN0YW1wOiBleHBlY3QuYW55KFN0cmluZyksXHJcbiAgICAgICAgICBwYXRoOiAnL2FwaS90ZXN0JyxcclxuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBleGNlcHRpb24gd2l0aCBab2QgdmFsaWRhdGlvbiBlcnJvcnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBIdHRwRXhjZXB0aW9uKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXHJcbiAgICAgICAgICBjb2RlOiBFcnJvckNvZGVzLlZBTElEQVRJT05fRVJST1IsXHJcbiAgICAgICAgICBlcnJvcnM6IHtcclxuICAgICAgICAgICAgZW1haWw6IFsnSW52YWxpZCBlbWFpbCBmb3JtYXQnXSxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6IFsnVG9vIHNob3J0JywgJ011c3QgY29udGFpbiBudW1iZXInXSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBIdHRwU3RhdHVzLkJBRF9SRVFVRVNULFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IHtcclxuICAgICAgICAgIGNvZGU6IEVycm9yQ29kZXMuVkFMSURBVElPTl9FUlJPUixcclxuICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXHJcbiAgICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXHJcbiAgICAgICAgICBkZXRhaWxzOiB7XHJcbiAgICAgICAgICAgIGZpZWxkczoge1xyXG4gICAgICAgICAgICAgIGVtYWlsOiBbJ0ludmFsaWQgZW1haWwgZm9ybWF0J10sXHJcbiAgICAgICAgICAgICAgcGFzc3dvcmQ6IFsnVG9vIHNob3J0JywgJ011c3QgY29udGFpbiBudW1iZXInXSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtZXRhOiB7XHJcbiAgICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoU3RyaW5nKSxcclxuICAgICAgICAgIHBhdGg6ICcvYXBpL3Rlc3QnLFxyXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZXh0cmFjdCByZXF1ZXN0IElEIGZyb20gaGVhZGVycycsICgpID0+IHtcclxuICAgICAgbW9ja1JlcXVlc3QuaGVhZGVyc1sneC1yZXF1ZXN0LWlkJ10gPSAndGVzdC1yZXF1ZXN0LWlkLTEyMyc7XHJcblxyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgSHR0cEV4Y2VwdGlvbignRXJyb3InLCBIdHRwU3RhdHVzLkJBRF9SRVFVRVNUKTtcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBleHBlY3QuYW55KE9iamVjdCksXHJcbiAgICAgICAgbWV0YToge1xyXG4gICAgICAgICAgdGltZXN0YW1wOiBleHBlY3QuYW55KFN0cmluZyksXHJcbiAgICAgICAgICBwYXRoOiAnL2FwaS90ZXN0JyxcclxuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICByZXF1ZXN0SWQ6ICd0ZXN0LXJlcXVlc3QtaWQtMTIzJyxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZXh0cmFjdCBjb3JyZWxhdGlvbiBJRCBpZiByZXF1ZXN0IElEIGlzIG5vdCBwcmVzZW50JywgKCkgPT4ge1xyXG4gICAgICBtb2NrUmVxdWVzdC5oZWFkZXJzWyd4LWNvcnJlbGF0aW9uLWlkJ10gPSAnY29ycmVsYXRpb24tNDU2JztcclxuXHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBIdHRwRXhjZXB0aW9uKCdFcnJvcicsIEh0dHBTdGF0dXMuQkFEX1JFUVVFU1QpO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGV4cGVjdC5hbnkoT2JqZWN0KSxcclxuICAgICAgICBtZXRhOiB7XHJcbiAgICAgICAgICB0aW1lc3RhbXA6IGV4cGVjdC5hbnkoU3RyaW5nKSxcclxuICAgICAgICAgIHBhdGg6ICcvYXBpL3Rlc3QnLFxyXG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgIHJlcXVlc3RJZDogJ2NvcnJlbGF0aW9uLTQ1NicsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2Vycm9yIGNvZGUgaW5mZXJlbmNlJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBpbmZlciBBVVRIX1RPS0VOX0VYUElSRUQgZm9yIDQwMSB3aXRoIGV4cGlyZWQgbWVzc2FnZScsICgpID0+IHtcclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgeyBtZXNzYWdlOiAnVG9rZW4gZXhwaXJlZCcgfSxcclxuICAgICAgICBIdHRwU3RhdHVzLlVOQVVUSE9SSVpFRCxcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gbW9ja1Jlc3BvbnNlLmpzb24ubW9jay5jYWxsc1swXVswXTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmVycm9yLmNvZGUpLnRvQmUoRXJyb3JDb2Rlcy5BVVRIX1RPS0VOX0VYUElSRUQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBpbmZlciBBVVRIX1RPS0VOX01JU1NJTkcgZm9yIDQwMSB3aXRoIG1pc3NpbmcgdG9rZW4gbWVzc2FnZScsICgpID0+IHtcclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgeyBtZXNzYWdlOiAnTm8gdG9rZW4gcHJvdmlkZWQnIH0sXHJcbiAgICAgICAgSHR0cFN0YXR1cy5VTkFVVEhPUklaRUQsXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5jb2RlKS50b0JlKEVycm9yQ29kZXMuQVVUSF9UT0tFTl9NSVNTSU5HKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaW5mZXIgQVVUSF9JTlZBTElEX0NSRURFTlRJQUxTIGZvciA0MDEgd2l0aCBpbnZhbGlkIGNyZWRlbnRpYWxzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgSHR0cEV4Y2VwdGlvbihcclxuICAgICAgICB7IG1lc3NhZ2U6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJyB9LFxyXG4gICAgICAgIEh0dHBTdGF0dXMuVU5BVVRIT1JJWkVELFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IuY29kZSkudG9CZShFcnJvckNvZGVzLkFVVEhfSU5WQUxJRF9DUkVERU5USUFMUyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGluZmVyIEFVVEhfVE9LRU5fSU5WQUxJRCBmb3IgZ2VuZXJpYyA0MDEnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBIdHRwRXhjZXB0aW9uKFxyXG4gICAgICAgIHsgbWVzc2FnZTogJ1VuYXV0aG9yaXplZCcgfSxcclxuICAgICAgICBIdHRwU3RhdHVzLlVOQVVUSE9SSVpFRCxcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gbW9ja1Jlc3BvbnNlLmpzb24ubW9jay5jYWxsc1swXVswXTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmVycm9yLmNvZGUpLnRvQmUoRXJyb3JDb2Rlcy5BVVRIX1RPS0VOX0lOVkFMSUQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBpbmZlciBBVVRIX0lOU1VGRklDSUVOVF9ST0xFIGZvciA0MDMgd2l0aCByb2xlIG1lc3NhZ2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBIdHRwRXhjZXB0aW9uKFxyXG4gICAgICAgIHsgbWVzc2FnZTogJ0luc3VmZmljaWVudCByb2xlJyB9LFxyXG4gICAgICAgIEh0dHBTdGF0dXMuRk9SQklEREVOLFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IuY29kZSkudG9CZShFcnJvckNvZGVzLkFVVEhfSU5TVUZGSUNJRU5UX1JPTEUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBpbmZlciBBVVRIX0FDQ0VTU19ERU5JRUQgZm9yIGdlbmVyaWMgNDAzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgSHR0cEV4Y2VwdGlvbihcclxuICAgICAgICB7IG1lc3NhZ2U6ICdGb3JiaWRkZW4nIH0sXHJcbiAgICAgICAgSHR0cFN0YXR1cy5GT1JCSURERU4sXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5jb2RlKS50b0JlKEVycm9yQ29kZXMuQVVUSF9BQ0NFU1NfREVOSUVEKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaW5mZXIgVVNFUl9FTUFJTF9FWElTVFMgZm9yIDQwOSB3aXRoIGVtYWlsIG1lc3NhZ2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBIdHRwRXhjZXB0aW9uKFxyXG4gICAgICAgIHsgbWVzc2FnZTogJ0VtYWlsIGFscmVhZHkgZXhpc3RzJyB9LFxyXG4gICAgICAgIEh0dHBTdGF0dXMuQ09ORkxJQ1QsXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5jb2RlKS50b0JlKEVycm9yQ29kZXMuVVNFUl9FTUFJTF9FWElTVFMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBpbmZlciBVU0VSX1VTRVJOQU1FX0VYSVNUUyBmb3IgNDA5IHdpdGggdXNlcm5hbWUgbWVzc2FnZScsICgpID0+IHtcclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgeyBtZXNzYWdlOiAnVXNlcm5hbWUgYWxyZWFkeSB0YWtlbicgfSxcclxuICAgICAgICBIdHRwU3RhdHVzLkNPTkZMSUNULFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IuY29kZSkudG9CZShFcnJvckNvZGVzLlVTRVJfVVNFUk5BTUVfRVhJU1RTKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaW5mZXIgVVNFUl9OT1RfRk9VTkQgZm9yIDQwNCB3aXRoIHVzZXIgbWVzc2FnZScsICgpID0+IHtcclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH0sXHJcbiAgICAgICAgSHR0cFN0YXR1cy5OT1RfRk9VTkQsXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5jb2RlKS50b0JlKEVycm9yQ29kZXMuVVNFUl9OT1RfRk9VTkQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCBjb2RlIGZvciB1bmtub3duIHN0YXR1cycsICgpID0+IHtcclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgJ0ludGVybmFsIFNlcnZlciBFcnJvcicsXHJcbiAgICAgICAgSHR0cFN0YXR1cy5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5jb2RlKS50b0JlKEVycm9yQ29kZXMuU0VSVkVSX0VSUk9SKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnbG9nZ2luZyBiZWhhdmlvcicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgbG9nIGVycm9yIGxldmVsIGZvciA1eHggZXJyb3JzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsb2dnZXJFcnJvclNweSA9IGplc3Quc3B5T24oZmlsdGVyWydsb2dnZXInXSwgJ2Vycm9yJyk7XHJcblxyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgSHR0cEV4Y2VwdGlvbihcclxuICAgICAgICAnSW50ZXJuYWwgRXJyb3InLFxyXG4gICAgICAgIEh0dHBTdGF0dXMuSU5URVJOQUxfU0VSVkVSX0VSUk9SLFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgZXhwZWN0KGxvZ2dlckVycm9yU3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGxvZyB3YXJuIGxldmVsIGZvciA0MDEgZXJyb3JzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsb2dnZXJXYXJuU3B5ID0gamVzdC5zcHlPbihmaWx0ZXJbJ2xvZ2dlciddLCAnd2FybicpO1xyXG5cclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgJ1VuYXV0aG9yaXplZCcsXHJcbiAgICAgICAgSHR0cFN0YXR1cy5VTkFVVEhPUklaRUQsXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBleHBlY3QobG9nZ2VyV2FyblNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBsb2cgd2FybiBsZXZlbCBmb3IgNDAzIGVycm9ycycsICgpID0+IHtcclxuICAgICAgY29uc3QgbG9nZ2VyV2FyblNweSA9IGplc3Quc3B5T24oZmlsdGVyWydsb2dnZXInXSwgJ3dhcm4nKTtcclxuXHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBIdHRwRXhjZXB0aW9uKCdGb3JiaWRkZW4nLCBIdHRwU3RhdHVzLkZPUkJJRERFTik7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBleHBlY3QobG9nZ2VyV2FyblNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBsb2cgZGVidWcgbGV2ZWwgZm9yIDR4eCBlcnJvcnMgKGV4Y2VwdCA0MDEvNDAzKScsICgpID0+IHtcclxuICAgICAgY29uc3QgbG9nZ2VyRGVidWdTcHkgPSBqZXN0LnNweU9uKGZpbHRlclsnbG9nZ2VyJ10sICdkZWJ1ZycpO1xyXG5cclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEh0dHBFeGNlcHRpb24oXHJcbiAgICAgICAgJ0JhZCBSZXF1ZXN0JyxcclxuICAgICAgICBIdHRwU3RhdHVzLkJBRF9SRVFVRVNULFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgZXhwZWN0KGxvZ2dlckRlYnVnU3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==