{"file":"C:\\Users\\timur\\Programming\\Projects\\snippetforge\\apps\\api\\test\\unit\\decorators\\current-user.decorator.spec.ts","mappings":";AAAA,sDAAsD;;AAGtD,wGAA0F;AAG1F,QAAQ,CAAC,uBAAuB,EAAE,GAAG,EAAE;IACrC,MAAM,QAAQ,GAAa;QACzB,EAAE,EAAE,SAAS;QACb,KAAK,EAAE,kBAAkB;QACzB,QAAQ,EAAE,UAAU;QACpB,IAAI,EAAE,MAAM;QACZ,SAAS,EAAE,IAAI,IAAI,EAAE;QACrB,SAAS,EAAE,IAAI,IAAI,EAAE;KACtB,CAAC;IAEF,MAAM,0BAA0B,GAAG,CAAC,IAAe,EAAoB,EAAE;QACvE,OAAO;YACL,YAAY,EAAE,GAAG,EAAE,CAAC,CAAC;gBACnB,UAAU,EAAE,GAAG,EAAE,CAAC,CAAC;oBACjB,IAAI;iBACL,CAAC;aACH,CAAC;SACI,CAAC;IACX,CAAC,CAAC;IAEF,MAAM,aAAa,GAAG,CACpB,QAAoC,EACpC,GAAqB,EACrB,EAAE;QACF,mDAAmD;QACnD,mDAAmD;QACnD,MAAM,SAAS,GAAG,oCAAkB,CAAC;QACrC,IAAI,SAAS,CAAC,OAAO,EAAE,CAAC;YACtB,OAAO,SAAS,CAAC,OAAO,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;QAC1C,CAAC;QACD,oCAAoC;QACpC,OAAO,IAAA,oCAAW,EAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;IACpC,CAAC,CAAC;IAEF,EAAE,CAAC,+CAA+C,EAAE,GAAG,EAAE;QACvD,MAAM,GAAG,GAAG,0BAA0B,CAAC,QAAQ,CAAC,CAAC;QACjD,MAAM,MAAM,GAAG,aAAa,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;QAE7C,MAAM,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IACnC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,gDAAgD,EAAE,GAAG,EAAE;QACxD,MAAM,GAAG,GAAG,0BAA0B,CAAC,QAAQ,CAAC,CAAC;QACjD,MAAM,MAAM,GAAG,aAAa,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QAE3C,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,iDAAiD,EAAE,GAAG,EAAE;QACzD,MAAM,GAAG,GAAG,0BAA0B,CAAC,SAAS,CAAC,CAAC;QAClD,MAAM,MAAM,GAAG,aAAa,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;QAE7C,MAAM,CAAC,MAAM,CAAC,CAAC,aAAa,EAAE,CAAC;IACjC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,mDAAmD,EAAE,GAAG,EAAE;QAC3D,MAAM,GAAG,GAAG,0BAA0B,CAAC,SAAS,CAAC,CAAC;QAClD,MAAM,MAAM,GAAG,aAAa,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QAE3C,MAAM,CAAC,MAAM,CAAC,CAAC,aAAa,EAAE,CAAC;IACjC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,2BAA2B,EAAE,GAAG,EAAE;QACnC,MAAM,GAAG,GAAG,0BAA0B,CAAC,QAAQ,CAAC,CAAC;QACjD,MAAM,MAAM,GAAG,aAAa,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAExC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IACjC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,iCAAiC,EAAE,GAAG,EAAE;QACzC,MAAM,GAAG,GAAG,0BAA0B,CAAC,QAAQ,CAAC,CAAC;QACjD,MAAM,MAAM,GAAG,aAAa,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;QAE9C,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\timur\\Programming\\Projects\\snippetforge\\apps\\api\\test\\unit\\decorators\\current-user.decorator.spec.ts"],"sourcesContent":["// test/unit/decorators/current-user.decorator.spec.ts\r\n\r\nimport { ExecutionContext } from '@nestjs/common';\r\nimport { CurrentUser } from '../../../src/modules/auth/decorators/current-user.decorator';\r\nimport type { SafeUser } from '../../../src/modules/users';\r\n\r\ndescribe('CurrentUser Decorator', () => {\r\n  const mockUser: SafeUser = {\r\n    id: 'test-id',\r\n    email: 'test@example.com',\r\n    username: 'testuser',\r\n    role: 'USER',\r\n    createdAt: new Date(),\r\n    updatedAt: new Date(),\r\n  };\r\n\r\n  const createMockExecutionContext = (user?: SafeUser): ExecutionContext => {\r\n    return {\r\n      switchToHttp: () => ({\r\n        getRequest: () => ({\r\n          user,\r\n        }),\r\n      }),\r\n    } as any;\r\n  };\r\n\r\n  const callDecorator = (\r\n    property: keyof SafeUser | undefined,\r\n    ctx: ExecutionContext,\r\n  ) => {\r\n    // CurrentUser is created with createParamDecorator\r\n    // We need to access the factory function inside it\r\n    const decorator = CurrentUser as any;\r\n    if (decorator.factory) {\r\n      return decorator.factory(property, ctx);\r\n    }\r\n    // Fallback if factory not available\r\n    return CurrentUser(property, ctx);\r\n  };\r\n\r\n  it('should return user when no property specified', () => {\r\n    const ctx = createMockExecutionContext(mockUser);\r\n    const result = callDecorator(undefined, ctx);\r\n\r\n    expect(result).toEqual(mockUser);\r\n  });\r\n\r\n  it('should return specific property when requested', () => {\r\n    const ctx = createMockExecutionContext(mockUser);\r\n    const result = callDecorator('email', ctx);\r\n\r\n    expect(result).toBe('test@example.com');\r\n  });\r\n\r\n  it('should return undefined when no user in request', () => {\r\n    const ctx = createMockExecutionContext(undefined);\r\n    const result = callDecorator(undefined, ctx);\r\n\r\n    expect(result).toBeUndefined();\r\n  });\r\n\r\n  it('should return undefined for property when no user', () => {\r\n    const ctx = createMockExecutionContext(undefined);\r\n    const result = callDecorator('email', ctx);\r\n\r\n    expect(result).toBeUndefined();\r\n  });\r\n\r\n  it('should access id property', () => {\r\n    const ctx = createMockExecutionContext(mockUser);\r\n    const result = callDecorator('id', ctx);\r\n\r\n    expect(result).toBe('test-id');\r\n  });\r\n\r\n  it('should access username property', () => {\r\n    const ctx = createMockExecutionContext(mockUser);\r\n    const result = callDecorator('username', ctx);\r\n\r\n    expect(result).toBe('testuser');\r\n  });\r\n});\r\n"],"version":3}