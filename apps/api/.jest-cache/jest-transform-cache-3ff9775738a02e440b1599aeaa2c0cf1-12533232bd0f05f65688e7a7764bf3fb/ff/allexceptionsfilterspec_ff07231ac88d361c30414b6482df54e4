78098adcab6bfe4336fe06af5ea4f5e0
"use strict";
// src/shared/filters/all-exceptions.filter.spec.ts
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("@nestjs/common");
const testing_1 = require("@nestjs/testing");
const all_exceptions_filter_1 = require("./all-exceptions.filter");
const constants_1 = require("../constants");
describe('AllExceptionsFilter', () => {
    let filter;
    let mockResponse;
    let mockRequest;
    let mockArgumentsHost;
    let originalNodeEnv;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [all_exceptions_filter_1.AllExceptionsFilter],
        }).compile();
        filter = module.get(all_exceptions_filter_1.AllExceptionsFilter);
        // Mock Response
        mockResponse = {
            status: jest.fn().mockReturnThis(),
            json: jest.fn().mockReturnThis(),
        };
        // Mock Request
        mockRequest = {
            url: '/api/test',
            method: 'POST',
            ip: '127.0.0.1',
            headers: {
                'user-agent': 'test-agent',
            },
        };
        // Mock ArgumentsHost
        mockArgumentsHost = {
            switchToHttp: jest.fn().mockReturnValue({
                getResponse: () => mockResponse,
                getRequest: () => mockRequest,
            }),
        };
        // Save original NODE_ENV
        originalNodeEnv = process.env.NODE_ENV;
    });
    afterEach(() => {
        // Restore original NODE_ENV
        if (originalNodeEnv !== undefined) {
            process.env.NODE_ENV = originalNodeEnv;
        }
        else {
            delete process.env.NODE_ENV;
        }
    });
    describe('catch - production mode', () => {
        beforeEach(() => {
            process.env.NODE_ENV = 'production';
            // Recreate filter to pick up new NODE_ENV
            filter = new all_exceptions_filter_1.AllExceptionsFilter();
        });
        it('should return generic message in production for TypeError', () => {
            const exception = new TypeError('Cannot read property of undefined');
            filter.catch(exception, mockArgumentsHost);
            expect(mockResponse.status).toHaveBeenCalledWith(500);
            expect(mockResponse.json).toHaveBeenCalledWith({
                success: false,
                error: {
                    code: constants_1.ErrorCodes.SERVER_ERROR,
                    message: 'An unexpected error occurred. Please try again later.',
                    statusCode: 500,
                },
                meta: {
                    timestamp: expect.any(String),
                    path: '/api/test',
                    method: 'POST',
                },
            });
        });
        it('should not leak error details in production', () => {
            const exception = new Error('Database connection failed at /home/user/app/db.js:123');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.message).toBe('An unexpected error occurred. Please try again later.');
            expect(response.error.message).not.toContain('/home/user/app');
            expect(response.error.message).not.toContain('db.js');
        });
        it('should log error with full details in production', () => {
            const loggerErrorSpy = jest.spyOn(filter['logger'], 'error');
            const exception = new Error('Sensitive internal error');
            filter.catch(exception, mockArgumentsHost);
            expect(loggerErrorSpy).toHaveBeenCalled();
            const logCall = loggerErrorSpy.mock.calls[0];
            expect(logCall[0]).toContain('Sensitive internal error');
        });
    });
    describe('catch - development mode', () => {
        beforeEach(() => {
            process.env.NODE_ENV = 'development';
            // Recreate filter to pick up new NODE_ENV
            filter = new all_exceptions_filter_1.AllExceptionsFilter();
        });
        it('should return sanitized error message in development', () => {
            const exception = new Error('Database query failed');
            filter.catch(exception, mockArgumentsHost);
            expect(mockResponse.status).toHaveBeenCalledWith(500);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.message).toBe('Database query failed');
        });
        it('should sanitize file paths in development', () => {
            const exception = new Error('Failed at /home/user/project/src/file.ts:123');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.message).toContain('[REDACTED]');
            expect(response.error.message).not.toContain('/home/user/project');
        });
        it('should sanitize Windows file paths in development', () => {
            const exception = new Error('Error in C:\\Users\\Project\\app.js');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.message).toContain('[REDACTED]');
            expect(response.error.message).not.toContain('C:\\Users\\Project');
        });
        it('should sanitize connection strings in development', () => {
            const exception = new Error('Failed to connect to postgresql://user:pass@localhost:5432/db');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.message).toContain('[REDACTED]');
            expect(response.error.message).not.toContain('user:pass@localhost');
        });
        it('should truncate very long error messages', () => {
            const longMessage = 'Error: ' + 'x'.repeat(600);
            const exception = new Error(longMessage);
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.message.length).toBeLessThanOrEqual(500);
        });
    });
    describe('error type identification', () => {
        beforeEach(() => {
            process.env.NODE_ENV = 'development';
            filter = new all_exceptions_filter_1.AllExceptionsFilter();
        });
        it('should identify JWT token invalid error', () => {
            const exception = new Error('Invalid token');
            exception.name = 'JsonWebTokenError';
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.AUTH_TOKEN_INVALID);
        });
        it('should identify JWT token expired error', () => {
            const exception = new Error('Token expired');
            exception.name = 'TokenExpiredError';
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.AUTH_TOKEN_EXPIRED);
        });
        it('should identify JWT NotBeforeError', () => {
            const exception = new Error('Token not active');
            exception.name = 'NotBeforeError';
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.AUTH_TOKEN_INVALID);
        });
        it('should identify database connection error', () => {
            const exception = new Error('ECONNREFUSED to database');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.SERVER_DATABASE_ERROR);
        });
        it('should identify postgres error', () => {
            const exception = new Error('postgres connection failed');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.SERVER_DATABASE_ERROR);
        });
        it('should identify unique constraint violation', () => {
            const exception = new Error('duplicate key value violates unique constraint');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.RESOURCE_ALREADY_EXISTS);
        });
        it('should identify JSON parse error', () => {
            const exception = new SyntaxError('Unexpected token in JSON');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.VALIDATION_ERROR);
        });
        it('should use default code for unknown error', () => {
            const exception = new Error('Unknown error');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.error.code).toBe(constants_1.ErrorCodes.SERVER_ERROR);
        });
    });
    describe('HttpException handling', () => {
        it('should handle HttpException with warning', () => {
            const loggerWarnSpy = jest.spyOn(filter['logger'], 'warn');
            const exception = new common_1.HttpException('Not Found', common_1.HttpStatus.NOT_FOUND);
            filter.catch(exception, mockArgumentsHost);
            expect(loggerWarnSpy).toHaveBeenCalledWith('HttpException caught by AllExceptionsFilter - this should not happen');
            expect(mockResponse.status).toHaveBeenCalledWith(404);
        });
    });
    describe('request ID extraction', () => {
        beforeEach(() => {
            process.env.NODE_ENV = 'development';
            filter = new all_exceptions_filter_1.AllExceptionsFilter();
        });
        it('should extract x-request-id from headers', () => {
            mockRequest.headers['x-request-id'] = 'req-123';
            const exception = new Error('Test error');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.meta.requestId).toBe('req-123');
        });
        it('should extract x-correlation-id if x-request-id is not present', () => {
            mockRequest.headers['x-correlation-id'] = 'corr-456';
            const exception = new Error('Test error');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.meta.requestId).toBe('corr-456');
        });
        it('should not include requestId if neither header is present', () => {
            const exception = new Error('Test error');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.meta.requestId).toBeUndefined();
        });
    });
    describe('non-Error exception handling', () => {
        beforeEach(() => {
            process.env.NODE_ENV = 'development';
            filter = new all_exceptions_filter_1.AllExceptionsFilter();
        });
        it('should handle string throws', () => {
            const exception = 'string error';
            filter.catch(exception, mockArgumentsHost);
            expect(mockResponse.status).toHaveBeenCalledWith(500);
            expect(mockResponse.json).toHaveBeenCalled();
        });
        it('should log string throws appropriately', () => {
            const loggerErrorSpy = jest.spyOn(filter['logger'], 'error');
            const exception = 'string error';
            filter.catch(exception, mockArgumentsHost);
            expect(loggerErrorSpy).toHaveBeenCalled();
            const logCall = loggerErrorSpy.mock.calls[0];
            expect(logCall[0]).toContain('Unknown exception type');
            expect(logCall[1]).toBe('string error');
        });
    });
    describe('logging', () => {
        beforeEach(() => {
            process.env.NODE_ENV = 'development';
            filter = new all_exceptions_filter_1.AllExceptionsFilter();
        });
        it('should always log with stack trace for Error instances', () => {
            const loggerErrorSpy = jest.spyOn(filter['logger'], 'error');
            const exception = new Error('Test error with stack');
            filter.catch(exception, mockArgumentsHost);
            expect(loggerErrorSpy).toHaveBeenCalled();
            const logCall = loggerErrorSpy.mock.calls[0];
            expect(logCall[1]).toBeTruthy(); // Stack trace
            expect(logCall[2]).toContain('method'); // Log context
        });
        it('should include request metadata in log context', () => {
            const loggerErrorSpy = jest.spyOn(filter['logger'], 'error');
            const exception = new Error('Test error');
            filter.catch(exception, mockArgumentsHost);
            const logContextStr = loggerErrorSpy.mock.calls[0][2];
            const logContext = JSON.parse(logContextStr);
            expect(logContext).toMatchObject({
                method: 'POST',
                url: '/api/test',
                ip: '127.0.0.1',
                userAgent: 'test-agent',
                timestamp: expect.any(String),
            });
        });
        it('should truncate long user agents', () => {
            const loggerErrorSpy = jest.spyOn(filter['logger'], 'error');
            const longUserAgent = 'x'.repeat(200);
            mockRequest.headers['user-agent'] = longUserAgent;
            const exception = new Error('Test error');
            filter.catch(exception, mockArgumentsHost);
            const logContextStr = loggerErrorSpy.mock.calls[0][2];
            const logContext = JSON.parse(logContextStr);
            expect(logContext.userAgent.length).toBe(100);
        });
    });
    describe('response format', () => {
        beforeEach(() => {
            process.env.NODE_ENV = 'development';
            filter = new all_exceptions_filter_1.AllExceptionsFilter();
        });
        it('should never include stack trace in response', () => {
            const exception = new Error('Test error');
            exception.stack = 'Error: Test error\n    at something...';
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(JSON.stringify(response)).not.toContain(exception.stack);
        });
        it('should always set success to false', () => {
            const exception = new Error('Test error');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.success).toBe(false);
        });
        it('should include proper metadata', () => {
            const exception = new Error('Test error');
            filter.catch(exception, mockArgumentsHost);
            const response = mockResponse.json.mock.calls[0][0];
            expect(response.meta).toMatchObject({
                timestamp: expect.any(String),
                path: '/api/test',
                method: 'POST',
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFx0aW11clxcUHJvZ3JhbW1pbmdcXFByb2plY3RzXFxzbmlwcGV0Zm9yZ2VcXGFwcHNcXGFwaVxcc3JjXFxzaGFyZWRcXGZpbHRlcnNcXGFsbC1leGNlcHRpb25zLmZpbHRlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQSxtREFBbUQ7O0FBRW5ELDJDQUEyRDtBQUMzRCw2Q0FBc0Q7QUFDdEQsbUVBQThEO0FBQzlELDRDQUEwQztBQUUxQyxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLElBQUksTUFBMkIsQ0FBQztJQUNoQyxJQUFJLFlBQWlCLENBQUM7SUFDdEIsSUFBSSxXQUFnQixDQUFDO0lBQ3JCLElBQUksaUJBQXNCLENBQUM7SUFDM0IsSUFBSSxlQUFtQyxDQUFDO0lBRXhDLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLE1BQU0sR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDM0QsU0FBUyxFQUFFLENBQUMsMkNBQW1CLENBQUM7U0FDakMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRWIsTUFBTSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQXNCLDJDQUFtQixDQUFDLENBQUM7UUFFOUQsZ0JBQWdCO1FBQ2hCLFlBQVksR0FBRztZQUNiLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO1lBQ2xDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO1NBQ2pDLENBQUM7UUFFRixlQUFlO1FBQ2YsV0FBVyxHQUFHO1lBQ1osR0FBRyxFQUFFLFdBQVc7WUFDaEIsTUFBTSxFQUFFLE1BQU07WUFDZCxFQUFFLEVBQUUsV0FBVztZQUNmLE9BQU8sRUFBRTtnQkFDUCxZQUFZLEVBQUUsWUFBWTthQUMzQjtTQUNGLENBQUM7UUFFRixxQkFBcUI7UUFDckIsaUJBQWlCLEdBQUc7WUFDbEIsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FB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SUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO1lBQ3hDLE1BQU0sU0FBUyxHQUFHLElBQUksS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRTFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLGlCQUFpQixDQUFDLENBQUM7WUFFM0MsTUFBTSxRQUFRLEdBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BELE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsYUFBYSxDQUFDO2dCQUNsQyxTQUFTLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7Z0JBQzdCLElBQUksRUFBRSxXQUFXO2dCQUNqQixNQUFNLEVBQUUsTUFBTTthQUNmLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRpbXVyXFxQcm9ncmFtbWluZ1xcUHJvamVjdHNcXHNuaXBwZXRmb3JnZVxcYXBwc1xcYXBpXFxzcmNcXHNoYXJlZFxcZmlsdGVyc1xcYWxsLWV4Y2VwdGlvbnMuZmlsdGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NoYXJlZC9maWx0ZXJzL2FsbC1leGNlcHRpb25zLmZpbHRlci5zcGVjLnRzXHJcblxyXG5pbXBvcnQgeyBIdHRwRXhjZXB0aW9uLCBIdHRwU3RhdHVzIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xyXG5pbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcclxuaW1wb3J0IHsgQWxsRXhjZXB0aW9uc0ZpbHRlciB9IGZyb20gJy4vYWxsLWV4Y2VwdGlvbnMuZmlsdGVyJztcclxuaW1wb3J0IHsgRXJyb3JDb2RlcyB9IGZyb20gJy4uL2NvbnN0YW50cyc7XHJcblxyXG5kZXNjcmliZSgnQWxsRXhjZXB0aW9uc0ZpbHRlcicsICgpID0+IHtcclxuICBsZXQgZmlsdGVyOiBBbGxFeGNlcHRpb25zRmlsdGVyO1xyXG4gIGxldCBtb2NrUmVzcG9uc2U6IGFueTtcclxuICBsZXQgbW9ja1JlcXVlc3Q6IGFueTtcclxuICBsZXQgbW9ja0FyZ3VtZW50c0hvc3Q6IGFueTtcclxuICBsZXQgb3JpZ2luYWxOb2RlRW52OiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcblxyXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcclxuICAgICAgcHJvdmlkZXJzOiBbQWxsRXhjZXB0aW9uc0ZpbHRlcl0sXHJcbiAgICB9KS5jb21waWxlKCk7XHJcblxyXG4gICAgZmlsdGVyID0gbW9kdWxlLmdldDxBbGxFeGNlcHRpb25zRmlsdGVyPihBbGxFeGNlcHRpb25zRmlsdGVyKTtcclxuXHJcbiAgICAvLyBNb2NrIFJlc3BvbnNlXHJcbiAgICBtb2NrUmVzcG9uc2UgPSB7XHJcbiAgICAgIHN0YXR1czogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgIGpzb246IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBNb2NrIFJlcXVlc3RcclxuICAgIG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICB1cmw6ICcvYXBpL3Rlc3QnLFxyXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgaXA6ICcxMjcuMC4wLjEnLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgJ3VzZXItYWdlbnQnOiAndGVzdC1hZ2VudCcsXHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIE1vY2sgQXJndW1lbnRzSG9zdFxyXG4gICAgbW9ja0FyZ3VtZW50c0hvc3QgPSB7XHJcbiAgICAgIHN3aXRjaFRvSHR0cDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgZ2V0UmVzcG9uc2U6ICgpID0+IG1vY2tSZXNwb25zZSxcclxuICAgICAgICBnZXRSZXF1ZXN0OiAoKSA9PiBtb2NrUmVxdWVzdCxcclxuICAgICAgfSksXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFNhdmUgb3JpZ2luYWwgTk9ERV9FTlZcclxuICAgIG9yaWdpbmFsTm9kZUVudiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WO1xyXG4gIH0pO1xyXG5cclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgLy8gUmVzdG9yZSBvcmlnaW5hbCBOT0RFX0VOVlxyXG4gICAgaWYgKG9yaWdpbmFsTm9kZUVudiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gb3JpZ2luYWxOb2RlRW52O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGVsZXRlIHByb2Nlc3MuZW52Lk5PREVfRU5WO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY2F0Y2ggLSBwcm9kdWN0aW9uIG1vZGUnLCAoKSA9PiB7XHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAncHJvZHVjdGlvbic7XHJcbiAgICAgIC8vIFJlY3JlYXRlIGZpbHRlciB0byBwaWNrIHVwIG5ldyBOT0RFX0VOVlxyXG4gICAgICBmaWx0ZXIgPSBuZXcgQWxsRXhjZXB0aW9uc0ZpbHRlcigpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZ2VuZXJpYyBtZXNzYWdlIGluIHByb2R1Y3Rpb24gZm9yIFR5cGVFcnJvcicsICgpID0+IHtcclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IFR5cGVFcnJvcignQ2Fubm90IHJlYWQgcHJvcGVydHkgb2YgdW5kZWZpbmVkJyk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNTAwKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IHtcclxuICAgICAgICAgIGNvZGU6IEVycm9yQ29kZXMuU0VSVkVSX0VSUk9SLFxyXG4gICAgICAgICAgbWVzc2FnZTogJ0FuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyxcclxuICAgICAgICAgIHN0YXR1c0NvZGU6IDUwMCxcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1ldGE6IHtcclxuICAgICAgICAgIHRpbWVzdGFtcDogZXhwZWN0LmFueShTdHJpbmcpLFxyXG4gICAgICAgICAgcGF0aDogJy9hcGkvdGVzdCcsXHJcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgbm90IGxlYWsgZXJyb3IgZGV0YWlscyBpbiBwcm9kdWN0aW9uJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgRXJyb3IoXHJcbiAgICAgICAgJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkIGF0IC9ob21lL3VzZXIvYXBwL2RiLmpzOjEyMycsXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5tZXNzYWdlKS50b0JlKFxyXG4gICAgICAgICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicsXHJcbiAgICAgICk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5tZXNzYWdlKS5ub3QudG9Db250YWluKCcvaG9tZS91c2VyL2FwcCcpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IubWVzc2FnZSkubm90LnRvQ29udGFpbignZGIuanMnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgbG9nIGVycm9yIHdpdGggZnVsbCBkZXRhaWxzIGluIHByb2R1Y3Rpb24nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxvZ2dlckVycm9yU3B5ID0gamVzdC5zcHlPbihmaWx0ZXJbJ2xvZ2dlciddLCAnZXJyb3InKTtcclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEVycm9yKCdTZW5zaXRpdmUgaW50ZXJuYWwgZXJyb3InKTtcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGV4cGVjdChsb2dnZXJFcnJvclNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBjb25zdCBsb2dDYWxsID0gbG9nZ2VyRXJyb3JTcHkubW9jay5jYWxsc1swXTtcclxuICAgICAgZXhwZWN0KGxvZ0NhbGxbMF0pLnRvQ29udGFpbignU2Vuc2l0aXZlIGludGVybmFsIGVycm9yJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NhdGNoIC0gZGV2ZWxvcG1lbnQgbW9kZScsICgpID0+IHtcclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICdkZXZlbG9wbWVudCc7XHJcbiAgICAgIC8vIFJlY3JlYXRlIGZpbHRlciB0byBwaWNrIHVwIG5ldyBOT0RFX0VOVlxyXG4gICAgICBmaWx0ZXIgPSBuZXcgQWxsRXhjZXB0aW9uc0ZpbHRlcigpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc2FuaXRpemVkIGVycm9yIG1lc3NhZ2UgaW4gZGV2ZWxvcG1lbnQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcignRGF0YWJhc2UgcXVlcnkgZmFpbGVkJyk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNTAwKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IubWVzc2FnZSkudG9CZSgnRGF0YWJhc2UgcXVlcnkgZmFpbGVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIGZpbGUgcGF0aHMgaW4gZGV2ZWxvcG1lbnQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcihcclxuICAgICAgICAnRmFpbGVkIGF0IC9ob21lL3VzZXIvcHJvamVjdC9zcmMvZmlsZS50czoxMjMnLFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdbUkVEQUNURURdJyk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5tZXNzYWdlKS5ub3QudG9Db250YWluKCcvaG9tZS91c2VyL3Byb2plY3QnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgV2luZG93cyBmaWxlIHBhdGhzIGluIGRldmVsb3BtZW50JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgRXJyb3IoJ0Vycm9yIGluIEM6XFxcXFVzZXJzXFxcXFByb2plY3RcXFxcYXBwLmpzJyk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5tZXNzYWdlKS50b0NvbnRhaW4oJ1tSRURBQ1RFRF0nKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmVycm9yLm1lc3NhZ2UpLm5vdC50b0NvbnRhaW4oJ0M6XFxcXFVzZXJzXFxcXFByb2plY3QnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgc2FuaXRpemUgY29ubmVjdGlvbiBzdHJpbmdzIGluIGRldmVsb3BtZW50JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgRXJyb3IoXHJcbiAgICAgICAgJ0ZhaWxlZCB0byBjb25uZWN0IHRvIHBvc3RncmVzcWw6Ly91c2VyOnBhc3NAbG9jYWxob3N0OjU0MzIvZGInLFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IubWVzc2FnZSkudG9Db250YWluKCdbUkVEQUNURURdJyk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5tZXNzYWdlKS5ub3QudG9Db250YWluKCd1c2VyOnBhc3NAbG9jYWxob3N0Jyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRydW5jYXRlIHZlcnkgbG9uZyBlcnJvciBtZXNzYWdlcycsICgpID0+IHtcclxuICAgICAgY29uc3QgbG9uZ01lc3NhZ2UgPSAnRXJyb3I6ICcgKyAneCcucmVwZWF0KDYwMCk7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcihsb25nTWVzc2FnZSk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5tZXNzYWdlLmxlbmd0aCkudG9CZUxlc3NUaGFuT3JFcXVhbCg1MDApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdlcnJvciB0eXBlIGlkZW50aWZpY2F0aW9uJywgKCkgPT4ge1xyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ2RldmVsb3BtZW50JztcclxuICAgICAgZmlsdGVyID0gbmV3IEFsbEV4Y2VwdGlvbnNGaWx0ZXIoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgSldUIHRva2VuIGludmFsaWQgZXJyb3InLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcignSW52YWxpZCB0b2tlbicpO1xyXG4gICAgICBleGNlcHRpb24ubmFtZSA9ICdKc29uV2ViVG9rZW5FcnJvcic7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5jb2RlKS50b0JlKEVycm9yQ29kZXMuQVVUSF9UT0tFTl9JTlZBTElEKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgSldUIHRva2VuIGV4cGlyZWQgZXJyb3InLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcignVG9rZW4gZXhwaXJlZCcpO1xyXG4gICAgICBleGNlcHRpb24ubmFtZSA9ICdUb2tlbkV4cGlyZWRFcnJvcic7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5jb2RlKS50b0JlKEVycm9yQ29kZXMuQVVUSF9UT0tFTl9FWFBJUkVEKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgSldUIE5vdEJlZm9yZUVycm9yJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgRXJyb3IoJ1Rva2VuIG5vdCBhY3RpdmUnKTtcclxuICAgICAgZXhjZXB0aW9uLm5hbWUgPSAnTm90QmVmb3JlRXJyb3InO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IuY29kZSkudG9CZShFcnJvckNvZGVzLkFVVEhfVE9LRU5fSU5WQUxJRCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGlkZW50aWZ5IGRhdGFiYXNlIGNvbm5lY3Rpb24gZXJyb3InLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcignRUNPTk5SRUZVU0VEIHRvIGRhdGFiYXNlJyk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5jb2RlKS50b0JlKEVycm9yQ29kZXMuU0VSVkVSX0RBVEFCQVNFX0VSUk9SKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgcG9zdGdyZXMgZXJyb3InLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcigncG9zdGdyZXMgY29ubmVjdGlvbiBmYWlsZWQnKTtcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gbW9ja1Jlc3BvbnNlLmpzb24ubW9jay5jYWxsc1swXVswXTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmVycm9yLmNvZGUpLnRvQmUoRXJyb3JDb2Rlcy5TRVJWRVJfREFUQUJBU0VfRVJST1IpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBpZGVudGlmeSB1bmlxdWUgY29uc3RyYWludCB2aW9sYXRpb24nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcihcclxuICAgICAgICAnZHVwbGljYXRlIGtleSB2YWx1ZSB2aW9sYXRlcyB1bmlxdWUgY29uc3RyYWludCcsXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5lcnJvci5jb2RlKS50b0JlKEVycm9yQ29kZXMuUkVTT1VSQ0VfQUxSRUFEWV9FWElTVFMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBpZGVudGlmeSBKU09OIHBhcnNlIGVycm9yJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgU3ludGF4RXJyb3IoJ1VuZXhwZWN0ZWQgdG9rZW4gaW4gSlNPTicpO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IuY29kZSkudG9CZShFcnJvckNvZGVzLlZBTElEQVRJT05fRVJST1IpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCBjb2RlIGZvciB1bmtub3duIGVycm9yJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKTtcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gbW9ja1Jlc3BvbnNlLmpzb24ubW9jay5jYWxsc1swXVswXTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmVycm9yLmNvZGUpLnRvQmUoRXJyb3JDb2Rlcy5TRVJWRVJfRVJST1IpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdIdHRwRXhjZXB0aW9uIGhhbmRsaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgSHR0cEV4Y2VwdGlvbiB3aXRoIHdhcm5pbmcnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxvZ2dlcldhcm5TcHkgPSBqZXN0LnNweU9uKGZpbHRlclsnbG9nZ2VyJ10sICd3YXJuJyk7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBIdHRwRXhjZXB0aW9uKCdOb3QgRm91bmQnLCBIdHRwU3RhdHVzLk5PVF9GT1VORCk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBleHBlY3QobG9nZ2VyV2FyblNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgJ0h0dHBFeGNlcHRpb24gY2F1Z2h0IGJ5IEFsbEV4Y2VwdGlvbnNGaWx0ZXIgLSB0aGlzIHNob3VsZCBub3QgaGFwcGVuJyxcclxuICAgICAgKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwNCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3JlcXVlc3QgSUQgZXh0cmFjdGlvbicsICgpID0+IHtcclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICdkZXZlbG9wbWVudCc7XHJcbiAgICAgIGZpbHRlciA9IG5ldyBBbGxFeGNlcHRpb25zRmlsdGVyKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGV4dHJhY3QgeC1yZXF1ZXN0LWlkIGZyb20gaGVhZGVycycsICgpID0+IHtcclxuICAgICAgbW9ja1JlcXVlc3QuaGVhZGVyc1sneC1yZXF1ZXN0LWlkJ10gPSAncmVxLTEyMyc7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UubWV0YS5yZXF1ZXN0SWQpLnRvQmUoJ3JlcS0xMjMnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZXh0cmFjdCB4LWNvcnJlbGF0aW9uLWlkIGlmIHgtcmVxdWVzdC1pZCBpcyBub3QgcHJlc2VudCcsICgpID0+IHtcclxuICAgICAgbW9ja1JlcXVlc3QuaGVhZGVyc1sneC1jb3JyZWxhdGlvbi1pZCddID0gJ2NvcnItNDU2JztcclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEVycm9yKCdUZXN0IGVycm9yJyk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IG1vY2tSZXNwb25zZS5qc29uLm1vY2suY2FsbHNbMF1bMF07XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5tZXRhLnJlcXVlc3RJZCkudG9CZSgnY29yci00NTYnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgbm90IGluY2x1ZGUgcmVxdWVzdElkIGlmIG5laXRoZXIgaGVhZGVyIGlzIHByZXNlbnQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UubWV0YS5yZXF1ZXN0SWQpLnRvQmVVbmRlZmluZWQoKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnbm9uLUVycm9yIGV4Y2VwdGlvbiBoYW5kbGluZycsICgpID0+IHtcclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICdkZXZlbG9wbWVudCc7XHJcbiAgICAgIGZpbHRlciA9IG5ldyBBbGxFeGNlcHRpb25zRmlsdGVyKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzdHJpbmcgdGhyb3dzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSAnc3RyaW5nIGVycm9yJztcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2Uuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg1MDApO1xyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgbG9nIHN0cmluZyB0aHJvd3MgYXBwcm9wcmlhdGVseScsICgpID0+IHtcclxuICAgICAgY29uc3QgbG9nZ2VyRXJyb3JTcHkgPSBqZXN0LnNweU9uKGZpbHRlclsnbG9nZ2VyJ10sICdlcnJvcicpO1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSAnc3RyaW5nIGVycm9yJztcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGV4cGVjdChsb2dnZXJFcnJvclNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICBjb25zdCBsb2dDYWxsID0gbG9nZ2VyRXJyb3JTcHkubW9jay5jYWxsc1swXTtcclxuICAgICAgZXhwZWN0KGxvZ0NhbGxbMF0pLnRvQ29udGFpbignVW5rbm93biBleGNlcHRpb24gdHlwZScpO1xyXG4gICAgICBleHBlY3QobG9nQ2FsbFsxXSkudG9CZSgnc3RyaW5nIGVycm9yJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2xvZ2dpbmcnLCAoKSA9PiB7XHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAnZGV2ZWxvcG1lbnQnO1xyXG4gICAgICBmaWx0ZXIgPSBuZXcgQWxsRXhjZXB0aW9uc0ZpbHRlcigpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBhbHdheXMgbG9nIHdpdGggc3RhY2sgdHJhY2UgZm9yIEVycm9yIGluc3RhbmNlcycsICgpID0+IHtcclxuICAgICAgY29uc3QgbG9nZ2VyRXJyb3JTcHkgPSBqZXN0LnNweU9uKGZpbHRlclsnbG9nZ2VyJ10sICdlcnJvcicpO1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgRXJyb3IoJ1Rlc3QgZXJyb3Igd2l0aCBzdGFjaycpO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgZXhwZWN0KGxvZ2dlckVycm9yU3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgIGNvbnN0IGxvZ0NhbGwgPSBsb2dnZXJFcnJvclNweS5tb2NrLmNhbGxzWzBdO1xyXG4gICAgICBleHBlY3QobG9nQ2FsbFsxXSkudG9CZVRydXRoeSgpOyAvLyBTdGFjayB0cmFjZVxyXG4gICAgICBleHBlY3QobG9nQ2FsbFsyXSkudG9Db250YWluKCdtZXRob2QnKTsgLy8gTG9nIGNvbnRleHRcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaW5jbHVkZSByZXF1ZXN0IG1ldGFkYXRhIGluIGxvZyBjb250ZXh0JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBsb2dnZXJFcnJvclNweSA9IGplc3Quc3B5T24oZmlsdGVyWydsb2dnZXInXSwgJ2Vycm9yJyk7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgbG9nQ29udGV4dFN0ciA9IGxvZ2dlckVycm9yU3B5Lm1vY2suY2FsbHNbMF1bMl07XHJcbiAgICAgIGNvbnN0IGxvZ0NvbnRleHQgPSBKU09OLnBhcnNlKGxvZ0NvbnRleHRTdHIpO1xyXG5cclxuICAgICAgZXhwZWN0KGxvZ0NvbnRleHQpLnRvTWF0Y2hPYmplY3Qoe1xyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIHVybDogJy9hcGkvdGVzdCcsXHJcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxyXG4gICAgICAgIHVzZXJBZ2VudDogJ3Rlc3QtYWdlbnQnLFxyXG4gICAgICAgIHRpbWVzdGFtcDogZXhwZWN0LmFueShTdHJpbmcpLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdHJ1bmNhdGUgbG9uZyB1c2VyIGFnZW50cycsICgpID0+IHtcclxuICAgICAgY29uc3QgbG9nZ2VyRXJyb3JTcHkgPSBqZXN0LnNweU9uKGZpbHRlclsnbG9nZ2VyJ10sICdlcnJvcicpO1xyXG4gICAgICBjb25zdCBsb25nVXNlckFnZW50ID0gJ3gnLnJlcGVhdCgyMDApO1xyXG4gICAgICBtb2NrUmVxdWVzdC5oZWFkZXJzWyd1c2VyLWFnZW50J10gPSBsb25nVXNlckFnZW50O1xyXG5cclxuICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEVycm9yKCdUZXN0IGVycm9yJyk7XHJcblxyXG4gICAgICBmaWx0ZXIuY2F0Y2goZXhjZXB0aW9uLCBtb2NrQXJndW1lbnRzSG9zdCk7XHJcblxyXG4gICAgICBjb25zdCBsb2dDb250ZXh0U3RyID0gbG9nZ2VyRXJyb3JTcHkubW9jay5jYWxsc1swXVsyXTtcclxuICAgICAgY29uc3QgbG9nQ29udGV4dCA9IEpTT04ucGFyc2UobG9nQ29udGV4dFN0cik7XHJcblxyXG4gICAgICBleHBlY3QobG9nQ29udGV4dC51c2VyQWdlbnQubGVuZ3RoKS50b0JlKDEwMCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3Jlc3BvbnNlIGZvcm1hdCcsICgpID0+IHtcclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICdkZXZlbG9wbWVudCc7XHJcbiAgICAgIGZpbHRlciA9IG5ldyBBbGxFeGNlcHRpb25zRmlsdGVyKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIG5ldmVyIGluY2x1ZGUgc3RhY2sgdHJhY2UgaW4gcmVzcG9uc2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xyXG4gICAgICBleGNlcHRpb24uc3RhY2sgPSAnRXJyb3I6IFRlc3QgZXJyb3JcXG4gICAgYXQgc29tZXRoaW5nLi4uJztcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gbW9ja1Jlc3BvbnNlLmpzb24ubW9jay5jYWxsc1swXVswXTtcclxuICAgICAgZXhwZWN0KEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSkubm90LnRvQ29udGFpbihleGNlcHRpb24uc3RhY2spO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBhbHdheXMgc2V0IHN1Y2Nlc3MgdG8gZmFsc2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGV4Y2VwdGlvbiA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xyXG5cclxuICAgICAgZmlsdGVyLmNhdGNoKGV4Y2VwdGlvbiwgbW9ja0FyZ3VtZW50c0hvc3QpO1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBtb2NrUmVzcG9uc2UuanNvbi5tb2NrLmNhbGxzWzBdWzBdO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3VjY2VzcykudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgcHJvcGVyIG1ldGFkYXRhJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleGNlcHRpb24gPSBuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKTtcclxuXHJcbiAgICAgIGZpbHRlci5jYXRjaChleGNlcHRpb24sIG1vY2tBcmd1bWVudHNIb3N0KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gbW9ja1Jlc3BvbnNlLmpzb24ubW9jay5jYWxsc1swXVswXTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLm1ldGEpLnRvTWF0Y2hPYmplY3Qoe1xyXG4gICAgICAgIHRpbWVzdGFtcDogZXhwZWN0LmFueShTdHJpbmcpLFxyXG4gICAgICAgIHBhdGg6ICcvYXBpL3Rlc3QnLFxyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9