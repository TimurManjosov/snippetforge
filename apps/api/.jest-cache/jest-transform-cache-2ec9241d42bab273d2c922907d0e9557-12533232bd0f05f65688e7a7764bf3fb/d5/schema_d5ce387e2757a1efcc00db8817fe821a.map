{"version":3,"names":["cov_1li6u5xz46","actualCoverage","s","pg_core_1","require","exports","roleEnum","pgEnum","users","pgTable","id","uuid","primaryKey","defaultRandom","email","varchar","length","notNull","unique","username","passwordHash","bio","text","avatarUrl","role","default","createdAt","timestamp","withTimezone","defaultNow","updatedAt","table","f","emailIdx","index","on","usernameIdx","roleIdx","snippets","title","description","code","language","userId","references","onDelete","isPublic","boolean","viewCount","integer","$onUpdate","Date","userIdIdx","languageIdx","createdAtIdx","publicCreatedAtIdx"],"sources":["/home/runner/work/snippetforge/snippetforge/apps/api/src/lib/db/schema.ts"],"sourcesContent":["import {\n  boolean,\n  index,\n  integer,\n  pgEnum,\n  pgTable,\n  text,\n  timestamp,\n  uuid,\n  varchar,\n} from 'drizzle-orm/pg-core';\n\n// Role Enum\nexport const roleEnum = pgEnum('role', ['USER', 'ADMIN', 'MODERATOR']);\n\n// Users Table\nexport const users = pgTable(\n  'users',\n  {\n    id: uuid('id').primaryKey().defaultRandom(),\n    email: varchar('email', { length: 255 }).notNull().unique(),\n    username: varchar('username', { length: 30 }).notNull().unique(),\n    passwordHash: varchar('password_hash', { length: 60 }).notNull(),\n    bio: text('bio'),\n    avatarUrl: text('avatar_url'),\n    role: roleEnum('role').default('USER').notNull(),\n    createdAt: timestamp('created_at', { withTimezone: true })\n      .defaultNow()\n      .notNull(),\n    updatedAt: timestamp('updated_at', { withTimezone: true })\n      .defaultNow()\n      .notNull(),\n  },\n  (table) => ({\n    emailIdx: index('users_email_idx').on(table.email),\n    usernameIdx: index('users_username_idx').on(table.username),\n    roleIdx: index('users_role_idx').on(table.role),\n  }),\n);\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type NewUser = typeof users.$inferInsert;\n\n/**\n * Snippets Table - Code Snippets created by Users\n *\n * BUSINESS RULES:\n * - Each snippet belongs to a user (Foreign Key with CASCADE DELETE)\n * - Title is required, max 200 characters\n * - Code is required, max 50,000 characters\n * - Language is required (e.g. \"typescript\", \"python\")\n * - Description is optional\n * - isPublic defaults to true (Snippets are public by default)\n * - viewCount is automatically incremented\n *\n * PERFORMANCE:\n * - Index on userId (for \"my snippets\" queries)\n * - Index on language (for \"all TypeScript snippets\" queries)\n * - Index on createdAt (for sorting)\n * - Composite index on (isPublic, createdAt) for common query pattern\n *\n * SECURITY:\n * - CASCADE DELETE: When user is deleted, their snippets are also deleted\n */\nexport const snippets = pgTable(\n  'snippets',\n  {\n    // ========================================\n    // PRIMARY KEY\n    // ========================================\n\n    id: uuid('id').primaryKey().defaultRandom(),\n\n    // ========================================\n    // SNIPPET CONTENT\n    // ========================================\n\n    /**\n     * Snippet title\n     * Max 200 characters (for clarity)\n     */\n    title: varchar('title', { length: 200 }).notNull(),\n\n    /**\n     * Optional description\n     * Explains what the code does\n     */\n    description: text('description'),\n\n    /**\n     * The actual code\n     * Max 50,000 characters (prevents excessively large files)\n     */\n    code: text('code').notNull(),\n\n    /**\n     * Programming language\n     * Used for syntax highlighting\n     * Examples: \"typescript\", \"python\", \"javascript\", \"rust\"\n     */\n    language: varchar('language', { length: 50 }).notNull(),\n\n    // ========================================\n    // RELATIONSHIPS\n    // ========================================\n    /**\n     * Foreign Key to Users\n     * CASCADE DELETE: When user is deleted, their snippets are also deleted\n     */\n    userId: uuid('user_id')\n      .notNull()\n      .references(() => users.id, { onDelete: 'cascade' }),\n\n    // ========================================\n    // VISIBILITY & METRICS\n    // ========================================\n\n    /**\n     * Visibility\n     * true = Public (everyone can see)\n     * false = Private (only owner can see)\n     */\n    isPublic: boolean('is_public').default(true).notNull(),\n\n    /**\n     * Number of views\n     * Incremented when someone opens the snippet\n     */\n    viewCount: integer('view_count').default(0).notNull(),\n\n    // ========================================\n    // TIMESTAMPS\n    // ========================================\n\n    createdAt: timestamp('created_at', { withTimezone: true })\n      .defaultNow()\n      .notNull(),\n    updatedAt: timestamp('updated_at', { withTimezone: true })\n      .defaultNow()\n      .$onUpdate(() => new Date())\n      .notNull(),\n  },\n  (table) => ({\n    // ========================================\n    // INDICES (Performance!)\n    // ========================================\n\n    /**\n     * Index on userId\n     * Query: \"All my snippets\" (SELECT * FROM snippets WHERE user_id = ?)\n     * Without index: Full Table Scan\n     * With index: Index Scan (10-1000x faster)\n     */\n    userIdIdx: index('snippets_user_id_idx').on(table.userId),\n\n    /**\n     * Index on language\n     * Query: \"All TypeScript snippets\" (SELECT * FROM snippets WHERE language = 'typescript')\n     */\n    languageIdx: index('snippets_language_idx').on(table.language),\n\n    /**\n     * Index on createdAt\n     * Query: Sort by date (ORDER BY created_at DESC)\n     */\n    createdAtIdx: index('snippets_created_at_idx').on(table.createdAt),\n\n    /**\n     * Composite index for most common query: \"Public snippets sorted by date\"\n     * Query: SELECT * FROM snippets WHERE is_public = true ORDER BY created_at DESC\n     */\n    publicCreatedAtIdx: index('snippets_public_created_at_idx').on(\n      table.isPublic,\n      table.createdAt,\n    ),\n  }),\n);\n\n/**\n * Snippet Type (read from database)\n */\nexport type Snippet = typeof snippets.$inferSelect;\n/**\n * New Snippet Type (for INSERT operations)\n */\nexport type NewSnippet = typeof snippets.$inferInsert;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA0BI;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAAAA,cAAA,GAAAE,CAAA;;;;;;;AA1BJ,MAAAC,SAAA;AAAA;AAAA,CAAAH,cAAA,GAAAE,CAAA,OAAAE,OAAA;AAYA;AAAA;AAAAJ,cAAA,GAAAE,CAAA;AACaG,OAAA,CAAAC,QAAQ,GAAG,IAAAH,SAAA,CAAAI,MAAM,EAAC,MAAM,EAAE,CAAC,MAAM,EAAE,OAAO,EAAE,WAAW,CAAC,CAAC;AAEtE;AAAA;AAAAP,cAAA,GAAAE,CAAA;AACaG,OAAA,CAAAG,KAAK,GAAG,IAAAL,SAAA,CAAAM,OAAO,EAC1B,OAAO,EACP;EACEC,EAAE,EAAE,IAAAP,SAAA,CAAAQ,IAAI,EAAC,IAAI,CAAC,CAACC,UAAU,EAAE,CAACC,aAAa,EAAE;EAC3CC,KAAK,EAAE,IAAAX,SAAA,CAAAY,OAAO,EAAC,OAAO,EAAE;IAAEC,MAAM,EAAE;EAAG,CAAE,CAAC,CAACC,OAAO,EAAE,CAACC,MAAM,EAAE;EAC3DC,QAAQ,EAAE,IAAAhB,SAAA,CAAAY,OAAO,EAAC,UAAU,EAAE;IAAEC,MAAM,EAAE;EAAE,CAAE,CAAC,CAACC,OAAO,EAAE,CAACC,MAAM,EAAE;EAChEE,YAAY,EAAE,IAAAjB,SAAA,CAAAY,OAAO,EAAC,eAAe,EAAE;IAAEC,MAAM,EAAE;EAAE,CAAE,CAAC,CAACC,OAAO,EAAE;EAChEI,GAAG,EAAE,IAAAlB,SAAA,CAAAmB,IAAI,EAAC,KAAK,CAAC;EAChBC,SAAS,EAAE,IAAApB,SAAA,CAAAmB,IAAI,EAAC,YAAY,CAAC;EAC7BE,IAAI,EAAE,IAAAnB,OAAA,CAAAC,QAAQ,EAAC,MAAM,CAAC,CAACmB,OAAO,CAAC,MAAM,CAAC,CAACR,OAAO,EAAE;EAChDS,SAAS,EAAE,IAAAvB,SAAA,CAAAwB,SAAS,EAAC,YAAY,EAAE;IAAEC,YAAY,EAAE;EAAI,CAAE,CAAC,CACvDC,UAAU,EAAE,CACZZ,OAAO,EAAE;EACZa,SAAS,EAAE,IAAA3B,SAAA,CAAAwB,SAAS,EAAC,YAAY,EAAE;IAAEC,YAAY,EAAE;EAAI,CAAE,CAAC,CACvDC,UAAU,EAAE,CACZZ,OAAO;CACX,EACAc,KAAK,IAAM;EAAA;EAAA/B,cAAA,GAAAgC,CAAA;EAAAhC,cAAA,GAAAE,CAAA;EAAA;IACV+B,QAAQ,EAAE,IAAA9B,SAAA,CAAA+B,KAAK,EAAC,iBAAiB,CAAC,CAACC,EAAE,CAACJ,KAAK,CAACjB,KAAK,CAAC;IAClDsB,WAAW,EAAE,IAAAjC,SAAA,CAAA+B,KAAK,EAAC,oBAAoB,CAAC,CAACC,EAAE,CAACJ,KAAK,CAACZ,QAAQ,CAAC;IAC3DkB,OAAO,EAAE,IAAAlC,SAAA,CAAA+B,KAAK,EAAC,gBAAgB,CAAC,CAACC,EAAE,CAACJ,KAAK,CAACP,IAAI;GAC/C;CAAC,CACH;AAMD;;;;;;;;;;;;;;;;;;;;;AAAA;AAAAxB,cAAA,GAAAE,CAAA;AAqBaG,OAAA,CAAAiC,QAAQ,GAAG,IAAAnC,SAAA,CAAAM,OAAO,EAC7B,UAAU,EACV;EACE;EACA;EACA;EAEAC,EAAE,EAAE,IAAAP,SAAA,CAAAQ,IAAI,EAAC,IAAI,CAAC,CAACC,UAAU,EAAE,CAACC,aAAa,EAAE;EAE3C;EACA;EACA;EAEA;;;;EAIA0B,KAAK,EAAE,IAAApC,SAAA,CAAAY,OAAO,EAAC,OAAO,EAAE;IAAEC,MAAM,EAAE;EAAG,CAAE,CAAC,CAACC,OAAO,EAAE;EAElD;;;;EAIAuB,WAAW,EAAE,IAAArC,SAAA,CAAAmB,IAAI,EAAC,aAAa,CAAC;EAEhC;;;;EAIAmB,IAAI,EAAE,IAAAtC,SAAA,CAAAmB,IAAI,EAAC,MAAM,CAAC,CAACL,OAAO,EAAE;EAE5B;;;;;EAKAyB,QAAQ,EAAE,IAAAvC,SAAA,CAAAY,OAAO,EAAC,UAAU,EAAE;IAAEC,MAAM,EAAE;EAAE,CAAE,CAAC,CAACC,OAAO,EAAE;EAEvD;EACA;EACA;EACA;;;;EAIA0B,MAAM,EAAE,IAAAxC,SAAA,CAAAQ,IAAI,EAAC,SAAS,CAAC,CACpBM,OAAO,EAAE,CACT2B,UAAU,CAAC,MAAM;IAAA;IAAA5C,cAAA,GAAAgC,CAAA;IAAAhC,cAAA,GAAAE,CAAA;IAAA,OAAAG,OAAA,CAAAG,KAAK,CAACE,EAAE;EAAF,CAAE,EAAE;IAAEmC,QAAQ,EAAE;EAAS,CAAE,CAAC;EAEtD;EACA;EACA;EAEA;;;;;EAKAC,QAAQ,EAAE,IAAA3C,SAAA,CAAA4C,OAAO,EAAC,WAAW,CAAC,CAACtB,OAAO,CAAC,IAAI,CAAC,CAACR,OAAO,EAAE;EAEtD;;;;EAIA+B,SAAS,EAAE,IAAA7C,SAAA,CAAA8C,OAAO,EAAC,YAAY,CAAC,CAACxB,OAAO,CAAC,CAAC,CAAC,CAACR,OAAO,EAAE;EAErD;EACA;EACA;EAEAS,SAAS,EAAE,IAAAvB,SAAA,CAAAwB,SAAS,EAAC,YAAY,EAAE;IAAEC,YAAY,EAAE;EAAI,CAAE,CAAC,CACvDC,UAAU,EAAE,CACZZ,OAAO,EAAE;EACZa,SAAS,EAAE,IAAA3B,SAAA,CAAAwB,SAAS,EAAC,YAAY,EAAE;IAAEC,YAAY,EAAE;EAAI,CAAE,CAAC,CACvDC,UAAU,EAAE,CACZqB,SAAS,CAAC,MAAM;IAAA;IAAAlD,cAAA,GAAAgC,CAAA;IAAAhC,cAAA,GAAAE,CAAA;IAAA,WAAIiD,IAAI,EAAE;EAAF,CAAE,CAAC,CAC3BlC,OAAO;CACX,EACAc,KAAK,IAAM;EAAA;EAAA/B,cAAA,GAAAgC,CAAA;EAAAhC,cAAA,GAAAE,CAAA;EAAA;IACV;IACA;IACA;IAEA;;;;;;IAMAkD,SAAS,EAAE,IAAAjD,SAAA,CAAA+B,KAAK,EAAC,sBAAsB,CAAC,CAACC,EAAE,CAACJ,KAAK,CAACY,MAAM,CAAC;IAEzD;;;;IAIAU,WAAW,EAAE,IAAAlD,SAAA,CAAA+B,KAAK,EAAC,uBAAuB,CAAC,CAACC,EAAE,CAACJ,KAAK,CAACW,QAAQ,CAAC;IAE9D;;;;IAIAY,YAAY,EAAE,IAAAnD,SAAA,CAAA+B,KAAK,EAAC,yBAAyB,CAAC,CAACC,EAAE,CAACJ,KAAK,CAACL,SAAS,CAAC;IAElE;;;;IAIA6B,kBAAkB,EAAE,IAAApD,SAAA,CAAA+B,KAAK,EAAC,gCAAgC,CAAC,CAACC,EAAE,CAC5DJ,KAAK,CAACe,QAAQ,EACdf,KAAK,CAACL,SAAS;GAElB;CAAC,CACH","ignoreList":[]}