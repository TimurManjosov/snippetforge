{"file":"/home/runner/work/snippetforge/snippetforge/apps/api/src/lib/db/schema.ts","mappings":"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","names":[],"sources":["/home/runner/work/snippetforge/snippetforge/apps/api/src/lib/db/schema.ts"],"sourcesContent":["import {\n  boolean,\n  index,\n  integer,\n  pgEnum,\n  pgTable,\n  text,\n  timestamp,\n  uuid,\n  varchar,\n} from 'drizzle-orm/pg-core';\n\n// Role Enum\nexport const roleEnum = pgEnum('role', ['USER', 'ADMIN', 'MODERATOR']);\n\n// Users Table\nexport const users = pgTable(\n  'users',\n  {\n    id: uuid('id').primaryKey().defaultRandom(),\n    email: varchar('email', { length: 255 }).notNull().unique(),\n    username: varchar('username', { length: 30 }).notNull().unique(),\n    passwordHash: varchar('password_hash', { length: 60 }).notNull(),\n    bio: text('bio'),\n    avatarUrl: text('avatar_url'),\n    role: roleEnum('role').default('USER').notNull(),\n    createdAt: timestamp('created_at', { withTimezone: true })\n      .defaultNow()\n      .notNull(),\n    updatedAt: timestamp('updated_at', { withTimezone: true })\n      .defaultNow()\n      .notNull(),\n  },\n  (table) => ({\n    emailIdx: index('users_email_idx').on(table.email),\n    usernameIdx: index('users_username_idx').on(table.username),\n    roleIdx: index('users_role_idx').on(table.role),\n  }),\n);\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type NewUser = typeof users.$inferInsert;\n\n/**\n * Snippets Table - Code Snippets created by Users\n *\n * BUSINESS RULES:\n * - Each snippet belongs to a user (Foreign Key with CASCADE DELETE)\n * - Title is required, max 200 characters\n * - Code is required, max 50,000 characters\n * - Language is required (e.g. \"typescript\", \"python\")\n * - Description is optional\n * - isPublic defaults to true (Snippets are public by default)\n * - viewCount is automatically incremented\n *\n * PERFORMANCE:\n * - Index on userId (for \"my snippets\" queries)\n * - Index on language (for \"all TypeScript snippets\" queries)\n * - Index on createdAt (for sorting)\n * - Composite index on (isPublic, createdAt) for common query pattern\n *\n * SECURITY:\n * - CASCADE DELETE: When user is deleted, their snippets are also deleted\n */\nexport const snippets = pgTable(\n  'snippets',\n  {\n    // ========================================\n    // PRIMARY KEY\n    // ========================================\n\n    id: uuid('id').primaryKey().defaultRandom(),\n\n    // ========================================\n    // SNIPPET CONTENT\n    // ========================================\n\n    /**\n     * Snippet title\n     * Max 200 characters (for clarity)\n     */\n    title: varchar('title', { length: 200 }).notNull(),\n\n    /**\n     * Optional description\n     * Explains what the code does\n     */\n    description: text('description'),\n\n    /**\n     * The actual code\n     * Max 50,000 characters (prevents excessively large files)\n     */\n    code: text('code').notNull(),\n\n    /**\n     * Programming language\n     * Used for syntax highlighting\n     * Examples: \"typescript\", \"python\", \"javascript\", \"rust\"\n     */\n    language: varchar('language', { length: 50 }).notNull(),\n\n    // ========================================\n    // RELATIONSHIPS\n    // ========================================\n    /**\n     * Foreign Key to Users\n     * CASCADE DELETE: When user is deleted, their snippets are also deleted\n     */\n    userId: uuid('user_id')\n      .notNull()\n      .references(() => users.id, { onDelete: 'cascade' }),\n\n    // ========================================\n    // VISIBILITY & METRICS\n    // ========================================\n\n    /**\n     * Visibility\n     * true = Public (everyone can see)\n     * false = Private (only owner can see)\n     */\n    isPublic: boolean('is_public').default(true).notNull(),\n\n    /**\n     * Number of views\n     * Incremented when someone opens the snippet\n     */\n    viewCount: integer('view_count').default(0).notNull(),\n\n    // ========================================\n    // TIMESTAMPS\n    // ========================================\n\n    createdAt: timestamp('created_at', { withTimezone: true })\n      .defaultNow()\n      .notNull(),\n    updatedAt: timestamp('updated_at', { withTimezone: true })\n      .defaultNow()\n      .$onUpdate(() => new Date())\n      .notNull(),\n  },\n  (table) => ({\n    // ========================================\n    // INDICES (Performance!)\n    // ========================================\n\n    /**\n     * Index on userId\n     * Query: \"All my snippets\" (SELECT * FROM snippets WHERE user_id = ?)\n     * Without index: Full Table Scan\n     * With index: Index Scan (10-1000x faster)\n     */\n    userIdIdx: index('snippets_user_id_idx').on(table.userId),\n\n    /**\n     * Index on language\n     * Query: \"All TypeScript snippets\" (SELECT * FROM snippets WHERE language = 'typescript')\n     */\n    languageIdx: index('snippets_language_idx').on(table.language),\n\n    /**\n     * Index on createdAt\n     * Query: Sort by date (ORDER BY created_at DESC)\n     */\n    createdAtIdx: index('snippets_created_at_idx').on(table.createdAt),\n\n    /**\n     * Composite index for most common query: \"Public snippets sorted by date\"\n     * Query: SELECT * FROM snippets WHERE is_public = true ORDER BY created_at DESC\n     */\n    publicCreatedAtIdx: index('snippets_public_created_at_idx').on(\n      table.isPublic,\n      table.createdAt,\n    ),\n  }),\n);\n\n/**\n * Snippet Type (read from database)\n */\nexport type Snippet = typeof snippets.$inferSelect;\n/**\n * New Snippet Type (for INSERT operations)\n */\nexport type NewSnippet = typeof snippets.$inferInsert;\n"],"version":3}