c90ed059ea838200aa4244376ed0fdfb
"use strict";
// test/unit/services/auth.service.spec. ts
Object.defineProperty(exports, "__esModule", { value: true });
const common_1 = require("@nestjs/common");
const config_1 = require("@nestjs/config");
const jwt_1 = require("@nestjs/jwt");
const testing_1 = require("@nestjs/testing");
const auth_service_1 = require("../../../src/modules/auth/auth.service");
const users_service_1 = require("../../../src/modules/users/users.service");
const factories_1 = require("../../factories");
const mocks_1 = require("../../mocks");
/**
 * AuthService Unit Tests
 *
 * Testet:
 * - Registration
 * - Login
 * - Token Generation
 * - Error Handling
 */
describe('AuthService', () => {
    let service;
    let usersService;
    let jwtService;
    beforeEach(async () => {
        usersService = (0, mocks_1.createMockUsersService)();
        jwtService = (0, mocks_1.createMockJwtService)();
        const module = await testing_1.Test.createTestingModule({
            providers: [
                auth_service_1.AuthService,
                {
                    provide: users_service_1.UsersService,
                    useValue: usersService,
                },
                {
                    provide: jwt_1.JwtService,
                    useValue: jwtService,
                },
                {
                    provide: config_1.ConfigService,
                    useValue: {
                        get: jest.fn((key) => {
                            const config = {
                                JWT_SECRET: 'test-secret',
                                JWT_EXPIRES_IN: '15m',
                            };
                            return config[key];
                        }),
                    },
                },
            ],
        }).compile();
        service = module.get(auth_service_1.AuthService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    // ============================================================
    // REGISTER
    // ============================================================
    describe('register', () => {
        it('should register a new user and return tokens', async () => {
            // Arrange
            const dto = (0, factories_1.createRegisterDto)();
            const mockUser = (0, mocks_1.createMockSafeUser)({
                email: dto.email,
                username: dto.username,
            });
            usersService.create.mockResolvedValue(mockUser);
            // Act
            const result = await service.register(dto);
            // Assert
            expect(usersService.create).toHaveBeenCalledWith({
                email: dto.email,
                username: dto.username,
                password: dto.password,
            });
            expect(result.user).toEqual(mockUser);
            expect(result.tokens).toBeDefined();
            expect(result.tokens.accessToken).toBeDefined();
            expect(result.tokens.tokenType).toBe('Bearer');
        });
        it('should generate JWT with correct payload', async () => {
            // Arrange
            const dto = (0, factories_1.createRegisterDto)();
            const mockUser = (0, mocks_1.createMockSafeUser)({
                id: 'user-123',
                email: dto.email,
                role: 'USER',
            });
            usersService.create.mockResolvedValue(mockUser);
            // Act
            await service.register(dto);
            // Assert
            expect(jwtService.signAsync).toHaveBeenCalledWith(expect.objectContaining({
                sub: 'user-123',
                email: dto.email,
                role: 'USER',
            }));
        });
        it('should propagate ConflictException from UsersService', async () => {
            // Arrange
            const dto = (0, factories_1.createRegisterDto)();
            usersService.create.mockRejectedValue(new Error('Email is already registered'));
            // Act & Assert
            await expect(service.register(dto)).rejects.toThrow();
        });
    });
    // ============================================================
    // LOGIN
    // ============================================================
    describe('login', () => {
        it('should login user and return tokens', async () => {
            // Arrange
            const dto = (0, factories_1.createLoginDto)();
            const mockUser = (0, mocks_1.createMockSafeUser)({ email: dto.email });
            usersService.validateCredentials.mockResolvedValue(mockUser);
            // Act
            const result = await service.login(dto);
            // Assert
            expect(usersService.validateCredentials).toHaveBeenCalledWith(dto.email, dto.password);
            expect(result.user).toEqual(mockUser);
            expect(result.tokens.accessToken).toBeDefined();
        });
        it('should throw UnauthorizedException when credentials are invalid', async () => {
            // Arrange
            const dto = (0, factories_1.createLoginDto)();
            usersService.validateCredentials.mockResolvedValue(null);
            // Act & Assert
            await expect(service.login(dto)).rejects.toThrow(common_1.UnauthorizedException);
            await expect(service.login(dto)).rejects.toThrow('Invalid email or password');
        });
        it('should generate JWT with correct payload on login', async () => {
            // Arrange
            const dto = (0, factories_1.createLoginDto)();
            const mockUser = (0, mocks_1.createMockSafeUser)({
                id: 'user-456',
                email: dto.email,
                role: 'ADMIN',
            });
            usersService.validateCredentials.mockResolvedValue(mockUser);
            // Act
            await service.login(dto);
            // Assert
            expect(jwtService.signAsync).toHaveBeenCalledWith(expect.objectContaining({
                sub: 'user-456',
                email: dto.email,
                role: 'ADMIN',
            }));
        });
    });
    // ============================================================
    // TOKEN GENERATION
    // ============================================================
    describe('token generation', () => {
        it('should include expiresIn in token response', async () => {
            // Arrange
            const dto = (0, factories_1.createRegisterDto)();
            usersService.create.mockResolvedValue((0, mocks_1.createMockSafeUser)());
            // Act
            const result = await service.register(dto);
            // Assert
            expect(result.tokens.expiresIn).toBeDefined();
            expect(typeof result.tokens.expiresIn).toBe('number');
        });
        it('should set tokenType to Bearer', async () => {
            // Arrange
            const dto = (0, factories_1.createLoginDto)();
            usersService.validateCredentials.mockResolvedValue((0, mocks_1.createMockSafeUser)());
            // Act
            const result = await service.login(dto);
            // Assert
            expect(result.tokens.tokenType).toBe('Bearer');
        });
    });
    // ============================================================
    // VALIDATE USER BY ID
    // ============================================================
    describe('validateUserById', () => {
        it('should return user when found', async () => {
            // Arrange
            const mockUser = (0, mocks_1.createMockSafeUser)();
            usersService.findById.mockResolvedValue(mockUser);
            // Act
            const result = await service.validateUserById('user-123');
            // Assert
            expect(usersService.findById).toHaveBeenCalledWith('user-123');
            expect(result).toEqual(mockUser);
        });
        it('should propagate NotFoundException from UsersService', async () => {
            // Arrange
            usersService.findById.mockRejectedValue(new Error('User not found'));
            // Act & Assert
            await expect(service.validateUserById('nonexistent')).rejects.toThrow();
        });
    });
    // ============================================================
    // GET CURRENT USER
    // ============================================================
    describe('getCurrentUser', () => {
        it('should return user by id', async () => {
            // Arrange
            const mockUser = (0, mocks_1.createMockSafeUser)({ id: 'current-user-id' });
            usersService.findById.mockResolvedValue(mockUser);
            // Act
            const result = await service.getCurrentUser('current-user-id');
            // Assert
            expect(result).toEqual(mockUser);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc25pcHBldGZvcmdlL3NuaXBwZXRmb3JnZS9hcHBzL2FwaS90ZXN0L3VuaXQvc2VydmljZXMvYXV0aC5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6IjtBQUFBLDJDQUEyQzs7QUFFM0MsMkNBQXVEO0FBQ3ZELDJDQUErQztBQUMvQyxxQ0FBeUM7QUFDekMsNkNBQXNEO0FBQ3RELHlFQUFxRTtBQUNyRSw0RUFBd0U7QUFDeEUsK0NBQW9FO0FBQ3BFLHVDQU1xQjtBQUVyQjs7Ozs7Ozs7R0FRRztBQUNILFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO0lBQzNCLElBQUksT0FBb0IsQ0FBQztJQUN6QixJQUFJLFlBQThCLENBQUM7SUFDbkMsSUFBSSxVQUEwQixDQUFDO0lBRS9CLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixZQUFZLEdBQUcsSUFBQSw4QkFBc0IsR0FBRSxDQUFDO1FBQ3hDLFVBQVUsR0FBRyxJQUFBLDRCQUFvQixHQUFFLENBQUM7UUFFcEMsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRTtnQkFDVCwwQkFBVztnQkFDWDtvQkFDRSxPQUFPLEVBQUUsNEJBQVk7b0JBQ3JCLFFBQVEsRUFBRSxZQUFZO2lCQUN2QjtnQkFDRDtvQkFDRSxPQUFPLEVBQUUsZ0JBQVU7b0JBQ25CLFFBQVEsRUFBRSxVQUFVO2lCQUNyQjtnQkFDRDtvQkFDRSxPQUFPLEVBQUUsc0JBQWE7b0JBQ3RCLFFBQVEsRUFBRTt3QkFDUixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQVcsRUFBRSxFQUFFOzRCQUMzQixNQUFNLE1BQU0sR0FBMkI7Z0NBQ3JDLFVBQVUsRUFBRSxhQUFhO2dDQUN6QixjQUFjLEVBQUUsS0FBSzs2QkFDdEIsQ0FBQzs0QkFDRixPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQzt3QkFDckIsQ0FBQyxDQUFDO3FCQUNIO2lCQUNGO2FBQ0Y7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QVEsQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zbmlwcGV0Zm9yZ2Uvc25pcHBldGZvcmdlL2FwcHMvYXBpL3Rlc3QvdW5pdC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0ZXN0L3VuaXQvc2VydmljZXMvYXV0aC5zZXJ2aWNlLnNwZWMuIHRzXG5cbmltcG9ydCB7IFVuYXV0aG9yaXplZEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XG5pbXBvcnQgeyBKd3RTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9qd3QnO1xuaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBBdXRoU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NyYy9tb2R1bGVzL2F1dGgvYXV0aC5zZXJ2aWNlJztcbmltcG9ydCB7IFVzZXJzU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NyYy9tb2R1bGVzL3VzZXJzL3VzZXJzLnNlcnZpY2UnO1xuaW1wb3J0IHsgY3JlYXRlTG9naW5EdG8sIGNyZWF0ZVJlZ2lzdGVyRHRvIH0gZnJvbSAnLi4vLi4vZmFjdG9yaWVzJztcbmltcG9ydCB7XG4gIGNyZWF0ZU1vY2tKd3RTZXJ2aWNlLFxuICBjcmVhdGVNb2NrU2FmZVVzZXIsXG4gIGNyZWF0ZU1vY2tVc2Vyc1NlcnZpY2UsXG4gIHR5cGUgTW9ja0p3dFNlcnZpY2UsXG4gIHR5cGUgTW9ja1VzZXJzU2VydmljZSxcbn0gZnJvbSAnLi4vLi4vbW9ja3MnO1xuXG4vKipcbiAqIEF1dGhTZXJ2aWNlIFVuaXQgVGVzdHNcbiAqXG4gKiBUZXN0ZXQ6XG4gKiAtIFJlZ2lzdHJhdGlvblxuICogLSBMb2dpblxuICogLSBUb2tlbiBHZW5lcmF0aW9uXG4gKiAtIEVycm9yIEhhbmRsaW5nXG4gKi9cbmRlc2NyaWJlKCdBdXRoU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IEF1dGhTZXJ2aWNlO1xuICBsZXQgdXNlcnNTZXJ2aWNlOiBNb2NrVXNlcnNTZXJ2aWNlO1xuICBsZXQgand0U2VydmljZTogTW9ja0p3dFNlcnZpY2U7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgdXNlcnNTZXJ2aWNlID0gY3JlYXRlTW9ja1VzZXJzU2VydmljZSgpO1xuICAgIGp3dFNlcnZpY2UgPSBjcmVhdGVNb2NrSnd0U2VydmljZSgpO1xuXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBBdXRoU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFVzZXJzU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogdXNlcnNTZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogSnd0U2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogand0U2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IENvbmZpZ1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGdldDogamVzdC5mbigoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgY29uZmlnOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgICAgICAgICAgIEpXVF9TRUNSRVQ6ICd0ZXN0LXNlY3JldCcsXG4gICAgICAgICAgICAgICAgSldUX0VYUElSRVNfSU46ICcxNW0nLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICByZXR1cm4gY29uZmlnW2tleV07XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxBdXRoU2VydmljZT4oQXV0aFNlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gUkVHSVNURVJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgZGVzY3JpYmUoJ3JlZ2lzdGVyJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVnaXN0ZXIgYSBuZXcgdXNlciBhbmQgcmV0dXJuIHRva2VucycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGR0byA9IGNyZWF0ZVJlZ2lzdGVyRHRvKCk7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IGNyZWF0ZU1vY2tTYWZlVXNlcih7XG4gICAgICAgIGVtYWlsOiBkdG8uZW1haWwsXG4gICAgICAgIHVzZXJuYW1lOiBkdG8udXNlcm5hbWUsXG4gICAgICB9KTtcbiAgICAgIHVzZXJzU2VydmljZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucmVnaXN0ZXIoZHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QodXNlcnNTZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBlbWFpbDogZHRvLmVtYWlsLFxuICAgICAgICB1c2VybmFtZTogZHRvLnVzZXJuYW1lLFxuICAgICAgICBwYXNzd29yZDogZHRvLnBhc3N3b3JkLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0LnVzZXIpLnRvRXF1YWwobW9ja1VzZXIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50b2tlbnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnRva2Vucy5hY2Nlc3NUb2tlbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudG9rZW5zLnRva2VuVHlwZSkudG9CZSgnQmVhcmVyJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIEpXVCB3aXRoIGNvcnJlY3QgcGF5bG9hZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGR0byA9IGNyZWF0ZVJlZ2lzdGVyRHRvKCk7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IGNyZWF0ZU1vY2tTYWZlVXNlcih7XG4gICAgICAgIGlkOiAndXNlci0xMjMnLFxuICAgICAgICBlbWFpbDogZHRvLmVtYWlsLFxuICAgICAgICByb2xlOiAnVVNFUicsXG4gICAgICB9KTtcbiAgICAgIHVzZXJzU2VydmljZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IHNlcnZpY2UucmVnaXN0ZXIoZHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3Qoand0U2VydmljZS5zaWduQXN5bmMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgc3ViOiAndXNlci0xMjMnLFxuICAgICAgICAgIGVtYWlsOiBkdG8uZW1haWwsXG4gICAgICAgICAgcm9sZTogJ1VTRVInLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3BhZ2F0ZSBDb25mbGljdEV4Y2VwdGlvbiBmcm9tIFVzZXJzU2VydmljZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGR0byA9IGNyZWF0ZVJlZ2lzdGVyRHRvKCk7XG4gICAgICB1c2Vyc1NlcnZpY2UuY3JlYXRlLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgRXJyb3IoJ0VtYWlsIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCcpLFxuICAgICAgKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5yZWdpc3RlcihkdG8pKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIExPR0lOXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGRlc2NyaWJlKCdsb2dpbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGxvZ2luIHVzZXIgYW5kIHJldHVybiB0b2tlbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkdG8gPSBjcmVhdGVMb2dpbkR0bygpO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSBjcmVhdGVNb2NrU2FmZVVzZXIoeyBlbWFpbDogZHRvLmVtYWlsIH0pO1xuICAgICAgdXNlcnNTZXJ2aWNlLnZhbGlkYXRlQ3JlZGVudGlhbHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UubG9naW4oZHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QodXNlcnNTZXJ2aWNlLnZhbGlkYXRlQ3JlZGVudGlhbHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBkdG8uZW1haWwsXG4gICAgICAgIGR0by5wYXNzd29yZCxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0LnVzZXIpLnRvRXF1YWwobW9ja1VzZXIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50b2tlbnMuYWNjZXNzVG9rZW4pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IFVuYXV0aG9yaXplZEV4Y2VwdGlvbiB3aGVuIGNyZWRlbnRpYWxzIGFyZSBpbnZhbGlkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZHRvID0gY3JlYXRlTG9naW5EdG8oKTtcbiAgICAgIHVzZXJzU2VydmljZS52YWxpZGF0ZUNyZWRlbnRpYWxzLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmxvZ2luKGR0bykpLnJlamVjdHMudG9UaHJvdyhVbmF1dGhvcml6ZWRFeGNlcHRpb24pO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UubG9naW4oZHRvKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZCcsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBKV1Qgd2l0aCBjb3JyZWN0IHBheWxvYWQgb24gbG9naW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkdG8gPSBjcmVhdGVMb2dpbkR0bygpO1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSBjcmVhdGVNb2NrU2FmZVVzZXIoe1xuICAgICAgICBpZDogJ3VzZXItNDU2JyxcbiAgICAgICAgZW1haWw6IGR0by5lbWFpbCxcbiAgICAgICAgcm9sZTogJ0FETUlOJyxcbiAgICAgIH0pO1xuICAgICAgdXNlcnNTZXJ2aWNlLnZhbGlkYXRlQ3JlZGVudGlhbHMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IHNlcnZpY2UubG9naW4oZHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3Qoand0U2VydmljZS5zaWduQXN5bmMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgc3ViOiAndXNlci00NTYnLFxuICAgICAgICAgIGVtYWlsOiBkdG8uZW1haWwsXG4gICAgICAgICAgcm9sZTogJ0FETUlOJyxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gVE9LRU4gR0VORVJBVElPTlxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBkZXNjcmliZSgndG9rZW4gZ2VuZXJhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgZXhwaXJlc0luIGluIHRva2VuIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZHRvID0gY3JlYXRlUmVnaXN0ZXJEdG8oKTtcbiAgICAgIHVzZXJzU2VydmljZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoY3JlYXRlTW9ja1NhZmVVc2VyKCkpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucmVnaXN0ZXIoZHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0LnRva2Vucy5leHBpcmVzSW4pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC50b2tlbnMuZXhwaXJlc0luKS50b0JlKCdudW1iZXInKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2V0IHRva2VuVHlwZSB0byBCZWFyZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkdG8gPSBjcmVhdGVMb2dpbkR0bygpO1xuICAgICAgdXNlcnNTZXJ2aWNlLnZhbGlkYXRlQ3JlZGVudGlhbHMubW9ja1Jlc29sdmVkVmFsdWUoY3JlYXRlTW9ja1NhZmVVc2VyKCkpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UubG9naW4oZHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0LnRva2Vucy50b2tlblR5cGUpLnRvQmUoJ0JlYXJlcicpO1xuICAgIH0pO1xuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gVkFMSURBVEUgVVNFUiBCWSBJRFxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBkZXNjcmliZSgndmFsaWRhdGVVc2VyQnlJZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB1c2VyIHdoZW4gZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBtb2NrVXNlciA9IGNyZWF0ZU1vY2tTYWZlVXNlcigpO1xuICAgICAgdXNlcnNTZXJ2aWNlLmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnZhbGlkYXRlVXNlckJ5SWQoJ3VzZXItMTIzJyk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHVzZXJzU2VydmljZS5maW5kQnlJZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3VzZXItMTIzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tVc2VyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvcGFnYXRlIE5vdEZvdW5kRXhjZXB0aW9uIGZyb20gVXNlcnNTZXJ2aWNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgdXNlcnNTZXJ2aWNlLmZpbmRCeUlkLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignVXNlciBub3QgZm91bmQnKSk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudmFsaWRhdGVVc2VyQnlJZCgnbm9uZXhpc3RlbnQnKSkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBHRVQgQ1VSUkVOVCBVU0VSXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGRlc2NyaWJlKCdnZXRDdXJyZW50VXNlcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB1c2VyIGJ5IGlkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbW9ja1VzZXIgPSBjcmVhdGVNb2NrU2FmZVVzZXIoeyBpZDogJ2N1cnJlbnQtdXNlci1pZCcgfSk7XG4gICAgICB1c2Vyc1NlcnZpY2UuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0Q3VycmVudFVzZXIoJ2N1cnJlbnQtdXNlci1pZCcpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VzZXIpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9