{"file":"/home/runner/work/snippetforge/snippetforge/apps/api/test/unit/filters/http-exception.filter.spec.ts","mappings":"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","names":[],"sources":["/home/runner/work/snippetforge/snippetforge/apps/api/test/unit/filters/http-exception.filter.spec.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-argument */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n// test/unit/filters/http-exception.filter.spec.ts\n\nimport {\n  BadRequestException,\n  ConflictException,\n  HttpException,\n  HttpStatus,\n  NotFoundException,\n  UnauthorizedException,\n} from '@nestjs/common';\nimport { ErrorCodes } from '../../../src/shared/constants';\nimport { HttpExceptionFilter } from '../../../src/shared/filters/http-exception.filter';\nimport {\n  createMockArgumentsHost,\n  createMockRequest,\n  createMockResponse,\n} from '../../setup/test-utils';\n\n/**\n * HttpExceptionFilter Unit Tests\n *\n * Testet:\n * - Verschiedene HTTP Status Codes\n * - Error Code Inferenz\n * - Response Format\n */\ndescribe('HttpExceptionFilter', () => {\n  let filter: HttpExceptionFilter;\n  let mockResponse: ReturnType<typeof createMockResponse>;\n  let mockRequest: ReturnType<typeof createMockRequest>;\n\n  beforeEach(() => {\n    filter = new HttpExceptionFilter();\n    mockResponse = createMockResponse();\n    mockRequest = createMockRequest();\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('catch', () => {\n    describe('response format', () => {\n      it('should return standardized error response format', () => {\n        // Arrange\n        const exception = new BadRequestException('Test error');\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        expect(mockResponse.status).toHaveBeenCalledWith(\n          HttpStatus.BAD_REQUEST,\n        );\n        expect(mockResponse.json).toHaveBeenCalledWith(\n          expect.objectContaining({\n            success: false,\n            error: expect.objectContaining({\n              message: 'Test error',\n              statusCode: 400,\n            }),\n            meta: expect.objectContaining({\n              path: mockRequest.url,\n              method: mockRequest.method,\n              timestamp: expect.any(String),\n            }),\n          }),\n        );\n      });\n\n      it('should include request id from headers', () => {\n        // Arrange\n        const requestWithId = createMockRequest({\n          headers: { 'x-request-id': 'trace-123' },\n        });\n        const exception = new BadRequestException('With request id');\n        const host = createMockArgumentsHost(requestWithId, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        const jsonCall = mockResponse.json.mock.calls[0][0];\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        expect(jsonCall.meta.requestId).toBe('trace-123');\n      });\n    });\n\n    describe('error code inference', () => {\n      it('should infer AUTH_TOKEN_MISSING for \"missing token\" message', () => {\n        // Arrange\n        const exception = new UnauthorizedException(\n          'Missing authentication token',\n        );\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        expect(mockResponse.json).toHaveBeenCalledWith(\n          expect.objectContaining({\n            error: expect.objectContaining({\n              code: ErrorCodes.AUTH_TOKEN_MISSING,\n            }),\n          }),\n        );\n      });\n\n      it('should infer AUTH_TOKEN_EXPIRED for \"expired\" message', () => {\n        // Arrange\n        const exception = new UnauthorizedException('Token has expired');\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        expect(mockResponse.json).toHaveBeenCalledWith(\n          expect.objectContaining({\n            error: expect.objectContaining({\n              code: ErrorCodes.AUTH_TOKEN_EXPIRED,\n            }),\n          }),\n        );\n      });\n\n      it('should infer AUTH_INVALID_CREDENTIALS for login failure', () => {\n        // Arrange\n        const exception = new UnauthorizedException(\n          'Invalid email or password',\n        );\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        expect(mockResponse.json).toHaveBeenCalledWith(\n          expect.objectContaining({\n            error: expect.objectContaining({\n              code: ErrorCodes.AUTH_INVALID_CREDENTIALS,\n            }),\n          }),\n        );\n      });\n\n      it('should infer USER_EMAIL_EXISTS for email conflict', () => {\n        // Arrange\n        const exception = new ConflictException('Email is already registered');\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        expect(mockResponse.json).toHaveBeenCalledWith(\n          expect.objectContaining({\n            error: expect.objectContaining({\n              code: ErrorCodes.USER_EMAIL_EXISTS,\n            }),\n          }),\n        );\n      });\n\n      it('should infer USER_USERNAME_EXISTS for username conflicts', () => {\n        // Arrange\n        const exception = new ConflictException('Username already taken');\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        expect(mockResponse.json).toHaveBeenCalledWith(\n          expect.objectContaining({\n            error: expect.objectContaining({\n              code: ErrorCodes.USER_USERNAME_EXISTS,\n            }),\n          }),\n        );\n      });\n\n      it('should infer AUTH_INSUFFICIENT_ROLE for role-based forbiddance', () => {\n        // Arrange\n        const exception = new HttpException(\n          'role required',\n          HttpStatus.FORBIDDEN,\n        );\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        expect(mockResponse.json).toHaveBeenCalledWith(\n          expect.objectContaining({\n            error: expect.objectContaining({\n              code: ErrorCodes.AUTH_INSUFFICIENT_ROLE,\n            }),\n          }),\n        );\n      });\n\n      it('should infer USER_NOT_FOUND for user not found', () => {\n        // Arrange\n        const exception = new NotFoundException('User not found');\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        expect(mockResponse.json).toHaveBeenCalledWith(\n          expect.objectContaining({\n            error: expect.objectContaining({\n              code: ErrorCodes.USER_NOT_FOUND,\n            }),\n          }),\n        );\n      });\n    });\n\n    describe('validation error handling', () => {\n      it('should include validation details in response', () => {\n        // Arrange\n        const exception = new BadRequestException({\n          message: 'Validation failed',\n          code: 'VALIDATION_ERROR',\n          errors: {\n            email: ['Invalid email format'],\n            password: ['Too short'],\n          },\n        });\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        expect(mockResponse.json).toHaveBeenCalledWith(\n          expect.objectContaining({\n            error: expect.objectContaining({\n              details: expect.objectContaining({\n                fields: expect.objectContaining({\n                  email: ['Invalid email format'],\n                  password: ['Too short'],\n                }),\n              }),\n            }),\n          }),\n        );\n      });\n\n      it('should normalize array messages and expose them as context', () => {\n        // Arrange\n        const exception = new BadRequestException({\n          message: ['first error', 'second error'],\n        });\n        const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n        // Act\n        filter.catch(exception, host as any);\n\n        // Assert\n        expect(mockResponse.json).toHaveBeenCalledWith(\n          expect.objectContaining({\n            error: expect.objectContaining({\n              message: 'first error',\n              details: {\n                context: { messages: ['first error', 'second error'] },\n              },\n            }),\n          }),\n        );\n      });\n    });\n\n    describe('HTTP status codes', () => {\n      const statusCases = [\n        { status: HttpStatus.BAD_REQUEST, name: 'Bad Request' },\n        { status: HttpStatus.UNAUTHORIZED, name: 'Unauthorized' },\n        { status: HttpStatus.FORBIDDEN, name: 'Forbidden' },\n        { status: HttpStatus.NOT_FOUND, name: 'Not Found' },\n        { status: HttpStatus.CONFLICT, name: 'Conflict' },\n        {\n          status: HttpStatus.INTERNAL_SERVER_ERROR,\n          name: 'Internal Server Error',\n        },\n      ];\n\n      statusCases.forEach(({ status, name }) => {\n        it(`should handle ${status} (${name})`, () => {\n          // Arrange\n          const exception = new HttpException('Test', status);\n          const host = createMockArgumentsHost(mockRequest, mockResponse);\n\n          // Act\n          filter.catch(exception, host as any);\n\n          // Assert\n          expect(mockResponse.status).toHaveBeenCalledWith(status);\n          expect(mockResponse.json).toHaveBeenCalledWith(\n            expect.objectContaining({\n              error: expect.objectContaining({\n                statusCode: status,\n              }),\n            }),\n          );\n        });\n      });\n    });\n  });\n});\n"],"version":3}