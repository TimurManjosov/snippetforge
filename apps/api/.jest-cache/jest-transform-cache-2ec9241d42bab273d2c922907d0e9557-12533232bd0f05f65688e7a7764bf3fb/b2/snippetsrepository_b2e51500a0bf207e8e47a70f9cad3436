26479cddd922bd7b619e1e6de05441b5
"use strict";
// src/modules/snippets/snippets.repository.ts
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var SnippetsRepository_1;
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.SnippetsRepository = void 0;
const common_1 = require("@nestjs/common");
const drizzle_orm_1 = require("drizzle-orm");
const schema_1 = require("../../lib/db/schema");
const database_1 = require("../../shared/database");
const snippets_types_1 = require("./snippets.types");
/**
 * SnippetsRepository - Data Access Layer für Snippets
 *
 * VERANTWORTLICHKEITEN (Single Responsibility):
 * - Alle Datenbank-Queries für Snippets
 * - Keine Business Logic (z.B. keine Ownership-Checks)
 * - Keine HTTP-Concerns (keine Exceptions außer DB-Errors)
 *
 * CLEAN CODE REGEL #2: Repository Returns Domain Objects
 * - Alle Methoden geben typisierte Objekte zurück
 * - Kein `any`, kein `unknown`
 * - Explicit `null` statt `undefined` wenn nicht gefunden
 *
 * CLEAN CODE REGEL #3: Repository executes, Service orchestrates
 * - Keine if/else für Business Rules
 * - Keine Validierung von Input (macht Service)
 * - Nur reine Datenbank-Operationen
 *
 * PERFORMANCE OPTIMIERUNGEN:
 * - Nutzt alle DB-Indices (userId, language, createdAt, isPublic)
 * - Pagination verhindert Memory-Overflow
 * - Atomic Operations (incrementViewCount)
 * - Batch Queries wo möglich
 */
let SnippetsRepository = SnippetsRepository_1 = class SnippetsRepository {
    db;
    logger = new common_1.Logger(SnippetsRepository_1.name);
    constructor(db) {
        this.db = db;
    }
    // ============================================================
    // CREATE
    // ============================================================
    /**
     * Erstellt neuen Snippet
     *
     * PERFORMANCE: Single INSERT, nutzt RETURNING
     *
     * @param data - Snippet-Daten (ohne id, timestamps)
     * @returns Erstellter Snippet mit generierten Feldern
     * @throws Database Error bei Constraint-Violation
     */
    async create(data) {
        this.logger.debug(`Creating snippet: ${data.title}`);
        const [snippet] = await this.db.drizzle
            .insert(schema_1.snippets)
            .values(data)
            .returning();
        this.logger.log(`Snippet created: ${snippet.id}`);
        return snippet;
    }
    // ============================================================
    // READ - SINGLE
    // ============================================================
    /**
     * Findet Snippet anhand der ID
     *
     * PERFORMANCE: Nutzt Primary Key Index (schnellste Query)
     *
     * @param id - Snippet UUID
     * @returns Snippet oder null wenn nicht gefunden
     */
    async findById(id) {
        this.logger.debug(`Finding snippet by ID: ${id}`);
        const snippet = await this.db.drizzle.query.snippets.findFirst({
            where: (0, drizzle_orm_1.eq)(schema_1.snippets.id, id),
        });
        return snippet ?? null;
    }
    // ============================================================
    // READ - LISTS
    // ============================================================
    /**
     * Findet alle Snippets eines Users
     *
     * PERFORMANCE: Nutzt snippets_user_id_idx
     *
     * @param userId - User UUID
     * @param limit - Max Anzahl (default 20, max 100)
     * @returns Liste von Snippets (sortiert nach createdAt DESC)
     */
    async findByUserId(userId, limit = 20) {
        this.logger.debug(`Finding snippets for user: ${userId}`);
        return this.db.drizzle.query.snippets.findMany({
            where: (0, drizzle_orm_1.eq)(schema_1.snippets.userId, userId),
            limit: Math.min(limit, 100),
            orderBy: [(0, drizzle_orm_1.desc)(schema_1.snippets.createdAt)],
        });
    }
    /**
     * Findet öffentliche Snippets (paginated)
     *
     * PERFORMANCE:
     * - Nutzt snippets_public_created_at_idx (composite index)
     * - Zwei Queries: Data + Count (parallel möglich)
     * - Pagination verhindert Memory-Overflow
     *
     * @param page - Seite (1-indexed, default 1)
     * @param limit - Items pro Seite (default 20, max 100)
     * @returns Paginated Snippets
     */
    async findPublic(page = 1, limit = 20) {
        this.logger.debug(`Finding public snippets (page: ${page}, limit: ${limit})`);
        const safeLimit = Math.min(limit, 100);
        const offset = (page - 1) * safeLimit;
        // Query 1: Data
        const data = await this.db.drizzle.query.snippets.findMany({
            where: (0, drizzle_orm_1.eq)(schema_1.snippets.isPublic, true),
            limit: safeLimit,
            offset,
            orderBy: [(0, drizzle_orm_1.desc)(schema_1.snippets.createdAt)],
        });
        // Query 2: Count
        const [{ total }] = await this.db.drizzle
            .select({ total: (0, drizzle_orm_1.count)() })
            .from(schema_1.snippets)
            .where((0, drizzle_orm_1.eq)(schema_1.snippets.isPublic, true));
        return {
            data,
            meta: (0, snippets_types_1.calculatePaginationMeta)(total, page, safeLimit),
        };
    }
    /**
     * Findet öffentliche Snippet-Previews (OHNE Code)
     *
     * PERFORMANCE REGEL #3: Select only needed columns
     * Spart ~50KB pro Snippet bei Listen-Ansichten!
     *
     * @param page - Seite
     * @param limit - Items pro Seite
     * @returns Paginated Previews
     */
    async findPublicPreviews(page = 1, limit = 20) {
        this.logger.debug(`Finding public snippet previews (page: ${page}, limit: ${limit})`);
        const safeLimit = Math.min(limit, 100);
        const offset = (page - 1) * safeLimit;
        // Query 1: Data (ohne code Feld!)
        const data = await this.db.drizzle
            .select({
            id: schema_1.snippets.id,
            title: schema_1.snippets.title,
            description: schema_1.snippets.description,
            language: schema_1.snippets.language,
            userId: schema_1.snippets.userId,
            isPublic: schema_1.snippets.isPublic,
            viewCount: schema_1.snippets.viewCount,
            createdAt: schema_1.snippets.createdAt,
            updatedAt: schema_1.snippets.updatedAt,
        })
            .from(schema_1.snippets)
            .where((0, drizzle_orm_1.eq)(schema_1.snippets.isPublic, true))
            .limit(safeLimit)
            .offset(offset)
            .orderBy((0, drizzle_orm_1.desc)(schema_1.snippets.createdAt));
        // Query 2: Count
        const [{ total }] = await this.db.drizzle
            .select({ total: (0, drizzle_orm_1.count)() })
            .from(schema_1.snippets)
            .where((0, drizzle_orm_1.eq)(schema_1.snippets.isPublic, true));
        return {
            data,
            meta: (0, snippets_types_1.calculatePaginationMeta)(total, page, safeLimit),
        };
    }
    /**
     * Findet Snippets nach Programmiersprache
     *
     * PERFORMANCE: Nutzt snippets_language_idx
     *
     * @param language - Programmiersprache (z.B. "typescript")
     * @param limit - Max Anzahl
     * @returns Liste von Snippets
     */
    async findByLanguage(language, limit = 20) {
        this.logger.debug(`Finding snippets by language: ${language}`);
        return this.db.drizzle.query.snippets.findMany({
            where: (0, drizzle_orm_1.eq)(schema_1.snippets.language, language),
            limit: Math.min(limit, 100),
            orderBy: [(0, drizzle_orm_1.desc)(schema_1.snippets.createdAt)],
        });
    }
    /**
     * Erweiterte Suche mit Filtern und Sortierung
     *
     * PERFORMANCE: Nutzt Indices basierend auf Filtern
     *
     * @param filters - Filter-Optionen
     * @param sort - Sortier-Optionen (default: createdAt DESC)
     * @param page - Seite
     * @param limit - Items pro Seite
     * @returns Paginated Snippets
     */
    async findWithFilters(filters = {}, sort = snippets_types_1.DEFAULT_SORT, page = 1, limit = 20) {
        this.logger.debug('Finding snippets with filters', { filters, sort });
        const safeLimit = Math.min(limit, 100);
        const offset = (page - 1) * safeLimit;
        // Build WHERE clause
        const conditions = this.buildWhereConditions(filters);
        const whereClause = conditions.length > 0 ? (0, drizzle_orm_1.and)(...conditions) : undefined;
        // Build ORDER BY
        const sortColumn = schema_1.snippets[sort.sortBy];
        const orderFn = sort.order === 'asc' ? drizzle_orm_1.asc : drizzle_orm_1.desc;
        // Query 1: Data
        const data = await this.db.drizzle.query.snippets.findMany({
            where: whereClause,
            limit: safeLimit,
            offset,
            orderBy: [orderFn(sortColumn)],
        });
        // Query 2: Count
        const [{ total }] = await this.db.drizzle
            .select({ total: (0, drizzle_orm_1.count)() })
            .from(schema_1.snippets)
            .where(whereClause);
        return {
            data,
            meta: (0, snippets_types_1.calculatePaginationMeta)(total, page, safeLimit),
        };
    }
    // ============================================================
    // UPDATE
    // ============================================================
    /**
     * Aktualisiert Snippet-Daten
     *
     * WICHTIG: updatedAt wird automatisch gesetzt
     *
     * @param id - Snippet UUID
     * @param data - Zu aktualisierende Felder
     * @returns Aktualisierter Snippet oder null wenn nicht gefunden
     */
    async update(id, data) {
        this.logger.debug(`Updating snippet: ${id}`);
        const [updatedSnippet] = await this.db.drizzle
            .update(schema_1.snippets)
            .set({
            ...data,
            updatedAt: new Date(), // Timestamp immer aktualisieren
        })
            .where((0, drizzle_orm_1.eq)(schema_1.snippets.id, id))
            .returning();
        if (!updatedSnippet) {
            this.logger.warn(`Snippet not found for update: ${id}`);
            return null;
        }
        this.logger.log(`Snippet updated: ${id}`);
        return updatedSnippet;
    }
    /**
     * Erhöht View Count um 1 (Atomic Operation)
     *
     * PERFORMANCE: Atomic SQL Update (kein Race Condition)
     *
     * @param id - Snippet UUID
     * @returns true wenn erfolgreich, false wenn nicht gefunden
     */
    async incrementViewCount(id) {
        this.logger.debug(`Incrementing view count for snippet: ${id}`);
        const result = await this.db.drizzle
            .update(schema_1.snippets)
            .set({
            viewCount: (0, drizzle_orm_1.sql) `${schema_1.snippets.viewCount} + 1`,
        })
            .where((0, drizzle_orm_1.eq)(schema_1.snippets.id, id))
            .returning({ id: schema_1.snippets.id });
        return result.length > 0;
    }
    // ============================================================
    // DELETE
    // ============================================================
    /**
     * Löscht Snippet (Hard Delete)
     *
     * HINWEIS: Soft Delete (isDeleted Flag) wäre in Production besser
     *
     * @param id - Snippet UUID
     * @returns true wenn gelöscht, false wenn nicht gefunden
     */
    async delete(id) {
        this.logger.debug(`Deleting snippet: ${id}`);
        const result = await this.db.drizzle
            .delete(schema_1.snippets)
            .where((0, drizzle_orm_1.eq)(schema_1.snippets.id, id))
            .returning({ id: schema_1.snippets.id });
        if (result.length === 0) {
            this.logger.warn(`Snippet not found for deletion: ${id}`);
            return false;
        }
        this.logger.log(`Snippet deleted: ${id}`);
        return true;
    }
    // ============================================================
    // BATCH OPERATIONS
    // ============================================================
    /**
     * Löscht alle Snippets eines Users (Batch Delete)
     *
     * VERWENDUNG: Bei User-Löschung (zusätzlich zu CASCADE)
     *
     * @param userId - User UUID
     * @returns Anzahl gelöschter Snippets
     */
    async deleteByUserId(userId) {
        this.logger.debug(`Deleting all snippets for user: ${userId}`);
        const result = await this.db.drizzle
            .delete(schema_1.snippets)
            .where((0, drizzle_orm_1.eq)(schema_1.snippets.userId, userId))
            .returning({ id: schema_1.snippets.id });
        this.logger.log(`Deleted ${result.length} snippets for user: ${userId}`);
        return result.length;
    }
    // ============================================================
    // STATISTICS
    // ============================================================
    /**
     * Zählt Snippets eines Users
     *
     * @param userId - User UUID
     * @returns Anzahl der Snippets
     */
    async countByUserId(userId) {
        const [{ total }] = await this.db.drizzle
            .select({ total: (0, drizzle_orm_1.count)() })
            .from(schema_1.snippets)
            .where((0, drizzle_orm_1.eq)(schema_1.snippets.userId, userId));
        return total;
    }
    /**
     * Zählt öffentliche Snippets
     *
     * @returns Anzahl öffentlicher Snippets
     */
    async countPublic() {
        const [{ total }] = await this.db.drizzle
            .select({ total: (0, drizzle_orm_1.count)() })
            .from(schema_1.snippets)
            .where((0, drizzle_orm_1.eq)(schema_1.snippets.isPublic, true));
        return total;
    }
    /**
     * Holt umfassende Statistiken für einen User
     *
     * PERFORMANCE: Single Query mit Aggregation
     *
     * @param userId - User UUID
     * @returns Snippet Statistics
     */
    async getUserStats(userId) {
        this.logger.debug(`Getting stats for user: ${userId}`);
        // Alle User-Snippets holen
        const userSnippets = await this.db.drizzle.query.snippets.findMany({
            where: (0, drizzle_orm_1.eq)(schema_1.snippets.userId, userId),
        });
        // Statistiken berechnen
        const total = userSnippets.length;
        const publicCount = userSnippets.filter((s) => s.isPublic).length;
        const privateCount = total - publicCount;
        const totalViews = userSnippets.reduce((sum, s) => sum + s.viewCount, 0);
        // Most viewed Snippet
        const mostViewed = userSnippets.sort((a, b) => b.viewCount - a.viewCount)[0];
        // Latest Snippet
        const latestSnippet = userSnippets.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime())[0];
        return {
            total,
            public: publicCount,
            private: privateCount,
            totalViews,
            mostViewed,
            latestSnippet,
        };
    }
    /**
     * Holt Sprachen-Statistiken
     *
     * @param userId - Optional: Nur für einen User
     * @returns Language Stats sortiert nach Count DESC
     */
    async getLanguageStats(userId) {
        this.logger.debug(`Getting language stats${userId ? ` for user: ${userId}` : ''}`);
        const whereClause = userId ? (0, drizzle_orm_1.eq)(schema_1.snippets.userId, userId) : undefined;
        const result = await this.db.drizzle
            .select({
            language: schema_1.snippets.language,
            count: (0, drizzle_orm_1.count)(),
        })
            .from(schema_1.snippets)
            .where(whereClause)
            .groupBy(schema_1.snippets.language)
            .orderBy((0, drizzle_orm_1.desc)((0, drizzle_orm_1.count)()));
        return result;
    }
    // ============================================================
    // PRIVATE HELPERS
    // ============================================================
    /**
     * Baut WHERE Conditions aus Filtern
     *
     * @param filters - Filter-Optionen
     * @returns Array von Drizzle Conditions
     */
    buildWhereConditions(filters) {
        const conditions = [];
        if (filters.userId) {
            conditions.push((0, drizzle_orm_1.eq)(schema_1.snippets.userId, filters.userId));
        }
        if (filters.language) {
            conditions.push((0, drizzle_orm_1.eq)(schema_1.snippets.language, filters.language));
        }
        if (filters.isPublic !== undefined) {
            conditions.push((0, drizzle_orm_1.eq)(schema_1.snippets.isPublic, filters.isPublic));
        }
        if (filters.search) {
            // Simple text search (case-insensitive)
            // TODO Sprint 2: Full-text search mit PostgreSQL ts_vector
            const searchPattern = `%${filters.search}%`;
            conditions.push((0, drizzle_orm_1.or)((0, drizzle_orm_1.sql) `LOWER(${schema_1.snippets.title}) LIKE LOWER(${searchPattern})`, (0, drizzle_orm_1.sql) `LOWER(${schema_1.snippets.description}) LIKE LOWER(${searchPattern})`));
        }
        if (filters.createdAfter) {
            conditions.push((0, drizzle_orm_1.sql) `${schema_1.snippets.createdAt} >= ${filters.createdAfter}`);
        }
        if (filters.createdBefore) {
            conditions.push((0, drizzle_orm_1.sql) `${schema_1.snippets.createdAt} <= ${filters.createdBefore}`);
        }
        return conditions;
    }
};
exports.SnippetsRepository = SnippetsRepository;
exports.SnippetsRepository = SnippetsRepository = SnippetsRepository_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof database_1.DatabaseService !== "undefined" && database_1.DatabaseService) === "function" ? _a : Object])
], SnippetsRepository);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc25pcHBldGZvcmdlL3NuaXBwZXRmb3JnZS9hcHBzL2FwaS9zcmMvbW9kdWxlcy9zbmlwcGV0cy9zbmlwcGV0cy5yZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7QUFBQSw4Q0FBOEM7Ozs7Ozs7Ozs7Ozs7O0FBRTlDLDJDQUFvRDtBQUNwRCw2Q0FBaUU7QUFDakUsZ0RBQThFO0FBQzlFLG9EQUF3RDtBQUN4RCxxREFRMEI7QUFFMUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUJHO0FBRUksSUFBTSxrQkFBa0IsMEJBQXhCLE1BQU0sa0JBQWtCO0lBR0E7SUFGWixNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsb0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFOUQsWUFBNkIsRUFBbUI7UUFBbkIsT0FBRSxHQUFGLEVBQUUsQ0FBaUI7SUFBRyxDQUFDO0lBRXBELCtEQUErRDtJQUMvRCxTQUFTO0lBQ1QsK0RBQStEO0lBRS9EOzs7Ozs7OztPQVFHO0lBQ0gsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFnQjtRQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFFckQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLE1BQU0sSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPO2FBQ3BDLE1BQU0sQ0FBQyxpQkFBUSxDQUFDO2FBQ2hCLE1BQU0sQ0FBQyxJQUFJLENBQUM7YUFDWixTQUFTLEVBQUUsQ0FBQztRQUVmLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLG9CQUFvQixPQUFPLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNsRCxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0lBRUQsK0RBQStEO0lBQy9ELGdCQUFnQjtJQUNoQiwrREFBK0Q7SUFFL0Q7Ozs7Ozs7T0FPRztJQUNILEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBVTtRQUN2QixJQUFJLENBQUMsTUFBTSxD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Q0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDO1FBQzFFLENBQUM7UUFFRCxPQUFPLFVBQVUsQ0FBQztJQUNwQixDQUFDO0NBQ0YsQ0FBQTtBQTllWSxnREFBa0I7NkJBQWxCLGtCQUFrQjtJQUQ5QixJQUFBLG1CQUFVLEdBQUU7eURBSXNCLDBCQUFlLG9CQUFmLDBCQUFlO0dBSHJDLGtCQUFrQixDQThlOUIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc25pcHBldGZvcmdlL3NuaXBwZXRmb3JnZS9hcHBzL2FwaS9zcmMvbW9kdWxlcy9zbmlwcGV0cy9zbmlwcGV0cy5yZXBvc2l0b3J5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9tb2R1bGVzL3NuaXBwZXRzL3NuaXBwZXRzLnJlcG9zaXRvcnkudHNcblxuaW1wb3J0IHsgSW5qZWN0YWJsZSwgTG9nZ2VyIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgYW5kLCBhc2MsIGNvdW50LCBkZXNjLCBlcSwgb3IsIHNxbCB9IGZyb20gJ2RyaXp6bGUtb3JtJztcbmltcG9ydCB7IHNuaXBwZXRzLCB0eXBlIE5ld1NuaXBwZXQsIHR5cGUgU25pcHBldCB9IGZyb20gJy4uLy4uL2xpYi9kYi9zY2hlbWEnO1xuaW1wb3J0IHsgRGF0YWJhc2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2hhcmVkL2RhdGFiYXNlJztcbmltcG9ydCB7XG4gIGNhbGN1bGF0ZVBhZ2luYXRpb25NZXRhLFxuICBERUZBVUxUX1NPUlQsXG4gIHR5cGUgUGFnaW5hdGVkU25pcHBldFByZXZpZXdzLFxuICB0eXBlIFBhZ2luYXRlZFNuaXBwZXRzLFxuICB0eXBlIFNuaXBwZXRGaWx0ZXJzLFxuICB0eXBlIFNuaXBwZXRTb3J0T3B0aW9ucyxcbiAgdHlwZSBTbmlwcGV0U3RhdHMsXG59IGZyb20gJy4vc25pcHBldHMudHlwZXMnO1xuXG4vKipcbiAqIFNuaXBwZXRzUmVwb3NpdG9yeSAtIERhdGEgQWNjZXNzIExheWVyIGbDvHIgU25pcHBldHNcbiAqXG4gKiBWRVJBTlRXT1JUTElDSEtFSVRFTiAoU2luZ2xlIFJlc3BvbnNpYmlsaXR5KTpcbiAqIC0gQWxsZSBEYXRlbmJhbmstUXVlcmllcyBmw7xyIFNuaXBwZXRzXG4gKiAtIEtlaW5lIEJ1c2luZXNzIExvZ2ljICh6LkIuIGtlaW5lIE93bmVyc2hpcC1DaGVja3MpXG4gKiAtIEtlaW5lIEhUVFAtQ29uY2VybnMgKGtlaW5lIEV4Y2VwdGlvbnMgYXXDn2VyIERCLUVycm9ycylcbiAqXG4gKiBDTEVBTiBDT0RFIFJFR0VMICMyOiBSZXBvc2l0b3J5IFJldHVybnMgRG9tYWluIE9iamVjdHNcbiAqIC0gQWxsZSBNZXRob2RlbiBnZWJlbiB0eXBpc2llcnRlIE9iamVrdGUgenVyw7xja1xuICogLSBLZWluIGBhbnlgLCBrZWluIGB1bmtub3duYFxuICogLSBFeHBsaWNpdCBgbnVsbGAgc3RhdHQgYHVuZGVmaW5lZGAgd2VubiBuaWNodCBnZWZ1bmRlblxuICpcbiAqIENMRUFOIENPREUgUkVHRUwgIzM6IFJlcG9zaXRvcnkgZXhlY3V0ZXMsIFNlcnZpY2Ugb3JjaGVzdHJhdGVzXG4gKiAtIEtlaW5lIGlmL2Vsc2UgZsO8ciBCdXNpbmVzcyBSdWxlc1xuICogLSBLZWluZSBWYWxpZGllcnVuZyB2b24gSW5wdXQgKG1hY2h0IFNlcnZpY2UpXG4gKiAtIE51ciByZWluZSBEYXRlbmJhbmstT3BlcmF0aW9uZW5cbiAqXG4gKiBQRVJGT1JNQU5DRSBPUFRJTUlFUlVOR0VOOlxuICogLSBOdXR6dCBhbGxlIERCLUluZGljZXMgKHVzZXJJZCwgbGFuZ3VhZ2UsIGNyZWF0ZWRBdCwgaXNQdWJsaWMpXG4gKiAtIFBhZ2luYXRpb24gdmVyaGluZGVydCBNZW1vcnktT3ZlcmZsb3dcbiAqIC0gQXRvbWljIE9wZXJhdGlvbnMgKGluY3JlbWVudFZpZXdDb3VudClcbiAqIC0gQmF0Y2ggUXVlcmllcyB3byBtw7ZnbGljaFxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgU25pcHBldHNSZXBvc2l0b3J5IHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKFNuaXBwZXRzUmVwb3NpdG9yeS5uYW1lKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGRiOiBEYXRhYmFzZVNlcnZpY2UpIHt9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIENSRUFURVxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogRXJzdGVsbHQgbmV1ZW4gU25pcHBldFxuICAgKlxuICAgKiBQRVJGT1JNQU5DRTogU2luZ2xlIElOU0VSVCwgbnV0enQgUkVUVVJOSU5HXG4gICAqXG4gICAqIEBwYXJhbSBkYXRhIC0gU25pcHBldC1EYXRlbiAob2huZSBpZCwgdGltZXN0YW1wcylcbiAgICogQHJldHVybnMgRXJzdGVsbHRlciBTbmlwcGV0IG1pdCBnZW5lcmllcnRlbiBGZWxkZXJuXG4gICAqIEB0aHJvd3MgRGF0YWJhc2UgRXJyb3IgYmVpIENvbnN0cmFpbnQtVmlvbGF0aW9uXG4gICAqL1xuICBhc3luYyBjcmVhdGUoZGF0YTogTmV3U25pcHBldCk6IFByb21pc2U8U25pcHBldD4ge1xuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBDcmVhdGluZyBzbmlwcGV0OiAke2RhdGEudGl0bGV9YCk7XG5cbiAgICBjb25zdCBbc25pcHBldF0gPSBhd2FpdCB0aGlzLmRiLmRyaXp6bGVcbiAgICAgIC5pbnNlcnQoc25pcHBldHMpXG4gICAgICAudmFsdWVzKGRhdGEpXG4gICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coYFNuaXBwZXQgY3JlYXRlZDogJHtzbmlwcGV0LmlkfWApO1xuICAgIHJldHVybiBzbmlwcGV0O1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFJFQUQgLSBTSU5HTEVcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIEZpbmRldCBTbmlwcGV0IGFuaGFuZCBkZXIgSURcbiAgICpcbiAgICogUEVSRk9STUFOQ0U6IE51dHp0IFByaW1hcnkgS2V5IEluZGV4IChzY2huZWxsc3RlIFF1ZXJ5KVxuICAgKlxuICAgKiBAcGFyYW0gaWQgLSBTbmlwcGV0IFVVSURcbiAgICogQHJldHVybnMgU25pcHBldCBvZGVyIG51bGwgd2VubiBuaWNodCBnZWZ1bmRlblxuICAgKi9cbiAgYXN5bmMgZmluZEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8U25pcHBldCB8IG51bGw+IHtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgRmluZGluZyBzbmlwcGV0IGJ5IElEOiAke2lkfWApO1xuXG4gICAgY29uc3Qgc25pcHBldCA9IGF3YWl0IHRoaXMuZGIuZHJpenpsZS5xdWVyeS5zbmlwcGV0cy5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IGVxKHNuaXBwZXRzLmlkLCBpZCksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gc25pcHBldCA/PyBudWxsO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFJFQUQgLSBMSVNUU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogRmluZGV0IGFsbGUgU25pcHBldHMgZWluZXMgVXNlcnNcbiAgICpcbiAgICogUEVSRk9STUFOQ0U6IE51dHp0IHNuaXBwZXRzX3VzZXJfaWRfaWR4XG4gICAqXG4gICAqIEBwYXJhbSB1c2VySWQgLSBVc2VyIFVVSURcbiAgICogQHBhcmFtIGxpbWl0IC0gTWF4IEFuemFobCAoZGVmYXVsdCAyMCwgbWF4IDEwMClcbiAgICogQHJldHVybnMgTGlzdGUgdm9uIFNuaXBwZXRzIChzb3J0aWVydCBuYWNoIGNyZWF0ZWRBdCBERVNDKVxuICAgKi9cbiAgYXN5bmMgZmluZEJ5VXNlcklkKHVzZXJJZDogc3RyaW5nLCBsaW1pdCA9IDIwKTogUHJvbWlzZTxTbmlwcGV0W10+IHtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgRmluZGluZyBzbmlwcGV0cyBmb3IgdXNlcjogJHt1c2VySWR9YCk7XG5cbiAgICByZXR1cm4gdGhpcy5kYi5kcml6emxlLnF1ZXJ5LnNuaXBwZXRzLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiBlcShzbmlwcGV0cy51c2VySWQsIHVzZXJJZCksXG4gICAgICBsaW1pdDogTWF0aC5taW4obGltaXQsIDEwMCksXG4gICAgICBvcmRlckJ5OiBbZGVzYyhzbmlwcGV0cy5jcmVhdGVkQXQpXSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kZXQgw7ZmZmVudGxpY2hlIFNuaXBwZXRzIChwYWdpbmF0ZWQpXG4gICAqXG4gICAqIFBFUkZPUk1BTkNFOlxuICAgKiAtIE51dHp0IHNuaXBwZXRzX3B1YmxpY19jcmVhdGVkX2F0X2lkeCAoY29tcG9zaXRlIGluZGV4KVxuICAgKiAtIFp3ZWkgUXVlcmllczogRGF0YSArIENvdW50IChwYXJhbGxlbCBtw7ZnbGljaClcbiAgICogLSBQYWdpbmF0aW9uIHZlcmhpbmRlcnQgTWVtb3J5LU92ZXJmbG93XG4gICAqXG4gICAqIEBwYXJhbSBwYWdlIC0gU2VpdGUgKDEtaW5kZXhlZCwgZGVmYXVsdCAxKVxuICAgKiBAcGFyYW0gbGltaXQgLSBJdGVtcyBwcm8gU2VpdGUgKGRlZmF1bHQgMjAsIG1heCAxMDApXG4gICAqIEByZXR1cm5zIFBhZ2luYXRlZCBTbmlwcGV0c1xuICAgKi9cbiAgYXN5bmMgZmluZFB1YmxpYyhwYWdlID0gMSwgbGltaXQgPSAyMCk6IFByb21pc2U8UGFnaW5hdGVkU25pcHBldHM+IHtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhcbiAgICAgIGBGaW5kaW5nIHB1YmxpYyBzbmlwcGV0cyAocGFnZTogJHtwYWdlfSwgbGltaXQ6ICR7bGltaXR9KWAsXG4gICAgKTtcblxuICAgIGNvbnN0IHNhZmVMaW1pdCA9IE1hdGgubWluKGxpbWl0LCAxMDApO1xuICAgIGNvbnN0IG9mZnNldCA9IChwYWdlIC0gMSkgKiBzYWZlTGltaXQ7XG5cbiAgICAvLyBRdWVyeSAxOiBEYXRhXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuZGIuZHJpenpsZS5xdWVyeS5zbmlwcGV0cy5maW5kTWFueSh7XG4gICAgICB3aGVyZTogZXEoc25pcHBldHMuaXNQdWJsaWMsIHRydWUpLFxuICAgICAgbGltaXQ6IHNhZmVMaW1pdCxcbiAgICAgIG9mZnNldCxcbiAgICAgIG9yZGVyQnk6IFtkZXNjKHNuaXBwZXRzLmNyZWF0ZWRBdCldLFxuICAgIH0pO1xuXG4gICAgLy8gUXVlcnkgMjogQ291bnRcbiAgICBjb25zdCBbeyB0b3RhbCB9XSA9IGF3YWl0IHRoaXMuZGIuZHJpenpsZVxuICAgICAgLnNlbGVjdCh7IHRvdGFsOiBjb3VudCgpIH0pXG4gICAgICAuZnJvbShzbmlwcGV0cylcbiAgICAgIC53aGVyZShlcShzbmlwcGV0cy5pc1B1YmxpYywgdHJ1ZSkpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGEsXG4gICAgICBtZXRhOiBjYWxjdWxhdGVQYWdpbmF0aW9uTWV0YSh0b3RhbCwgcGFnZSwgc2FmZUxpbWl0KSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmRldCDDtmZmZW50bGljaGUgU25pcHBldC1QcmV2aWV3cyAoT0hORSBDb2RlKVxuICAgKlxuICAgKiBQRVJGT1JNQU5DRSBSRUdFTCAjMzogU2VsZWN0IG9ubHkgbmVlZGVkIGNvbHVtbnNcbiAgICogU3BhcnQgfjUwS0IgcHJvIFNuaXBwZXQgYmVpIExpc3Rlbi1BbnNpY2h0ZW4hXG4gICAqXG4gICAqIEBwYXJhbSBwYWdlIC0gU2VpdGVcbiAgICogQHBhcmFtIGxpbWl0IC0gSXRlbXMgcHJvIFNlaXRlXG4gICAqIEByZXR1cm5zIFBhZ2luYXRlZCBQcmV2aWV3c1xuICAgKi9cbiAgYXN5bmMgZmluZFB1YmxpY1ByZXZpZXdzKFxuICAgIHBhZ2UgPSAxLFxuICAgIGxpbWl0ID0gMjAsXG4gICk6IFByb21pc2U8UGFnaW5hdGVkU25pcHBldFByZXZpZXdzPiB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICBgRmluZGluZyBwdWJsaWMgc25pcHBldCBwcmV2aWV3cyAocGFnZTogJHtwYWdlfSwgbGltaXQ6ICR7bGltaXR9KWAsXG4gICAgKTtcbiAgICBjb25zdCBzYWZlTGltaXQgPSBNYXRoLm1pbihsaW1pdCwgMTAwKTtcbiAgICBjb25zdCBvZmZzZXQgPSAocGFnZSAtIDEpICogc2FmZUxpbWl0O1xuXG4gICAgLy8gUXVlcnkgMTogRGF0YSAob2huZSBjb2RlIEZlbGQhKVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmRiLmRyaXp6bGVcbiAgICAgIC5zZWxlY3Qoe1xuICAgICAgICBpZDogc25pcHBldHMuaWQsXG4gICAgICAgIHRpdGxlOiBzbmlwcGV0cy50aXRsZSxcbiAgICAgICAgZGVzY3JpcHRpb246IHNuaXBwZXRzLmRlc2NyaXB0aW9uLFxuICAgICAgICBsYW5ndWFnZTogc25pcHBldHMubGFuZ3VhZ2UsXG4gICAgICAgIHVzZXJJZDogc25pcHBldHMudXNlcklkLFxuICAgICAgICBpc1B1YmxpYzogc25pcHBldHMuaXNQdWJsaWMsXG4gICAgICAgIHZpZXdDb3VudDogc25pcHBldHMudmlld0NvdW50LFxuICAgICAgICBjcmVhdGVkQXQ6IHNuaXBwZXRzLmNyZWF0ZWRBdCxcbiAgICAgICAgdXBkYXRlZEF0OiBzbmlwcGV0cy51cGRhdGVkQXQsXG4gICAgICB9KVxuICAgICAgLmZyb20oc25pcHBldHMpXG4gICAgICAud2hlcmUoZXEoc25pcHBldHMuaXNQdWJsaWMsIHRydWUpKVxuICAgICAgLmxpbWl0KHNhZmVMaW1pdClcbiAgICAgIC5vZmZzZXQob2Zmc2V0KVxuICAgICAgLm9yZGVyQnkoZGVzYyhzbmlwcGV0cy5jcmVhdGVkQXQpKTtcblxuICAgIC8vIFF1ZXJ5IDI6IENvdW50XG4gICAgY29uc3QgW3sgdG90YWwgfV0gPSBhd2FpdCB0aGlzLmRiLmRyaXp6bGVcbiAgICAgIC5zZWxlY3QoeyB0b3RhbDogY291bnQoKSB9KVxuICAgICAgLmZyb20oc25pcHBldHMpXG4gICAgICAud2hlcmUoZXEoc25pcHBldHMuaXNQdWJsaWMsIHRydWUpKTtcblxuICAgIHJldHVybiB7XG4gICAgICBkYXRhLFxuICAgICAgbWV0YTogY2FsY3VsYXRlUGFnaW5hdGlvbk1ldGEodG90YWwsIHBhZ2UsIHNhZmVMaW1pdCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kZXQgU25pcHBldHMgbmFjaCBQcm9ncmFtbWllcnNwcmFjaGVcbiAgICpcbiAgICogUEVSRk9STUFOQ0U6IE51dHp0IHNuaXBwZXRzX2xhbmd1YWdlX2lkeFxuICAgKlxuICAgKiBAcGFyYW0gbGFuZ3VhZ2UgLSBQcm9ncmFtbWllcnNwcmFjaGUgKHouQi4gXCJ0eXBlc2NyaXB0XCIpXG4gICAqIEBwYXJhbSBsaW1pdCAtIE1heCBBbnphaGxcbiAgICogQHJldHVybnMgTGlzdGUgdm9uIFNuaXBwZXRzXG4gICAqL1xuICBhc3luYyBmaW5kQnlMYW5ndWFnZShsYW5ndWFnZTogc3RyaW5nLCBsaW1pdCA9IDIwKTogUHJvbWlzZTxTbmlwcGV0W10+IHtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgRmluZGluZyBzbmlwcGV0cyBieSBsYW5ndWFnZTogJHtsYW5ndWFnZX1gKTtcblxuICAgIHJldHVybiB0aGlzLmRiLmRyaXp6bGUucXVlcnkuc25pcHBldHMuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IGVxKHNuaXBwZXRzLmxhbmd1YWdlLCBsYW5ndWFnZSksXG4gICAgICBsaW1pdDogTWF0aC5taW4obGltaXQsIDEwMCksXG4gICAgICBvcmRlckJ5OiBbZGVzYyhzbmlwcGV0cy5jcmVhdGVkQXQpXSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFcndlaXRlcnRlIFN1Y2hlIG1pdCBGaWx0ZXJuIHVuZCBTb3J0aWVydW5nXG4gICAqXG4gICAqIFBFUkZPUk1BTkNFOiBOdXR6dCBJbmRpY2VzIGJhc2llcmVuZCBhdWYgRmlsdGVyblxuICAgKlxuICAgKiBAcGFyYW0gZmlsdGVycyAtIEZpbHRlci1PcHRpb25lblxuICAgKiBAcGFyYW0gc29ydCAtIFNvcnRpZXItT3B0aW9uZW4gKGRlZmF1bHQ6IGNyZWF0ZWRBdCBERVNDKVxuICAgKiBAcGFyYW0gcGFnZSAtIFNlaXRlXG4gICAqIEBwYXJhbSBsaW1pdCAtIEl0ZW1zIHBybyBTZWl0ZVxuICAgKiBAcmV0dXJucyBQYWdpbmF0ZWQgU25pcHBldHNcbiAgICovXG4gIGFzeW5jIGZpbmRXaXRoRmlsdGVycyhcbiAgICBmaWx0ZXJzOiBTbmlwcGV0RmlsdGVycyA9IHt9LFxuICAgIHNvcnQ6IFNuaXBwZXRTb3J0T3B0aW9ucyA9IERFRkFVTFRfU09SVCxcbiAgICBwYWdlID0gMSxcbiAgICBsaW1pdCA9IDIwLFxuICApOiBQcm9taXNlPFBhZ2luYXRlZFNuaXBwZXRzPiB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoJ0ZpbmRpbmcgc25pcHBldHMgd2l0aCBmaWx0ZXJzJywgeyBmaWx0ZXJzLCBzb3J0IH0pO1xuXG4gICAgY29uc3Qgc2FmZUxpbWl0ID0gTWF0aC5taW4obGltaXQsIDEwMCk7XG4gICAgY29uc3Qgb2Zmc2V0ID0gKHBhZ2UgLSAxKSAqIHNhZmVMaW1pdDtcblxuICAgIC8vIEJ1aWxkIFdIRVJFIGNsYXVzZVxuICAgIGNvbnN0IGNvbmRpdGlvbnMgPSB0aGlzLmJ1aWxkV2hlcmVDb25kaXRpb25zKGZpbHRlcnMpO1xuICAgIGNvbnN0IHdoZXJlQ2xhdXNlID0gY29uZGl0aW9ucy5sZW5ndGggPiAwID8gYW5kKC4uLmNvbmRpdGlvbnMpIDogdW5kZWZpbmVkO1xuXG4gICAgLy8gQnVpbGQgT1JERVIgQllcbiAgICBjb25zdCBzb3J0Q29sdW1uID0gc25pcHBldHNbc29ydC5zb3J0QnldO1xuICAgIGNvbnN0IG9yZGVyRm4gPSBzb3J0Lm9yZGVyID09PSAnYXNjJyA/IGFzYyA6IGRlc2M7XG5cbiAgICAvLyBRdWVyeSAxOiBEYXRhXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuZGIuZHJpenpsZS5xdWVyeS5zbmlwcGV0cy5maW5kTWFueSh7XG4gICAgICB3aGVyZTogd2hlcmVDbGF1c2UsXG4gICAgICBsaW1pdDogc2FmZUxpbWl0LFxuICAgICAgb2Zmc2V0LFxuICAgICAgb3JkZXJCeTogW29yZGVyRm4oc29ydENvbHVtbildLFxuICAgIH0pO1xuXG4gICAgLy8gUXVlcnkgMjogQ291bnRcbiAgICBjb25zdCBbeyB0b3RhbCB9XSA9IGF3YWl0IHRoaXMuZGIuZHJpenpsZVxuICAgICAgLnNlbGVjdCh7IHRvdGFsOiBjb3VudCgpIH0pXG4gICAgICAuZnJvbShzbmlwcGV0cylcbiAgICAgIC53aGVyZSh3aGVyZUNsYXVzZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGF0YSxcbiAgICAgIG1ldGE6IGNhbGN1bGF0ZVBhZ2luYXRpb25NZXRhKHRvdGFsLCBwYWdlLCBzYWZlTGltaXQpLFxuICAgIH07XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gVVBEQVRFXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBBa3R1YWxpc2llcnQgU25pcHBldC1EYXRlblxuICAgKlxuICAgKiBXSUNIVElHOiB1cGRhdGVkQXQgd2lyZCBhdXRvbWF0aXNjaCBnZXNldHp0XG4gICAqXG4gICAqIEBwYXJhbSBpZCAtIFNuaXBwZXQgVVVJRFxuICAgKiBAcGFyYW0gZGF0YSAtIFp1IGFrdHVhbGlzaWVyZW5kZSBGZWxkZXJcbiAgICogQHJldHVybnMgQWt0dWFsaXNpZXJ0ZXIgU25pcHBldCBvZGVyIG51bGwgd2VubiBuaWNodCBnZWZ1bmRlblxuICAgKi9cbiAgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGRhdGE6IFBhcnRpYWw8TmV3U25pcHBldD4pOiBQcm9taXNlPFNuaXBwZXQgfCBudWxsPiB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYFVwZGF0aW5nIHNuaXBwZXQ6ICR7aWR9YCk7XG5cbiAgICBjb25zdCBbdXBkYXRlZFNuaXBwZXRdID0gYXdhaXQgdGhpcy5kYi5kcml6emxlXG4gICAgICAudXBkYXRlKHNuaXBwZXRzKVxuICAgICAgLnNldCh7XG4gICAgICAgIC4uLmRhdGEsXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSwgLy8gVGltZXN0YW1wIGltbWVyIGFrdHVhbGlzaWVyZW5cbiAgICAgIH0pXG4gICAgICAud2hlcmUoZXEoc25pcHBldHMuaWQsIGlkKSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgIGlmICghdXBkYXRlZFNuaXBwZXQpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYFNuaXBwZXQgbm90IGZvdW5kIGZvciB1cGRhdGU6ICR7aWR9YCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coYFNuaXBwZXQgdXBkYXRlZDogJHtpZH1gKTtcbiAgICByZXR1cm4gdXBkYXRlZFNuaXBwZXQ7XG4gIH1cblxuICAvKipcbiAgICogRXJow7ZodCBWaWV3IENvdW50IHVtIDEgKEF0b21pYyBPcGVyYXRpb24pXG4gICAqXG4gICAqIFBFUkZPUk1BTkNFOiBBdG9taWMgU1FMIFVwZGF0ZSAoa2VpbiBSYWNlIENvbmRpdGlvbilcbiAgICpcbiAgICogQHBhcmFtIGlkIC0gU25pcHBldCBVVUlEXG4gICAqIEByZXR1cm5zIHRydWUgd2VubiBlcmZvbGdyZWljaCwgZmFsc2Ugd2VubiBuaWNodCBnZWZ1bmRlblxuICAgKi9cbiAgYXN5bmMgaW5jcmVtZW50Vmlld0NvdW50KGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgSW5jcmVtZW50aW5nIHZpZXcgY291bnQgZm9yIHNuaXBwZXQ6ICR7aWR9YCk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmRiLmRyaXp6bGVcbiAgICAgIC51cGRhdGUoc25pcHBldHMpXG4gICAgICAuc2V0KHtcbiAgICAgICAgdmlld0NvdW50OiBzcWxgJHtzbmlwcGV0cy52aWV3Q291bnR9ICsgMWAsXG4gICAgICB9KVxuICAgICAgLndoZXJlKGVxKHNuaXBwZXRzLmlkLCBpZCkpXG4gICAgICAucmV0dXJuaW5nKHsgaWQ6IHNuaXBwZXRzLmlkIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPiAwO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIERFTEVURVxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogTMO2c2NodCBTbmlwcGV0IChIYXJkIERlbGV0ZSlcbiAgICpcbiAgICogSElOV0VJUzogU29mdCBEZWxldGUgKGlzRGVsZXRlZCBGbGFnKSB3w6RyZSBpbiBQcm9kdWN0aW9uIGJlc3NlclxuICAgKlxuICAgKiBAcGFyYW0gaWQgLSBTbmlwcGV0IFVVSURcbiAgICogQHJldHVybnMgdHJ1ZSB3ZW5uIGdlbMO2c2NodCwgZmFsc2Ugd2VubiBuaWNodCBnZWZ1bmRlblxuICAgKi9cbiAgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgRGVsZXRpbmcgc25pcHBldDogJHtpZH1gKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIuZHJpenpsZVxuICAgICAgLmRlbGV0ZShzbmlwcGV0cylcbiAgICAgIC53aGVyZShlcShzbmlwcGV0cy5pZCwgaWQpKVxuICAgICAgLnJldHVybmluZyh7IGlkOiBzbmlwcGV0cy5pZCB9KTtcblxuICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKGBTbmlwcGV0IG5vdCBmb3VuZCBmb3IgZGVsZXRpb246ICR7aWR9YCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIubG9nKGBTbmlwcGV0IGRlbGV0ZWQ6ICR7aWR9YCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQkFUQ0ggT1BFUkFUSU9OU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogTMO2c2NodCBhbGxlIFNuaXBwZXRzIGVpbmVzIFVzZXJzIChCYXRjaCBEZWxldGUpXG4gICAqXG4gICAqIFZFUldFTkRVTkc6IEJlaSBVc2VyLUzDtnNjaHVuZyAoenVzw6R0emxpY2ggenUgQ0FTQ0FERSlcbiAgICpcbiAgICogQHBhcmFtIHVzZXJJZCAtIFVzZXIgVVVJRFxuICAgKiBAcmV0dXJucyBBbnphaGwgZ2Vsw7ZzY2h0ZXIgU25pcHBldHNcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUJ5VXNlcklkKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgRGVsZXRpbmcgYWxsIHNuaXBwZXRzIGZvciB1c2VyOiAke3VzZXJJZH1gKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZGIuZHJpenpsZVxuICAgICAgLmRlbGV0ZShzbmlwcGV0cylcbiAgICAgIC53aGVyZShlcShzbmlwcGV0cy51c2VySWQsIHVzZXJJZCkpXG4gICAgICAucmV0dXJuaW5nKHsgaWQ6IHNuaXBwZXRzLmlkIH0pO1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKGBEZWxldGVkICR7cmVzdWx0Lmxlbmd0aH0gc25pcHBldHMgZm9yIHVzZXI6ICR7dXNlcklkfWApO1xuICAgIHJldHVybiByZXN1bHQubGVuZ3RoO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFNUQVRJU1RJQ1NcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIFrDpGhsdCBTbmlwcGV0cyBlaW5lcyBVc2Vyc1xuICAgKlxuICAgKiBAcGFyYW0gdXNlcklkIC0gVXNlciBVVUlEXG4gICAqIEByZXR1cm5zIEFuemFobCBkZXIgU25pcHBldHNcbiAgICovXG4gIGFzeW5jIGNvdW50QnlVc2VySWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IFt7IHRvdGFsIH1dID0gYXdhaXQgdGhpcy5kYi5kcml6emxlXG4gICAgICAuc2VsZWN0KHsgdG90YWw6IGNvdW50KCkgfSlcbiAgICAgIC5mcm9tKHNuaXBwZXRzKVxuICAgICAgLndoZXJlKGVxKHNuaXBwZXRzLnVzZXJJZCwgdXNlcklkKSk7XG5cbiAgICByZXR1cm4gdG90YWw7XG4gIH1cblxuICAvKipcbiAgICogWsOkaGx0IMO2ZmZlbnRsaWNoZSBTbmlwcGV0c1xuICAgKlxuICAgKiBAcmV0dXJucyBBbnphaGwgw7ZmZmVudGxpY2hlciBTbmlwcGV0c1xuICAgKi9cbiAgYXN5bmMgY291bnRQdWJsaWMoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCBbeyB0b3RhbCB9XSA9IGF3YWl0IHRoaXMuZGIuZHJpenpsZVxuICAgICAgLnNlbGVjdCh7IHRvdGFsOiBjb3VudCgpIH0pXG4gICAgICAuZnJvbShzbmlwcGV0cylcbiAgICAgIC53aGVyZShlcShzbmlwcGV0cy5pc1B1YmxpYywgdHJ1ZSkpO1xuXG4gICAgcmV0dXJuIHRvdGFsO1xuICB9XG5cbiAgLyoqXG4gICAqIEhvbHQgdW1mYXNzZW5kZSBTdGF0aXN0aWtlbiBmw7xyIGVpbmVuIFVzZXJcbiAgICpcbiAgICogUEVSRk9STUFOQ0U6IFNpbmdsZSBRdWVyeSBtaXQgQWdncmVnYXRpb25cbiAgICpcbiAgICogQHBhcmFtIHVzZXJJZCAtIFVzZXIgVVVJRFxuICAgKiBAcmV0dXJucyBTbmlwcGV0IFN0YXRpc3RpY3NcbiAgICovXG4gIGFzeW5jIGdldFVzZXJTdGF0cyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8U25pcHBldFN0YXRzPiB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYEdldHRpbmcgc3RhdHMgZm9yIHVzZXI6ICR7dXNlcklkfWApO1xuXG4gICAgLy8gQWxsZSBVc2VyLVNuaXBwZXRzIGhvbGVuXG4gICAgY29uc3QgdXNlclNuaXBwZXRzID0gYXdhaXQgdGhpcy5kYi5kcml6emxlLnF1ZXJ5LnNuaXBwZXRzLmZpbmRNYW55KHtcbiAgICAgIHdoZXJlOiBlcShzbmlwcGV0cy51c2VySWQsIHVzZXJJZCksXG4gICAgfSk7XG5cbiAgICAvLyBTdGF0aXN0aWtlbiBiZXJlY2huZW5cbiAgICBjb25zdCB0b3RhbCA9IHVzZXJTbmlwcGV0cy5sZW5ndGg7XG4gICAgY29uc3QgcHVibGljQ291bnQgPSB1c2VyU25pcHBldHMuZmlsdGVyKChzKSA9PiBzLmlzUHVibGljKS5sZW5ndGg7XG4gICAgY29uc3QgcHJpdmF0ZUNvdW50ID0gdG90YWwgLSBwdWJsaWNDb3VudDtcbiAgICBjb25zdCB0b3RhbFZpZXdzID0gdXNlclNuaXBwZXRzLnJlZHVjZSgoc3VtLCBzKSA9PiBzdW0gKyBzLnZpZXdDb3VudCwgMCk7XG5cbiAgICAvLyBNb3N0IHZpZXdlZCBTbmlwcGV0XG4gICAgY29uc3QgbW9zdFZpZXdlZCA9IHVzZXJTbmlwcGV0cy5zb3J0KFxuICAgICAgKGEsIGIpID0+IGIudmlld0NvdW50IC0gYS52aWV3Q291bnQsXG4gICAgKVswXTtcblxuICAgIC8vIExhdGVzdCBTbmlwcGV0XG4gICAgY29uc3QgbGF0ZXN0U25pcHBldCA9IHVzZXJTbmlwcGV0cy5zb3J0KFxuICAgICAgKGEsIGIpID0+IGIuY3JlYXRlZEF0LmdldFRpbWUoKSAtIGEuY3JlYXRlZEF0LmdldFRpbWUoKSxcbiAgICApWzBdO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsLFxuICAgICAgcHVibGljOiBwdWJsaWNDb3VudCxcbiAgICAgIHByaXZhdGU6IHByaXZhdGVDb3VudCxcbiAgICAgIHRvdGFsVmlld3MsXG4gICAgICBtb3N0Vmlld2VkLFxuICAgICAgbGF0ZXN0U25pcHBldCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhvbHQgU3ByYWNoZW4tU3RhdGlzdGlrZW5cbiAgICpcbiAgICogQHBhcmFtIHVzZXJJZCAtIE9wdGlvbmFsOiBOdXIgZsO8ciBlaW5lbiBVc2VyXG4gICAqIEByZXR1cm5zIExhbmd1YWdlIFN0YXRzIHNvcnRpZXJ0IG5hY2ggQ291bnQgREVTQ1xuICAgKi9cbiAgYXN5bmMgZ2V0TGFuZ3VhZ2VTdGF0cyhcbiAgICB1c2VySWQ/OiBzdHJpbmcsXG4gICk6IFByb21pc2U8QXJyYXk8eyBsYW5ndWFnZTogc3RyaW5nOyBjb3VudDogbnVtYmVyIH0+PiB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICBgR2V0dGluZyBsYW5ndWFnZSBzdGF0cyR7dXNlcklkID8gYCBmb3IgdXNlcjogJHt1c2VySWR9YCA6ICcnfWAsXG4gICAgKTtcblxuICAgIGNvbnN0IHdoZXJlQ2xhdXNlID0gdXNlcklkID8gZXEoc25pcHBldHMudXNlcklkLCB1c2VySWQpIDogdW5kZWZpbmVkO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5kYi5kcml6emxlXG4gICAgICAuc2VsZWN0KHtcbiAgICAgICAgbGFuZ3VhZ2U6IHNuaXBwZXRzLmxhbmd1YWdlLFxuICAgICAgICBjb3VudDogY291bnQoKSxcbiAgICAgIH0pXG4gICAgICAuZnJvbShzbmlwcGV0cylcbiAgICAgIC53aGVyZSh3aGVyZUNsYXVzZSlcbiAgICAgIC5ncm91cEJ5KHNuaXBwZXRzLmxhbmd1YWdlKVxuICAgICAgLm9yZGVyQnkoZGVzYyhjb3VudCgpKSk7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFBSSVZBVEUgSEVMUEVSU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogQmF1dCBXSEVSRSBDb25kaXRpb25zIGF1cyBGaWx0ZXJuXG4gICAqXG4gICAqIEBwYXJhbSBmaWx0ZXJzIC0gRmlsdGVyLU9wdGlvbmVuXG4gICAqIEByZXR1cm5zIEFycmF5IHZvbiBEcml6emxlIENvbmRpdGlvbnNcbiAgICovXG4gIHByaXZhdGUgYnVpbGRXaGVyZUNvbmRpdGlvbnMoZmlsdGVyczogU25pcHBldEZpbHRlcnMpIHtcbiAgICBjb25zdCBjb25kaXRpb25zID0gW107XG5cbiAgICBpZiAoZmlsdGVycy51c2VySWQpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaChlcShzbmlwcGV0cy51c2VySWQsIGZpbHRlcnMudXNlcklkKSk7XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlcnMubGFuZ3VhZ2UpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaChlcShzbmlwcGV0cy5sYW5ndWFnZSwgZmlsdGVycy5sYW5ndWFnZSkpO1xuICAgIH1cblxuICAgIGlmIChmaWx0ZXJzLmlzUHVibGljICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaChlcShzbmlwcGV0cy5pc1B1YmxpYywgZmlsdGVycy5pc1B1YmxpYykpO1xuICAgIH1cblxuICAgIGlmIChmaWx0ZXJzLnNlYXJjaCkge1xuICAgICAgLy8gU2ltcGxlIHRleHQgc2VhcmNoIChjYXNlLWluc2Vuc2l0aXZlKVxuICAgICAgLy8gVE9ETyBTcHJpbnQgMjogRnVsbC10ZXh0IHNlYXJjaCBtaXQgUG9zdGdyZVNRTCB0c192ZWN0b3JcbiAgICAgIGNvbnN0IHNlYXJjaFBhdHRlcm4gPSBgJSR7ZmlsdGVycy5zZWFyY2h9JWA7XG4gICAgICBjb25kaXRpb25zLnB1c2goXG4gICAgICAgIG9yKFxuICAgICAgICAgIHNxbGBMT1dFUigke3NuaXBwZXRzLnRpdGxlfSkgTElLRSBMT1dFUigke3NlYXJjaFBhdHRlcm59KWAsXG4gICAgICAgICAgc3FsYExPV0VSKCR7c25pcHBldHMuZGVzY3JpcHRpb259KSBMSUtFIExPV0VSKCR7c2VhcmNoUGF0dGVybn0pYCxcbiAgICAgICAgKSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlcnMuY3JlYXRlZEFmdGVyKSB7XG4gICAgICBjb25kaXRpb25zLnB1c2goc3FsYCR7c25pcHBldHMuY3JlYXRlZEF0fSA+PSAke2ZpbHRlcnMuY3JlYXRlZEFmdGVyfWApO1xuICAgIH1cblxuICAgIGlmIChmaWx0ZXJzLmNyZWF0ZWRCZWZvcmUpIHtcbiAgICAgIGNvbmRpdGlvbnMucHVzaChzcWxgJHtzbmlwcGV0cy5jcmVhdGVkQXR9IDw9ICR7ZmlsdGVycy5jcmVhdGVkQmVmb3JlfWApO1xuICAgIH1cblxuICAgIHJldHVybiBjb25kaXRpb25zO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=