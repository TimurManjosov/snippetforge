{"file":"/home/runner/work/snippetforge/snippetforge/apps/api/src/modules/snippets/snippets.repository.ts","mappings":";AAAA,8CAA8C;;;;;;;;;;;;;;AAE9C,2CAAoD;AACpD,6CAAiE;AACjE,gDAA8E;AAC9E,oDAAwD;AACxD,qDAQ0B;AAE1B;;;;;;;;;;;;;;;;;;;;;;;GAuBG;AAEI,IAAM,kBAAkB,0BAAxB,MAAM,kBAAkB;IAGA;IAFZ,MAAM,GAAG,IAAI,eAAM,CAAC,oBAAkB,CAAC,IAAI,CAAC,CAAC;IAE9D,YAA6B,EAAmB;QAAnB,OAAE,GAAF,EAAE,CAAiB;IAAG,CAAC;IAEpD,+DAA+D;IAC/D,SAAS;IACT,+DAA+D;IAE/D;;;;;;;;OAQG;IACH,KAAK,CAAC,MAAM,CAAC,IAAgB;QAC3B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,qBAAqB,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;QAErD,MAAM,CAAC,OAAO,CAAC,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aACpC,MAAM,CAAC,iBAAQ,CAAC;aAChB,MAAM,CAAC,IAAI,CAAC;aACZ,SAAS,EAAE,CAAC;QAEf,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,oBAAoB,OAAO,CAAC,EAAE,EAAE,CAAC,CAAC;QAClD,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,+DAA+D;IAC/D,gBAAgB;IAChB,+DAA+D;IAE/D;;;;;;;OAOG;IACH,KAAK,CAAC,QAAQ,CAAC,EAAU;QACvB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,0BAA0B,EAAE,EAAE,CAAC,CAAC;QAElD,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC7D,KAAK,EAAE,IAAA,gBAAE,EAAC,iBAAQ,CAAC,EAAE,EAAE,EAAE,CAAC;SAC3B,CAAC,CAAC;QAEH,OAAO,OAAO,IAAI,IAAI,CAAC;IACzB,CAAC;IAED,+DAA+D;IAC/D,eAAe;IACf,+DAA+D;IAE/D;;;;;;;;OAQG;IACH,KAAK,CAAC,YAAY,CAAC,MAAc,EAAE,KAAK,GAAG,EAAE;QAC3C,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,8BAA8B,MAAM,EAAE,CAAC,CAAC;QAE1D,OAAO,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAC7C,KAAK,EAAE,IAAA,gBAAE,EAAC,iBAAQ,CAAC,MAAM,EAAE,MAAM,CAAC;YAClC,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC;YAC3B,OAAO,EAAE,CAAC,IAAA,kBAAI,EAAC,iBAAQ,CAAC,SAAS,CAAC,CAAC;SACpC,CAAC,CAAC;IACL,CAAC;IAED;;;;;;;;;;;OAWG;IACH,KAAK,CAAC,UAAU,CAAC,IAAI,GAAG,CAAC,EAAE,KAAK,GAAG,EAAE;QACnC,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,kCAAkC,IAAI,YAAY,KAAK,GAAG,CAC3D,CAAC;QAEF,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;QACvC,MAAM,MAAM,GAAG,CAAC,IAAI,GAAG,CAAC,CAAC,GAAG,SAAS,CAAC;QAEtC,gBAAgB;QAChB,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC;YACzD,KAAK,EAAE,IAAA,gBAAE,EAAC,iBAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC;YAClC,KAAK,EAAE,SAAS;YAChB,MAAM;YACN,OAAO,EAAE,CAAC,IAAA,kBAAI,EAAC,iBAAQ,CAAC,SAAS,CAAC,CAAC;SACpC,CAAC,CAAC;QAEH,iBAAiB;QACjB,MAAM,CAAC,EAAE,KAAK,EAAE,CAAC,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aACtC,MAAM,CAAC,EAAE,KAAK,EAAE,IAAA,mBAAK,GAAE,EAAE,CAAC;aAC1B,IAAI,CAAC,iBAAQ,CAAC;aACd,KAAK,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC;QAEtC,OAAO;YACL,IAAI;YACJ,IAAI,EAAE,IAAA,wCAAuB,EAAC,KAAK,EAAE,IAAI,EAAE,SAAS,CAAC;SACtD,CAAC;IACJ,CAAC;IAED;;;;;;;;;OASG;IACH,KAAK,CAAC,kBAAkB,CACtB,IAAI,GAAG,CAAC,EACR,KAAK,GAAG,EAAE;QAEV,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,0CAA0C,IAAI,YAAY,KAAK,GAAG,CACnE,CAAC;QACF,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;QACvC,MAAM,MAAM,GAAG,CAAC,IAAI,GAAG,CAAC,CAAC,GAAG,SAAS,CAAC;QAEtC,kCAAkC;QAClC,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aAC/B,MAAM,CAAC;YACN,EAAE,EAAE,iBAAQ,CAAC,EAAE;YACf,KAAK,EAAE,iBAAQ,CAAC,KAAK;YACrB,WAAW,EAAE,iBAAQ,CAAC,WAAW;YACjC,QAAQ,EAAE,iBAAQ,CAAC,QAAQ;YAC3B,MAAM,EAAE,iBAAQ,CAAC,MAAM;YACvB,QAAQ,EAAE,iBAAQ,CAAC,QAAQ;YAC3B,SAAS,EAAE,iBAAQ,CAAC,SAAS;YAC7B,SAAS,EAAE,iBAAQ,CAAC,SAAS;YAC7B,SAAS,EAAE,iBAAQ,CAAC,SAAS;SAC9B,CAAC;aACD,IAAI,CAAC,iBAAQ,CAAC;aACd,KAAK,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;aAClC,KAAK,CAAC,SAAS,CAAC;aAChB,MAAM,CAAC,MAAM,CAAC;aACd,OAAO,CAAC,IAAA,kBAAI,EAAC,iBAAQ,CAAC,SAAS,CAAC,CAAC,CAAC;QAErC,iBAAiB;QACjB,MAAM,CAAC,EAAE,KAAK,EAAE,CAAC,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aACtC,MAAM,CAAC,EAAE,KAAK,EAAE,IAAA,mBAAK,GAAE,EAAE,CAAC;aAC1B,IAAI,CAAC,iBAAQ,CAAC;aACd,KAAK,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC;QAEtC,OAAO;YACL,IAAI;YACJ,IAAI,EAAE,IAAA,wCAAuB,EAAC,KAAK,EAAE,IAAI,EAAE,SAAS,CAAC;SACtD,CAAC;IACJ,CAAC;IAED;;;;;;;;OAQG;IACH,KAAK,CAAC,cAAc,CAAC,QAAgB,EAAE,KAAK,GAAG,EAAE;QAC/C,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,iCAAiC,QAAQ,EAAE,CAAC,CAAC;QAE/D,OAAO,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAC7C,KAAK,EAAE,IAAA,gBAAE,EAAC,iBAAQ,CAAC,QAAQ,EAAE,QAAQ,CAAC;YACtC,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC;YAC3B,OAAO,EAAE,CAAC,IAAA,kBAAI,EAAC,iBAAQ,CAAC,SAAS,CAAC,CAAC;SACpC,CAAC,CAAC;IACL,CAAC;IAED;;;;;;;;;;OAUG;IACH,KAAK,CAAC,eAAe,CACnB,UAA0B,EAAE,EAC5B,OAA2B,6BAAY,EACvC,IAAI,GAAG,CAAC,EACR,KAAK,GAAG,EAAE;QAEV,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,+BAA+B,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;QAEtE,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;QACvC,MAAM,MAAM,GAAG,CAAC,IAAI,GAAG,CAAC,CAAC,GAAG,SAAS,CAAC;QAEtC,qBAAqB;QACrB,MAAM,UAAU,GAAG,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QACtD,MAAM,WAAW,GAAG,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,IAAA,iBAAG,EAAC,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QAE3E,iBAAiB;QACjB,MAAM,UAAU,GAAG,iBAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACzC,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,KAAK,KAAK,CAAC,CAAC,CAAC,iBAAG,CAAC,CAAC,CAAC,kBAAI,CAAC;QAElD,gBAAgB;QAChB,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC;YACzD,KAAK,EAAE,WAAW;YAClB,KAAK,EAAE,SAAS;YAChB,MAAM;YACN,OAAO,EAAE,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;SAC/B,CAAC,CAAC;QAEH,iBAAiB;QACjB,MAAM,CAAC,EAAE,KAAK,EAAE,CAAC,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aACtC,MAAM,CAAC,EAAE,KAAK,EAAE,IAAA,mBAAK,GAAE,EAAE,CAAC;aAC1B,IAAI,CAAC,iBAAQ,CAAC;aACd,KAAK,CAAC,WAAW,CAAC,CAAC;QAEtB,OAAO;YACL,IAAI;YACJ,IAAI,EAAE,IAAA,wCAAuB,EAAC,KAAK,EAAE,IAAI,EAAE,SAAS,CAAC;SACtD,CAAC;IACJ,CAAC;IAED,+DAA+D;IAC/D,SAAS;IACT,+DAA+D;IAE/D;;;;;;;;OAQG;IACH,KAAK,CAAC,MAAM,CAAC,EAAU,EAAE,IAAyB;QAChD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,qBAAqB,EAAE,EAAE,CAAC,CAAC;QAE7C,MAAM,CAAC,cAAc,CAAC,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aAC3C,MAAM,CAAC,iBAAQ,CAAC;aAChB,GAAG,CAAC;YACH,GAAG,IAAI;YACP,SAAS,EAAE,IAAI,IAAI,EAAE,EAAE,gCAAgC;SACxD,CAAC;aACD,KAAK,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;aAC1B,SAAS,EAAE,CAAC;QAEf,IAAI,CAAC,cAAc,EAAE,CAAC;YACpB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,iCAAiC,EAAE,EAAE,CAAC,CAAC;YACxD,OAAO,IAAI,CAAC;QACd,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,oBAAoB,EAAE,EAAE,CAAC,CAAC;QAC1C,OAAO,cAAc,CAAC;IACxB,CAAC;IAED;;;;;;;OAOG;IACH,KAAK,CAAC,kBAAkB,CAAC,EAAU;QACjC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,wCAAwC,EAAE,EAAE,CAAC,CAAC;QAEhE,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aACjC,MAAM,CAAC,iBAAQ,CAAC;aAChB,GAAG,CAAC;YACH,SAAS,EAAE,IAAA,iBAAG,EAAA,GAAG,iBAAQ,CAAC,SAAS,MAAM;SAC1C,CAAC;aACD,KAAK,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;aAC1B,SAAS,CAAC,EAAE,EAAE,EAAE,iBAAQ,CAAC,EAAE,EAAE,CAAC,CAAC;QAElC,OAAO,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;IAC3B,CAAC;IAED,+DAA+D;IAC/D,SAAS;IACT,+DAA+D;IAE/D;;;;;;;OAOG;IACH,KAAK,CAAC,MAAM,CAAC,EAAU;QACrB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,qBAAqB,EAAE,EAAE,CAAC,CAAC;QAE7C,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aACjC,MAAM,CAAC,iBAAQ,CAAC;aAChB,KAAK,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;aAC1B,SAAS,CAAC,EAAE,EAAE,EAAE,iBAAQ,CAAC,EAAE,EAAE,CAAC,CAAC;QAElC,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACxB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,mCAAmC,EAAE,EAAE,CAAC,CAAC;YAC1D,OAAO,KAAK,CAAC;QACf,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,oBAAoB,EAAE,EAAE,CAAC,CAAC;QAC1C,OAAO,IAAI,CAAC;IACd,CAAC;IAED,+DAA+D;IAC/D,mBAAmB;IACnB,+DAA+D;IAE/D;;;;;;;OAOG;IACH,KAAK,CAAC,cAAc,CAAC,MAAc;QACjC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,mCAAmC,MAAM,EAAE,CAAC,CAAC;QAE/D,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aACjC,MAAM,CAAC,iBAAQ,CAAC;aAChB,KAAK,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;aAClC,SAAS,CAAC,EAAE,EAAE,EAAE,iBAAQ,CAAC,EAAE,EAAE,CAAC,CAAC;QAElC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,WAAW,MAAM,CAAC,MAAM,uBAAuB,MAAM,EAAE,CAAC,CAAC;QACzE,OAAO,MAAM,CAAC,MAAM,CAAC;IACvB,CAAC;IAED,+DAA+D;IAC/D,aAAa;IACb,+DAA+D;IAE/D;;;;;OAKG;IACH,KAAK,CAAC,aAAa,CAAC,MAAc;QAChC,MAAM,CAAC,EAAE,KAAK,EAAE,CAAC,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aACtC,MAAM,CAAC,EAAE,KAAK,EAAE,IAAA,mBAAK,GAAE,EAAE,CAAC;aAC1B,IAAI,CAAC,iBAAQ,CAAC;aACd,KAAK,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;QAEtC,OAAO,KAAK,CAAC;IACf,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,WAAW;QACf,MAAM,CAAC,EAAE,KAAK,EAAE,CAAC,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aACtC,MAAM,CAAC,EAAE,KAAK,EAAE,IAAA,mBAAK,GAAE,EAAE,CAAC;aAC1B,IAAI,CAAC,iBAAQ,CAAC;aACd,KAAK,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC;QAEtC,OAAO,KAAK,CAAC;IACf,CAAC;IAED;;;;;;;OAOG;IACH,KAAK,CAAC,YAAY,CAAC,MAAc;QAC/B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,2BAA2B,MAAM,EAAE,CAAC,CAAC;QAEvD,2BAA2B;QAC3B,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC;YACjE,KAAK,EAAE,IAAA,gBAAE,EAAC,iBAAQ,CAAC,MAAM,EAAE,MAAM,CAAC;SACnC,CAAC,CAAC;QAEH,wBAAwB;QACxB,MAAM,KAAK,GAAG,YAAY,CAAC,MAAM,CAAC;QAClC,MAAM,WAAW,GAAG,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC;QAClE,MAAM,YAAY,GAAG,KAAK,GAAG,WAAW,CAAC;QACzC,MAAM,UAAU,GAAG,YAAY,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,GAAG,GAAG,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;QAEzE,sBAAsB;QACtB,MAAM,UAAU,GAAG,YAAY,CAAC,IAAI,CAClC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,CACpC,CAAC,CAAC,CAAC,CAAC;QAEL,iBAAiB;QACjB,MAAM,aAAa,GAAG,YAAY,CAAC,IAAI,CACrC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,SAAS,CAAC,OAAO,EAAE,CACxD,CAAC,CAAC,CAAC,CAAC;QAEL,OAAO;YACL,KAAK;YACL,MAAM,EAAE,WAAW;YACnB,OAAO,EAAE,YAAY;YACrB,UAAU;YACV,UAAU;YACV,aAAa;SACd,CAAC;IACJ,CAAC;IAED;;;;;OAKG;IACH,KAAK,CAAC,gBAAgB,CACpB,MAAe;QAEf,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,yBAAyB,MAAM,CAAC,CAAC,CAAC,cAAc,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE,CAChE,CAAC;QAEF,MAAM,WAAW,GAAG,MAAM,CAAC,CAAC,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QAErE,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,EAAE,CAAC,OAAO;aACjC,MAAM,CAAC;YACN,QAAQ,EAAE,iBAAQ,CAAC,QAAQ;YAC3B,KAAK,EAAE,IAAA,mBAAK,GAAE;SACf,CAAC;aACD,IAAI,CAAC,iBAAQ,CAAC;aACd,KAAK,CAAC,WAAW,CAAC;aAClB,OAAO,CAAC,iBAAQ,CAAC,QAAQ,CAAC;aAC1B,OAAO,CAAC,IAAA,kBAAI,EAAC,IAAA,mBAAK,GAAE,CAAC,CAAC,CAAC;QAE1B,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,+DAA+D;IAC/D,kBAAkB;IAClB,+DAA+D;IAE/D;;;;;OAKG;IACK,oBAAoB,CAAC,OAAuB;QAClD,MAAM,UAAU,GAAG,EAAE,CAAC;QAEtB,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;YACnB,UAAU,CAAC,IAAI,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,MAAM,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;QACvD,CAAC;QAED,IAAI,OAAO,CAAC,QAAQ,EAAE,CAAC;YACrB,UAAU,CAAC,IAAI,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,QAAQ,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3D,CAAC;QAED,IAAI,OAAO,CAAC,QAAQ,KAAK,SAAS,EAAE,CAAC;YACnC,UAAU,CAAC,IAAI,CAAC,IAAA,gBAAE,EAAC,iBAAQ,CAAC,QAAQ,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3D,CAAC;QAED,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;YACnB,wCAAwC;YACxC,2DAA2D;YAC3D,MAAM,aAAa,GAAG,IAAI,OAAO,CAAC,MAAM,GAAG,CAAC;YAC5C,UAAU,CAAC,IAAI,CACb,IAAA,gBAAE,EACA,IAAA,iBAAG,EAAA,SAAS,iBAAQ,CAAC,KAAK,gBAAgB,aAAa,GAAG,EAC1D,IAAA,iBAAG,EAAA,SAAS,iBAAQ,CAAC,WAAW,gBAAgB,aAAa,GAAG,CACjE,CACF,CAAC;QACJ,CAAC;QAED,IAAI,OAAO,CAAC,YAAY,EAAE,CAAC;YACzB,UAAU,CAAC,IAAI,CAAC,IAAA,iBAAG,EAAA,GAAG,iBAAQ,CAAC,SAAS,OAAO,OAAO,CAAC,YAAY,EAAE,CAAC,CAAC;QACzE,CAAC;QAED,IAAI,OAAO,CAAC,aAAa,EAAE,CAAC;YAC1B,UAAU,CAAC,IAAI,CAAC,IAAA,iBAAG,EAAA,GAAG,iBAAQ,CAAC,SAAS,OAAO,OAAO,CAAC,aAAa,EAAE,CAAC,CAAC;QAC1E,CAAC;QAED,OAAO,UAAU,CAAC;IACpB,CAAC;CACF,CAAA;AA9eY,gDAAkB;6BAAlB,kBAAkB;IAD9B,IAAA,mBAAU,GAAE;yDAIsB,0BAAe,oBAAf,0BAAe;GAHrC,kBAAkB,CA8e9B","names":[],"sources":["/home/runner/work/snippetforge/snippetforge/apps/api/src/modules/snippets/snippets.repository.ts"],"sourcesContent":["// src/modules/snippets/snippets.repository.ts\n\nimport { Injectable, Logger } from '@nestjs/common';\nimport { and, asc, count, desc, eq, or, sql } from 'drizzle-orm';\nimport { snippets, type NewSnippet, type Snippet } from '../../lib/db/schema';\nimport { DatabaseService } from '../../shared/database';\nimport {\n  calculatePaginationMeta,\n  DEFAULT_SORT,\n  type PaginatedSnippetPreviews,\n  type PaginatedSnippets,\n  type SnippetFilters,\n  type SnippetSortOptions,\n  type SnippetStats,\n} from './snippets.types';\n\n/**\n * SnippetsRepository - Data Access Layer für Snippets\n *\n * VERANTWORTLICHKEITEN (Single Responsibility):\n * - Alle Datenbank-Queries für Snippets\n * - Keine Business Logic (z.B. keine Ownership-Checks)\n * - Keine HTTP-Concerns (keine Exceptions außer DB-Errors)\n *\n * CLEAN CODE REGEL #2: Repository Returns Domain Objects\n * - Alle Methoden geben typisierte Objekte zurück\n * - Kein `any`, kein `unknown`\n * - Explicit `null` statt `undefined` wenn nicht gefunden\n *\n * CLEAN CODE REGEL #3: Repository executes, Service orchestrates\n * - Keine if/else für Business Rules\n * - Keine Validierung von Input (macht Service)\n * - Nur reine Datenbank-Operationen\n *\n * PERFORMANCE OPTIMIERUNGEN:\n * - Nutzt alle DB-Indices (userId, language, createdAt, isPublic)\n * - Pagination verhindert Memory-Overflow\n * - Atomic Operations (incrementViewCount)\n * - Batch Queries wo möglich\n */\n@Injectable()\nexport class SnippetsRepository {\n  private readonly logger = new Logger(SnippetsRepository.name);\n\n  constructor(private readonly db: DatabaseService) {}\n\n  // ============================================================\n  // CREATE\n  // ============================================================\n\n  /**\n   * Erstellt neuen Snippet\n   *\n   * PERFORMANCE: Single INSERT, nutzt RETURNING\n   *\n   * @param data - Snippet-Daten (ohne id, timestamps)\n   * @returns Erstellter Snippet mit generierten Feldern\n   * @throws Database Error bei Constraint-Violation\n   */\n  async create(data: NewSnippet): Promise<Snippet> {\n    this.logger.debug(`Creating snippet: ${data.title}`);\n\n    const [snippet] = await this.db.drizzle\n      .insert(snippets)\n      .values(data)\n      .returning();\n\n    this.logger.log(`Snippet created: ${snippet.id}`);\n    return snippet;\n  }\n\n  // ============================================================\n  // READ - SINGLE\n  // ============================================================\n\n  /**\n   * Findet Snippet anhand der ID\n   *\n   * PERFORMANCE: Nutzt Primary Key Index (schnellste Query)\n   *\n   * @param id - Snippet UUID\n   * @returns Snippet oder null wenn nicht gefunden\n   */\n  async findById(id: string): Promise<Snippet | null> {\n    this.logger.debug(`Finding snippet by ID: ${id}`);\n\n    const snippet = await this.db.drizzle.query.snippets.findFirst({\n      where: eq(snippets.id, id),\n    });\n\n    return snippet ?? null;\n  }\n\n  // ============================================================\n  // READ - LISTS\n  // ============================================================\n\n  /**\n   * Findet alle Snippets eines Users\n   *\n   * PERFORMANCE: Nutzt snippets_user_id_idx\n   *\n   * @param userId - User UUID\n   * @param limit - Max Anzahl (default 20, max 100)\n   * @returns Liste von Snippets (sortiert nach createdAt DESC)\n   */\n  async findByUserId(userId: string, limit = 20): Promise<Snippet[]> {\n    this.logger.debug(`Finding snippets for user: ${userId}`);\n\n    return this.db.drizzle.query.snippets.findMany({\n      where: eq(snippets.userId, userId),\n      limit: Math.min(limit, 100),\n      orderBy: [desc(snippets.createdAt)],\n    });\n  }\n\n  /**\n   * Findet öffentliche Snippets (paginated)\n   *\n   * PERFORMANCE:\n   * - Nutzt snippets_public_created_at_idx (composite index)\n   * - Zwei Queries: Data + Count (parallel möglich)\n   * - Pagination verhindert Memory-Overflow\n   *\n   * @param page - Seite (1-indexed, default 1)\n   * @param limit - Items pro Seite (default 20, max 100)\n   * @returns Paginated Snippets\n   */\n  async findPublic(page = 1, limit = 20): Promise<PaginatedSnippets> {\n    this.logger.debug(\n      `Finding public snippets (page: ${page}, limit: ${limit})`,\n    );\n\n    const safeLimit = Math.min(limit, 100);\n    const offset = (page - 1) * safeLimit;\n\n    // Query 1: Data\n    const data = await this.db.drizzle.query.snippets.findMany({\n      where: eq(snippets.isPublic, true),\n      limit: safeLimit,\n      offset,\n      orderBy: [desc(snippets.createdAt)],\n    });\n\n    // Query 2: Count\n    const [{ total }] = await this.db.drizzle\n      .select({ total: count() })\n      .from(snippets)\n      .where(eq(snippets.isPublic, true));\n\n    return {\n      data,\n      meta: calculatePaginationMeta(total, page, safeLimit),\n    };\n  }\n\n  /**\n   * Findet öffentliche Snippet-Previews (OHNE Code)\n   *\n   * PERFORMANCE REGEL #3: Select only needed columns\n   * Spart ~50KB pro Snippet bei Listen-Ansichten!\n   *\n   * @param page - Seite\n   * @param limit - Items pro Seite\n   * @returns Paginated Previews\n   */\n  async findPublicPreviews(\n    page = 1,\n    limit = 20,\n  ): Promise<PaginatedSnippetPreviews> {\n    this.logger.debug(\n      `Finding public snippet previews (page: ${page}, limit: ${limit})`,\n    );\n    const safeLimit = Math.min(limit, 100);\n    const offset = (page - 1) * safeLimit;\n\n    // Query 1: Data (ohne code Feld!)\n    const data = await this.db.drizzle\n      .select({\n        id: snippets.id,\n        title: snippets.title,\n        description: snippets.description,\n        language: snippets.language,\n        userId: snippets.userId,\n        isPublic: snippets.isPublic,\n        viewCount: snippets.viewCount,\n        createdAt: snippets.createdAt,\n        updatedAt: snippets.updatedAt,\n      })\n      .from(snippets)\n      .where(eq(snippets.isPublic, true))\n      .limit(safeLimit)\n      .offset(offset)\n      .orderBy(desc(snippets.createdAt));\n\n    // Query 2: Count\n    const [{ total }] = await this.db.drizzle\n      .select({ total: count() })\n      .from(snippets)\n      .where(eq(snippets.isPublic, true));\n\n    return {\n      data,\n      meta: calculatePaginationMeta(total, page, safeLimit),\n    };\n  }\n\n  /**\n   * Findet Snippets nach Programmiersprache\n   *\n   * PERFORMANCE: Nutzt snippets_language_idx\n   *\n   * @param language - Programmiersprache (z.B. \"typescript\")\n   * @param limit - Max Anzahl\n   * @returns Liste von Snippets\n   */\n  async findByLanguage(language: string, limit = 20): Promise<Snippet[]> {\n    this.logger.debug(`Finding snippets by language: ${language}`);\n\n    return this.db.drizzle.query.snippets.findMany({\n      where: eq(snippets.language, language),\n      limit: Math.min(limit, 100),\n      orderBy: [desc(snippets.createdAt)],\n    });\n  }\n\n  /**\n   * Erweiterte Suche mit Filtern und Sortierung\n   *\n   * PERFORMANCE: Nutzt Indices basierend auf Filtern\n   *\n   * @param filters - Filter-Optionen\n   * @param sort - Sortier-Optionen (default: createdAt DESC)\n   * @param page - Seite\n   * @param limit - Items pro Seite\n   * @returns Paginated Snippets\n   */\n  async findWithFilters(\n    filters: SnippetFilters = {},\n    sort: SnippetSortOptions = DEFAULT_SORT,\n    page = 1,\n    limit = 20,\n  ): Promise<PaginatedSnippets> {\n    this.logger.debug('Finding snippets with filters', { filters, sort });\n\n    const safeLimit = Math.min(limit, 100);\n    const offset = (page - 1) * safeLimit;\n\n    // Build WHERE clause\n    const conditions = this.buildWhereConditions(filters);\n    const whereClause = conditions.length > 0 ? and(...conditions) : undefined;\n\n    // Build ORDER BY\n    const sortColumn = snippets[sort.sortBy];\n    const orderFn = sort.order === 'asc' ? asc : desc;\n\n    // Query 1: Data\n    const data = await this.db.drizzle.query.snippets.findMany({\n      where: whereClause,\n      limit: safeLimit,\n      offset,\n      orderBy: [orderFn(sortColumn)],\n    });\n\n    // Query 2: Count\n    const [{ total }] = await this.db.drizzle\n      .select({ total: count() })\n      .from(snippets)\n      .where(whereClause);\n\n    return {\n      data,\n      meta: calculatePaginationMeta(total, page, safeLimit),\n    };\n  }\n\n  // ============================================================\n  // UPDATE\n  // ============================================================\n\n  /**\n   * Aktualisiert Snippet-Daten\n   *\n   * WICHTIG: updatedAt wird automatisch gesetzt\n   *\n   * @param id - Snippet UUID\n   * @param data - Zu aktualisierende Felder\n   * @returns Aktualisierter Snippet oder null wenn nicht gefunden\n   */\n  async update(id: string, data: Partial<NewSnippet>): Promise<Snippet | null> {\n    this.logger.debug(`Updating snippet: ${id}`);\n\n    const [updatedSnippet] = await this.db.drizzle\n      .update(snippets)\n      .set({\n        ...data,\n        updatedAt: new Date(), // Timestamp immer aktualisieren\n      })\n      .where(eq(snippets.id, id))\n      .returning();\n\n    if (!updatedSnippet) {\n      this.logger.warn(`Snippet not found for update: ${id}`);\n      return null;\n    }\n\n    this.logger.log(`Snippet updated: ${id}`);\n    return updatedSnippet;\n  }\n\n  /**\n   * Erhöht View Count um 1 (Atomic Operation)\n   *\n   * PERFORMANCE: Atomic SQL Update (kein Race Condition)\n   *\n   * @param id - Snippet UUID\n   * @returns true wenn erfolgreich, false wenn nicht gefunden\n   */\n  async incrementViewCount(id: string): Promise<boolean> {\n    this.logger.debug(`Incrementing view count for snippet: ${id}`);\n\n    const result = await this.db.drizzle\n      .update(snippets)\n      .set({\n        viewCount: sql`${snippets.viewCount} + 1`,\n      })\n      .where(eq(snippets.id, id))\n      .returning({ id: snippets.id });\n\n    return result.length > 0;\n  }\n\n  // ============================================================\n  // DELETE\n  // ============================================================\n\n  /**\n   * Löscht Snippet (Hard Delete)\n   *\n   * HINWEIS: Soft Delete (isDeleted Flag) wäre in Production besser\n   *\n   * @param id - Snippet UUID\n   * @returns true wenn gelöscht, false wenn nicht gefunden\n   */\n  async delete(id: string): Promise<boolean> {\n    this.logger.debug(`Deleting snippet: ${id}`);\n\n    const result = await this.db.drizzle\n      .delete(snippets)\n      .where(eq(snippets.id, id))\n      .returning({ id: snippets.id });\n\n    if (result.length === 0) {\n      this.logger.warn(`Snippet not found for deletion: ${id}`);\n      return false;\n    }\n\n    this.logger.log(`Snippet deleted: ${id}`);\n    return true;\n  }\n\n  // ============================================================\n  // BATCH OPERATIONS\n  // ============================================================\n\n  /**\n   * Löscht alle Snippets eines Users (Batch Delete)\n   *\n   * VERWENDUNG: Bei User-Löschung (zusätzlich zu CASCADE)\n   *\n   * @param userId - User UUID\n   * @returns Anzahl gelöschter Snippets\n   */\n  async deleteByUserId(userId: string): Promise<number> {\n    this.logger.debug(`Deleting all snippets for user: ${userId}`);\n\n    const result = await this.db.drizzle\n      .delete(snippets)\n      .where(eq(snippets.userId, userId))\n      .returning({ id: snippets.id });\n\n    this.logger.log(`Deleted ${result.length} snippets for user: ${userId}`);\n    return result.length;\n  }\n\n  // ============================================================\n  // STATISTICS\n  // ============================================================\n\n  /**\n   * Zählt Snippets eines Users\n   *\n   * @param userId - User UUID\n   * @returns Anzahl der Snippets\n   */\n  async countByUserId(userId: string): Promise<number> {\n    const [{ total }] = await this.db.drizzle\n      .select({ total: count() })\n      .from(snippets)\n      .where(eq(snippets.userId, userId));\n\n    return total;\n  }\n\n  /**\n   * Zählt öffentliche Snippets\n   *\n   * @returns Anzahl öffentlicher Snippets\n   */\n  async countPublic(): Promise<number> {\n    const [{ total }] = await this.db.drizzle\n      .select({ total: count() })\n      .from(snippets)\n      .where(eq(snippets.isPublic, true));\n\n    return total;\n  }\n\n  /**\n   * Holt umfassende Statistiken für einen User\n   *\n   * PERFORMANCE: Single Query mit Aggregation\n   *\n   * @param userId - User UUID\n   * @returns Snippet Statistics\n   */\n  async getUserStats(userId: string): Promise<SnippetStats> {\n    this.logger.debug(`Getting stats for user: ${userId}`);\n\n    // Alle User-Snippets holen\n    const userSnippets = await this.db.drizzle.query.snippets.findMany({\n      where: eq(snippets.userId, userId),\n    });\n\n    // Statistiken berechnen\n    const total = userSnippets.length;\n    const publicCount = userSnippets.filter((s) => s.isPublic).length;\n    const privateCount = total - publicCount;\n    const totalViews = userSnippets.reduce((sum, s) => sum + s.viewCount, 0);\n\n    // Most viewed Snippet\n    const mostViewed = userSnippets.sort(\n      (a, b) => b.viewCount - a.viewCount,\n    )[0];\n\n    // Latest Snippet\n    const latestSnippet = userSnippets.sort(\n      (a, b) => b.createdAt.getTime() - a.createdAt.getTime(),\n    )[0];\n\n    return {\n      total,\n      public: publicCount,\n      private: privateCount,\n      totalViews,\n      mostViewed,\n      latestSnippet,\n    };\n  }\n\n  /**\n   * Holt Sprachen-Statistiken\n   *\n   * @param userId - Optional: Nur für einen User\n   * @returns Language Stats sortiert nach Count DESC\n   */\n  async getLanguageStats(\n    userId?: string,\n  ): Promise<Array<{ language: string; count: number }>> {\n    this.logger.debug(\n      `Getting language stats${userId ? ` for user: ${userId}` : ''}`,\n    );\n\n    const whereClause = userId ? eq(snippets.userId, userId) : undefined;\n\n    const result = await this.db.drizzle\n      .select({\n        language: snippets.language,\n        count: count(),\n      })\n      .from(snippets)\n      .where(whereClause)\n      .groupBy(snippets.language)\n      .orderBy(desc(count()));\n\n    return result;\n  }\n\n  // ============================================================\n  // PRIVATE HELPERS\n  // ============================================================\n\n  /**\n   * Baut WHERE Conditions aus Filtern\n   *\n   * @param filters - Filter-Optionen\n   * @returns Array von Drizzle Conditions\n   */\n  private buildWhereConditions(filters: SnippetFilters) {\n    const conditions = [];\n\n    if (filters.userId) {\n      conditions.push(eq(snippets.userId, filters.userId));\n    }\n\n    if (filters.language) {\n      conditions.push(eq(snippets.language, filters.language));\n    }\n\n    if (filters.isPublic !== undefined) {\n      conditions.push(eq(snippets.isPublic, filters.isPublic));\n    }\n\n    if (filters.search) {\n      // Simple text search (case-insensitive)\n      // TODO Sprint 2: Full-text search mit PostgreSQL ts_vector\n      const searchPattern = `%${filters.search}%`;\n      conditions.push(\n        or(\n          sql`LOWER(${snippets.title}) LIKE LOWER(${searchPattern})`,\n          sql`LOWER(${snippets.description}) LIKE LOWER(${searchPattern})`,\n        ),\n      );\n    }\n\n    if (filters.createdAfter) {\n      conditions.push(sql`${snippets.createdAt} >= ${filters.createdAfter}`);\n    }\n\n    if (filters.createdBefore) {\n      conditions.push(sql`${snippets.createdAt} <= ${filters.createdBefore}`);\n    }\n\n    return conditions;\n  }\n}\n"],"version":3}