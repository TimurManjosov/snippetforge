{"file":"/home/runner/work/snippetforge/snippetforge/apps/api/test/unit/repositories/users.repository.spec.ts","mappings":"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","names":[],"sources":["/home/runner/work/snippetforge/snippetforge/apps/api/test/unit/repositories/users.repository.spec.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/unbound-method */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n// test/unit/repositories/users.repository.spec.ts\n\nimport { Test, TestingModule } from '@nestjs/testing';\nimport type { NewUser, User } from '../../../src/lib/db/schema';\nimport { UsersRepository } from '../../../src/modules/users/users.repository';\nimport { DatabaseService } from '../../../src/shared/database';\n\ndescribe('UsersRepository', () => {\n  let repository: UsersRepository;\n  let mockDbService: Partial<DatabaseService>;\n\n  const mockUser: User = {\n    id: 'test-id-123',\n    email: 'test@example.com',\n    username: 'testuser',\n    passwordHash: 'hashed-password',\n    role: 'USER',\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    bio: null,\n    avatarUrl: null,\n  };\n\n  beforeEach(async () => {\n    mockDbService = {\n      drizzle: {\n        query: {\n          users: {\n            findFirst: jest.fn(),\n          },\n        },\n        insert: jest.fn().mockReturnValue({\n          values: jest.fn().mockReturnValue({\n            returning: jest.fn(),\n          }),\n        }),\n        update: jest.fn().mockReturnValue({\n          set: jest.fn().mockReturnValue({\n            where: jest.fn().mockReturnValue({\n              returning: jest.fn(),\n            }),\n          }),\n        }),\n        delete: jest.fn().mockReturnValue({\n          where: jest.fn().mockReturnValue({\n            returning: jest.fn(),\n          }),\n        }),\n        select: jest.fn().mockReturnValue({\n          from: jest.fn(),\n        }),\n      } as any,\n    };\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        UsersRepository,\n        {\n          provide: DatabaseService,\n          useValue: mockDbService,\n        },\n      ],\n    }).compile();\n\n    repository = module.get<UsersRepository>(UsersRepository);\n  });\n\n  describe('findById', () => {\n    it('should find user by ID', async () => {\n      (\n        mockDbService.drizzle!.query.users.findFirst as jest.Mock\n      ).mockResolvedValue(mockUser);\n\n      const result = await repository.findById('test-id-123');\n\n      expect(result).toEqual(mockUser);\n    });\n\n    it('should return null when user not found', async () => {\n      (\n        mockDbService.drizzle!.query.users.findFirst as jest.Mock\n      ).mockResolvedValue(undefined);\n\n      const result = await repository.findById('non-existent-id');\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('findByEmail', () => {\n    it('should find user by email', async () => {\n      (\n        mockDbService.drizzle!.query.users.findFirst as jest.Mock\n      ).mockResolvedValue(mockUser);\n\n      const result = await repository.findByEmail('test@example.com');\n\n      expect(result).toEqual(mockUser);\n    });\n\n    it('should return null when email not found', async () => {\n      (\n        mockDbService.drizzle!.query.users.findFirst as jest.Mock\n      ).mockResolvedValue(undefined);\n\n      const result = await repository.findByEmail('nonexistent@example.com');\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('findByUsername', () => {\n    it('should find user by username', async () => {\n      (\n        mockDbService.drizzle!.query.users.findFirst as jest.Mock\n      ).mockResolvedValue(mockUser);\n\n      const result = await repository.findByUsername('testuser');\n\n      expect(result).toEqual(mockUser);\n    });\n\n    it('should return null when username not found', async () => {\n      (\n        mockDbService.drizzle!.query.users.findFirst as jest.Mock\n      ).mockResolvedValue(undefined);\n\n      const result = await repository.findByUsername('nonexistent');\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('findByEmailOrUsername', () => {\n    it('should find user by email or username', async () => {\n      (\n        mockDbService.drizzle!.query.users.findFirst as jest.Mock\n      ).mockResolvedValue(mockUser);\n\n      const result = await repository.findByEmailOrUsername(\n        'test@example.com',\n        'testuser',\n      );\n\n      expect(result).toEqual(mockUser);\n    });\n\n    it('should return null when neither exists', async () => {\n      (\n        mockDbService.drizzle!.query.users.findFirst as jest.Mock\n      ).mockResolvedValue(undefined);\n\n      const result = await repository.findByEmailOrUsername(\n        'new@example.com',\n        'newuser',\n      );\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('create', () => {\n    it('should create new user', async () => {\n      const newUserData: NewUser = {\n        email: 'new@example.com',\n        username: 'newuser',\n        passwordHash: 'hashed',\n        role: 'USER',\n      };\n\n      const insertMock = mockDbService.drizzle!.insert as jest.Mock;\n      const valuesMock = jest.fn().mockReturnValue({\n        returning: jest.fn().mockResolvedValue([mockUser]),\n      });\n      insertMock.mockReturnValue({\n        values: valuesMock,\n      });\n\n      const result = await repository.create(newUserData);\n\n      expect(result).toEqual(mockUser);\n      expect(valuesMock).toHaveBeenCalledWith(\n        expect.objectContaining({\n          email: 'new@example.com',\n        }),\n      );\n    });\n  });\n\n  describe('update', () => {\n    it('should update user successfully', async () => {\n      const updateData = { username: 'updateduser' };\n\n      const updateMock = mockDbService.drizzle!.update as jest.Mock;\n      const setMock = jest.fn().mockReturnValue({\n        where: jest.fn().mockReturnValue({\n          returning: jest\n            .fn()\n            .mockResolvedValue([{ ...mockUser, ...updateData }]),\n        }),\n      });\n      updateMock.mockReturnValue({\n        set: setMock,\n      });\n\n      const result = await repository.update('test-id-123', updateData);\n\n      expect(result).toBeDefined();\n      expect(result?.username).toBe('updateduser');\n    });\n\n    it('should return null when user not found', async () => {\n      const updateMock = mockDbService.drizzle!.update as jest.Mock;\n      const setMock = jest.fn().mockReturnValue({\n        where: jest.fn().mockReturnValue({\n          returning: jest.fn().mockResolvedValue([]),\n        }),\n      });\n      updateMock.mockReturnValue({\n        set: setMock,\n      });\n\n      const result = await repository.update('non-existent-id', {\n        username: 'test',\n      });\n\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('updatePassword', () => {\n    it('should update password successfully', async () => {\n      const updateMock = mockDbService.drizzle!.update as jest.Mock;\n      const setMock = jest.fn().mockReturnValue({\n        where: jest.fn().mockReturnValue({\n          returning: jest.fn().mockResolvedValue([{ id: 'test-id-123' }]),\n        }),\n      });\n      updateMock.mockReturnValue({\n        set: setMock,\n      });\n\n      const result = await repository.updatePassword('test-id-123', 'new-hash');\n\n      expect(result).toBe(true);\n    });\n\n    it('should return false when user not found', async () => {\n      const updateMock = mockDbService.drizzle!.update as jest.Mock;\n      const setMock = jest.fn().mockReturnValue({\n        where: jest.fn().mockReturnValue({\n          returning: jest.fn().mockResolvedValue([]),\n        }),\n      });\n      updateMock.mockReturnValue({\n        set: setMock,\n      });\n\n      const result = await repository.updatePassword(\n        'non-existent-id',\n        'new-hash',\n      );\n\n      expect(result).toBe(false);\n    });\n  });\n\n  describe('delete', () => {\n    it('should delete user successfully', async () => {\n      const deleteMock = mockDbService.drizzle!.delete as jest.Mock;\n      deleteMock.mockReturnValue({\n        where: jest.fn().mockReturnValue({\n          returning: jest.fn().mockResolvedValue([{ id: 'test-id-123' }]),\n        }),\n      });\n\n      const result = await repository.delete('test-id-123');\n\n      expect(result).toBe(true);\n    });\n\n    it('should return false when user not found', async () => {\n      const deleteMock = mockDbService.drizzle!.delete as jest.Mock;\n      deleteMock.mockReturnValue({\n        where: jest.fn().mockReturnValue({\n          returning: jest.fn().mockResolvedValue([]),\n        }),\n      });\n\n      const result = await repository.delete('non-existent-id');\n\n      expect(result).toBe(false);\n    });\n  });\n\n  describe('count', () => {\n    it('should return count of users', async () => {\n      const selectMock = mockDbService.drizzle!.select as jest.Mock;\n      selectMock.mockReturnValue({\n        from: jest\n          .fn()\n          .mockResolvedValue([\n            { count: 'user1' },\n            { count: 'user2' },\n            { count: 'user3' },\n          ]),\n      });\n\n      const result = await repository.count();\n\n      expect(result).toBe(3);\n    });\n  });\n});\n"],"version":3}