{"file":"/home/runner/work/snippetforge/snippetforge/apps/api/test/setup/test-utils.ts","mappings":"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","names":[],"sources":["/home/runner/work/snippetforge/snippetforge/apps/api/test/setup/test-utils.ts"],"sourcesContent":["// test/setup/test-utils.ts\n\nimport { INestApplication, ModuleMetadata, Type } from '@nestjs/common';\nimport { Test, TestingModule } from '@nestjs/testing';\nimport {\n  AllExceptionsFilter,\n  HttpExceptionFilter,\n} from '../../src/shared/filters';\n\n/**\n * Test Utilities\n *\n * Wiederverwendbare Funktionen für Tests.\n * Reduziert Boilerplate und sorgt für Konsistenz.\n */\n\n/**\n * Erstellt ein NestJS Testing Module mit Standard-Konfiguration\n *\n * @param metadata - Module Metadata (providers, imports, etc.)\n * @returns Kompiliertes Test-Module\n */\nexport async function createTestingModule(\n  metadata: ModuleMetadata,\n): Promise<TestingModule> {\n  return Test.createTestingModule(metadata).compile();\n}\n\n/**\n * Erstellt eine vollständige NestJS Test-Application\n * Verwendet für E2E Tests\n *\n * @param moduleType - Das zu testende Module\n * @returns Initialisierte Nest Application\n */\nexport async function createTestingApp(\n  moduleType: Type<unknown>,\n): Promise<INestApplication> {\n  const moduleFixture = await Test.createTestingModule({\n    imports: [moduleType],\n  }).compile();\n\n  const app = moduleFixture.createNestApplication();\n\n  // Gleiche Konfiguration wie Production\n  app.setGlobalPrefix('api');\n  app.useGlobalFilters(new AllExceptionsFilter(), new HttpExceptionFilter());\n\n  await app.init();\n  return app;\n}\n\n/**\n * Wartet eine bestimmte Zeit (für async Tests)\n */\nexport function delay(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\n/**\n * Generiert eine zufällige Email für Tests\n * Verhindert Konflikte bei parallelen Tests\n */\nexport function randomEmail(): string {\n  const timestamp = Date.now();\n  const random = Math.random().toString(36).substring(2, 8);\n  return `test-${timestamp}-${random}@test.com`;\n}\n\n/**\n * Generiert einen zufälligen Username für Tests\n */\nexport function randomUsername(): string {\n  const timestamp = Date.now();\n  const random = Math.random().toString(36).substring(2, 8);\n  return `user_${timestamp}_${random}`.substring(0, 30);\n}\n\n/**\n * Mock Request Object für Filter/Guard Tests\n */\nexport function createMockRequest(\n  overrides: Partial<{\n    url: string;\n    method: string;\n    headers: Record<string, string>;\n    user: unknown;\n  }> = {},\n) {\n  return {\n    url: '/api/test',\n    method: 'GET',\n    headers: {},\n    user: undefined,\n    ...overrides,\n  };\n}\n\n/**\n * Mock Response Object für Filter Tests\n */\nexport function createMockResponse() {\n  const response = {\n    status: jest.fn().mockReturnThis(),\n    json: jest.fn().mockReturnThis(),\n    send: jest.fn().mockReturnThis(),\n  };\n  return response;\n}\n\n/**\n * Mock Execution Context für Guards\n */\nexport function createMockExecutionContext(\n  overrides: {\n    request?: Partial<{ user: unknown; headers: Record<string, string> }>;\n    handler?: unknown;\n    class?: unknown;\n  } = {},\n) {\n  const mockRequest = {\n    user: undefined,\n    headers: {},\n    ...overrides.request,\n  };\n\n  return {\n    switchToHttp: () => ({\n      getRequest: () => mockRequest,\n      getResponse: () => createMockResponse(),\n    }),\n    getHandler: () => overrides.handler || jest.fn(),\n    getClass: () => overrides.class || class TestController {},\n  };\n}\n\n/**\n * Mock ArgumentsHost für Filters\n */\nexport function createMockArgumentsHost(\n  request = createMockRequest(),\n  response = createMockResponse(),\n) {\n  return {\n    switchToHttp: () => ({\n      getRequest: () => request,\n      getResponse: () => response,\n    }),\n    getArgs: () => [],\n    getArgByIndex: () => undefined,\n    switchToRpc: () => ({ getData: () => undefined }),\n    switchToWs: () => ({ getData: () => undefined }),\n    getType: () => 'http' as const,\n  };\n}\n"],"version":3}