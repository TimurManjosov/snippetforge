{"file":"/home/runner/work/snippetforge/snippetforge/apps/api/test/unit/services/users.service.spec.ts","mappings":"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","names":[],"sources":["/home/runner/work/snippetforge/snippetforge/apps/api/test/unit/services/users.service.spec.ts"],"sourcesContent":["// test/unit/services/users.service.spec.ts\n\nimport { ConflictException, NotFoundException } from '@nestjs/common';\nimport { Test, TestingModule } from '@nestjs/testing';\nimport * as bcrypt from 'bcryptjs';\nimport { UsersRepository } from '../../../src/modules/users/users.repository';\nimport { UsersService } from '../../../src/modules/users/users.service';\nimport { createUserDto } from '../../factories';\nimport {\n  createMockFullUser,\n  createMockUsersRepository,\n  type MockUsersRepository,\n} from '../../mocks';\n\n// Mock bcrypt\njest.mock('bcryptjs', () => ({\n  hash: jest.fn().mockResolvedValue('$2a$10$hashedPassword'),\n  compare: jest.fn().mockResolvedValue(true),\n}));\n\n/**\n * UsersService Unit Tests\n *\n * Testet:\n * - User CRUD Operationen\n * - Password Hashing\n * - Credential Validation\n * - Error Handling\n */\ndescribe('UsersService', () => {\n  let service: UsersService;\n  let repository: MockUsersRepository;\n\n  beforeEach(async () => {\n    repository = createMockUsersRepository();\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        UsersService,\n        {\n          provide: UsersRepository,\n          useValue: repository,\n        },\n      ],\n    }).compile();\n\n    service = module.get<UsersService>(UsersService);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  // ============================================================\n  // PASSWORD HASHING\n  // ============================================================\n\n  describe('hashPassword', () => {\n    it('should hash password with bcrypt', async () => {\n      // Arrange\n      const password = 'SecurePass123';\n\n      // Act\n      const result = await service.hashPassword(password);\n\n      // Assert\n      expect(bcrypt.hash).toHaveBeenCalledWith(password, 10);\n      expect(result).toBe('$2a$10$hashedPassword');\n    });\n  });\n\n  describe('comparePassword', () => {\n    it('should return true when passwords match', async () => {\n      // Arrange\n      (bcrypt.compare as jest.Mock).mockResolvedValue(true);\n\n      // Act\n      const result = await service.comparePassword('password', 'hash');\n\n      // Assert\n      expect(result).toBe(true);\n      expect(bcrypt.compare).toHaveBeenCalledWith('password', 'hash');\n    });\n\n    it('should return false when passwords do not match', async () => {\n      // Arrange\n      (bcrypt.compare as jest.Mock).mockResolvedValue(false);\n\n      // Act\n      const result = await service.comparePassword('wrong', 'hash');\n\n      // Assert\n      expect(result).toBe(false);\n    });\n  });\n\n  // ============================================================\n  // CREATE\n  // ============================================================\n\n  describe('create', () => {\n    it('should create a new user successfully', async () => {\n      // Arrange\n      const dto = createUserDto();\n      const mockCreatedUser = createMockFullUser({\n        email: dto.email,\n        username: dto.username,\n      });\n\n      repository.findByEmailOrUsername.mockResolvedValue(null);\n      repository.create.mockResolvedValue(mockCreatedUser);\n\n      // Act\n      const result = await service.create(dto);\n\n      // Assert\n      expect(repository.findByEmailOrUsername).toHaveBeenCalledWith(\n        dto.email,\n        dto.username,\n      );\n      expect(repository.create).toHaveBeenCalledWith(\n        expect.objectContaining({\n          email: dto.email,\n          username: dto.username,\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n          passwordHash: expect.any(String),\n        }),\n      );\n      expect(result.email).toBe(dto.email);\n      expect(result.username).toBe(dto.username);\n      expect(result).not.toHaveProperty('passwordHash');\n    });\n\n    it('should throw ConflictException when email exists', async () => {\n      // Arrange\n      const dto = createUserDto();\n      const existingUser = createMockFullUser({\n        email: dto.email.toLowerCase(),\n      });\n      repository.findByEmailOrUsername.mockResolvedValue(existingUser);\n\n      // Act & Assert\n      await expect(service.create(dto)).rejects.toThrow(ConflictException);\n      await expect(service.create(dto)).rejects.toThrow(\n        'Email is already registered',\n      );\n    });\n\n    it('should throw ConflictException when username exists', async () => {\n      // Arrange\n      const dto = createUserDto();\n      const existingUser = createMockFullUser({\n        email: 'other@email.com',\n        username: dto.username,\n      });\n      repository.findByEmailOrUsername.mockResolvedValue(existingUser);\n\n      // Act & Assert\n      await expect(service.create(dto)).rejects.toThrow(ConflictException);\n      await expect(service.create(dto)).rejects.toThrow(\n        'Username is already taken',\n      );\n    });\n\n    it('should hash password before storing', async () => {\n      // Arrange\n      const dto = createUserDto({ password: 'MyPassword123' });\n      repository.findByEmailOrUsername.mockResolvedValue(null);\n      repository.create.mockResolvedValue(createMockFullUser());\n\n      // Act\n      await service.create(dto);\n\n      // Assert\n      expect(bcrypt.hash).toHaveBeenCalledWith('MyPassword123', 10);\n      expect(repository.create).toHaveBeenCalledWith(\n        expect.objectContaining({\n          passwordHash: '$2a$10$hashedPassword',\n        }),\n      );\n    });\n  });\n\n  // ============================================================\n  // FIND BY ID\n  // ============================================================\n\n  describe('findById', () => {\n    it('should return SafeUser when found', async () => {\n      // Arrange\n      const mockUser = createMockFullUser();\n      repository.findById.mockResolvedValue(mockUser);\n\n      // Act\n      const result = await service.findById('test-id');\n\n      // Assert\n      expect(repository.findById).toHaveBeenCalledWith('test-id');\n      expect(result.id).toBe(mockUser.id);\n      expect(result).not.toHaveProperty('passwordHash');\n    });\n\n    it('should throw NotFoundException when not found', async () => {\n      // Arrange\n      repository.findById.mockResolvedValue(null);\n\n      // Act & Assert\n      await expect(service.findById('nonexistent')).rejects.toThrow(\n        NotFoundException,\n      );\n    });\n  });\n\n  // ============================================================\n  // FIND BY EMAIL\n  // ============================================================\n\n  describe('findByEmail', () => {\n    it('should return SafeUser when found', async () => {\n      // Arrange\n      const mockUser = createMockFullUser({ email: 'test@test.com' });\n      repository.findByEmail.mockResolvedValue(mockUser);\n\n      // Act\n      const result = await service.findByEmail('test@test.com');\n\n      // Assert\n      expect(result.email).toBe('test@test.com');\n      expect(result).not.toHaveProperty('passwordHash');\n    });\n\n    it('should throw NotFoundException when not found', async () => {\n      // Arrange\n      repository.findByEmail.mockResolvedValue(null);\n\n      // Act & Assert\n      await expect(service.findByEmail('nonexistent@test.com')).rejects.toThrow(\n        NotFoundException,\n      );\n    });\n  });\n\n  describe('findByEmailWithPassword', () => {\n    it('should return FullUser with passwordHash when found', async () => {\n      // Arrange\n      const mockUser = createMockFullUser();\n      repository.findByEmail.mockResolvedValue(mockUser);\n\n      // Act\n      const result = await service.findByEmailWithPassword('test@test. com');\n\n      // Assert\n      expect(result).not.toBeNull();\n      expect(result!.passwordHash).toBeDefined();\n    });\n\n    it('should return null when not found', async () => {\n      // Arrange\n      repository.findByEmail.mockResolvedValue(null);\n\n      // Act\n      const result = await service.findByEmailWithPassword(\n        'nonexistent@test.com',\n      );\n\n      // Assert\n      expect(result).toBeNull();\n    });\n  });\n\n  // ============================================================\n  // VALIDATE CREDENTIALS\n  // ============================================================\n\n  describe('validateCredentials', () => {\n    it('should return SafeUser when credentials are valid', async () => {\n      // Arrange\n      const mockUser = createMockFullUser();\n      (bcrypt.compare as jest.Mock).mockResolvedValue(true);\n      repository.findByEmail.mockResolvedValue(mockUser);\n\n      // Act\n      const result = await service.validateCredentials(\n        'test@test.com',\n        'password',\n      );\n\n      // Assert\n      expect(result).not.toBeNull();\n      expect(result!.email).toBe(mockUser.email);\n      expect(result).not.toHaveProperty('passwordHash');\n    });\n\n    it('should return null when user not found', async () => {\n      // Arrange\n      repository.findByEmail.mockResolvedValue(null);\n\n      // Act\n      const result = await service.validateCredentials(\n        'nonexistent@test.com',\n        'password',\n      );\n\n      // Assert\n      expect(result).toBeNull();\n    });\n\n    it('should return null when password is incorrect', async () => {\n      // Arrange\n      const mockUser = createMockFullUser();\n      (bcrypt.compare as jest.Mock).mockResolvedValue(false);\n      repository.findByEmail.mockResolvedValue(mockUser);\n\n      // Act\n      const result = await service.validateCredentials(\n        'test@test.com',\n        'wrong',\n      );\n\n      // Assert\n      expect(result).toBeNull();\n    });\n\n    it('should perform timing-safe check even when user not found', async () => {\n      // Arrange\n      repository.findByEmail.mockResolvedValue(null);\n\n      // Act\n      await service.validateCredentials('nonexistent@test.com', 'password');\n\n      // Assert\n      // comparePassword sollte aufgerufen werden um Timing-Attacks zu verhindern\n      expect(bcrypt.compare).toHaveBeenCalled();\n    });\n  });\n\n  // ============================================================\n  // UPDATE\n  // ============================================================\n\n  describe('update', () => {\n    it('should update user successfully', async () => {\n      // Arrange\n      const mockUser = createMockFullUser();\n      const updateData = { bio: 'New bio' };\n      const updatedUser = { ...mockUser, ...updateData };\n\n      repository.findById.mockResolvedValue(mockUser);\n      repository.update.mockResolvedValue(updatedUser);\n\n      // Act\n      const result = await service.update('test-id', updateData);\n\n      // Assert\n      expect(result.bio).toBe('New bio');\n    });\n\n    it('should throw NotFoundException when user not found', async () => {\n      // Arrange\n      repository.findById.mockResolvedValue(null);\n\n      // Act & Assert\n      await expect(\n        service.update('nonexistent', { bio: 'New' }),\n      ).rejects.toThrow(NotFoundException);\n    });\n  });\n\n  // ============================================================\n  // CHANGE PASSWORD\n  // ============================================================\n\n  describe('changePassword', () => {\n    it('should change password successfully', async () => {\n      // Arrange\n      const mockUser = createMockFullUser();\n      (bcrypt.compare as jest.Mock).mockResolvedValue(true);\n      repository.findById.mockResolvedValue(mockUser);\n      repository.updatePassword.mockResolvedValue(true);\n\n      // Act\n      const result = await service.changePassword(\n        'test-id',\n        'oldPass',\n        'newPass',\n      );\n\n      // Assert\n      expect(result).toBe(true);\n      expect(repository.updatePassword).toHaveBeenCalled();\n    });\n\n    it('should throw NotFoundException when user not found', async () => {\n      // Arrange\n      repository.findById.mockResolvedValue(null);\n\n      // Act & Assert\n      await expect(\n        service.changePassword('nonexistent', 'old', 'new'),\n      ).rejects.toThrow(NotFoundException);\n    });\n\n    it('should throw ConflictException when current password is wrong', async () => {\n      // Arrange\n      const mockUser = createMockFullUser();\n      (bcrypt.compare as jest.Mock).mockResolvedValue(false);\n      repository.findById.mockResolvedValue(mockUser);\n\n      // Act & Assert\n      await expect(\n        service.changePassword('test-id', 'wrongPassword', 'newPass'),\n      ).rejects.toThrow(ConflictException);\n    });\n  });\n\n  // ============================================================\n  // DELETE\n  // ============================================================\n\n  describe('delete', () => {\n    it('should delete user successfully', async () => {\n      // Arrange\n      repository.delete.mockResolvedValue(true);\n\n      // Act\n      const result = await service.delete('test-id');\n\n      // Assert\n      expect(result).toBe(true);\n      expect(repository.delete).toHaveBeenCalledWith('test-id');\n    });\n\n    it('should throw NotFoundException when user not found', async () => {\n      // Arrange\n      repository.delete.mockResolvedValue(false);\n\n      // Act & Assert\n      await expect(service.delete('nonexistent')).rejects.toThrow(\n        NotFoundException,\n      );\n    });\n  });\n});\n"],"version":3}