b29747b9b6c64e69b088aef765af7d8d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const current_user_decorator_1 = require("../../../src/modules/auth/decorators/current-user.decorator");
const test_utils_1 = require("../../setup/test-utils");
describe('CurrentUser decorator', () => {
    it('returns undefined when no user is present', () => {
        const ctx = (0, test_utils_1.createMockExecutionContext)();
        const result = (0, current_user_decorator_1.currentUserFactory)(undefined, ctx);
        expect(result).toBeUndefined();
    });
    it('returns full user when no property is requested', () => {
        const user = {
            id: 'user-1',
            email: 'user@example.com',
            username: 'tester',
        };
        const ctx = (0, test_utils_1.createMockExecutionContext)({ request: { user } });
        const result = (0, current_user_decorator_1.currentUserFactory)(undefined, ctx);
        expect(result).toEqual(user);
    });
    it('returns a single property when key is provided', () => {
        const user = {
            id: 'user-2',
            email: 'user2@example.com',
            username: 'tester2',
        };
        const ctx = (0, test_utils_1.createMockExecutionContext)({ request: { user } });
        const result = (0, current_user_decorator_1.currentUserFactory)('email', ctx);
        expect(result).toBe(user.email);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc25pcHBldGZvcmdlL3NuaXBwZXRmb3JnZS9hcHBzL2FwaS90ZXN0L3VuaXQvZGVjb3JhdG9ycy9jdXJyZW50LXVzZXIuZGVjb3JhdG9yLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFDQSx3R0FBaUc7QUFDakcsdURBQW9FO0FBRXBFLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDckMsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEdBQUcsRUFBRTtRQUNuRCxNQUFNLEdBQUcsR0FBRyxJQUFBLHVDQUEwQixHQUFFLENBQUM7UUFFekMsTUFBTSxNQUFNLEdBQUcsSUFBQSwyQ0FBa0IsRUFDL0IsU0FBUyxFQUNULEdBQWtDLENBQ25DLENBQUM7UUFFRixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDakMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsaURBQWlELEVBQUUsR0FBRyxFQUFFO1FBQ3pELE1BQU0sSUFBSSxHQUFHO1lBQ1gsRUFBRSxFQUFFLFFBQVE7WUFDWixLQUFLLEVBQUUsa0JBQWtCO1lBQ3pCLFFBQVEsRUFBRSxRQUFRO1NBQ25CLENBQUM7UUFDRixNQUFNLEdBQUcsR0FBRyxJQUFBLHVDQUEwQixFQUFDLEVBQUUsT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRTlELE1BQU0sTUFBTSxHQUFHLElBQUEsMkNBQWtCLEVBQy9CLFNBQVMsRUFDVCxHQUFrQyxDQUNuQyxDQUFDO1FBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvQixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7UUFDeEQsTUFBTSxJQUFJLEdBQUc7WUFDWCxFQUFFLEVBQUUsUUFBUTtZQUNaLEtBQUssRUFBRSxtQkFBbUI7WUFDMUIsUUFBUSxFQUFFLFNBQVM7U0FDcEIsQ0FBQztRQUNGLE1BQU0sR0FBRyxHQUFHLElBQUEsdUNBQTBCLEVBQUMsRUFBRSxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFOUQsTUFBTSxNQUFNLEdBQUcsSUFBQSwyQ0FBa0IsRUFDL0IsT0FBTyxFQUNQLEdBQWtDLENBQ25DLENBQUM7UUFFRixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3NuaXBwZXRmb3JnZS9zbmlwcGV0Zm9yZ2UvYXBwcy9hcGkvdGVzdC91bml0L2RlY29yYXRvcnMvY3VycmVudC11c2VyLmRlY29yYXRvci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHR5cGUgRXhlY3V0aW9uQ29udGV4dCB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IGN1cnJlbnRVc2VyRmFjdG9yeSB9IGZyb20gJy4uLy4uLy4uL3NyYy9tb2R1bGVzL2F1dGgvZGVjb3JhdG9ycy9jdXJyZW50LXVzZXIuZGVjb3JhdG9yJztcbmltcG9ydCB7IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0IH0gZnJvbSAnLi4vLi4vc2V0dXAvdGVzdC11dGlscyc7XG5cbmRlc2NyaWJlKCdDdXJyZW50VXNlciBkZWNvcmF0b3InLCAoKSA9PiB7XG4gIGl0KCdyZXR1cm5zIHVuZGVmaW5lZCB3aGVuIG5vIHVzZXIgaXMgcHJlc2VudCcsICgpID0+IHtcbiAgICBjb25zdCBjdHggPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dCgpO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gY3VycmVudFVzZXJGYWN0b3J5KFxuICAgICAgdW5kZWZpbmVkLFxuICAgICAgY3R4IGFzIHVua25vd24gYXMgRXhlY3V0aW9uQ29udGV4dCxcbiAgICApO1xuXG4gICAgZXhwZWN0KHJlc3VsdCkudG9CZVVuZGVmaW5lZCgpO1xuICB9KTtcblxuICBpdCgncmV0dXJucyBmdWxsIHVzZXIgd2hlbiBubyBwcm9wZXJ0eSBpcyByZXF1ZXN0ZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHtcbiAgICAgIGlkOiAndXNlci0xJyxcbiAgICAgIGVtYWlsOiAndXNlckBleGFtcGxlLmNvbScsXG4gICAgICB1c2VybmFtZTogJ3Rlc3RlcicsXG4gICAgfTtcbiAgICBjb25zdCBjdHggPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dCh7IHJlcXVlc3Q6IHsgdXNlciB9IH0pO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gY3VycmVudFVzZXJGYWN0b3J5KFxuICAgICAgdW5kZWZpbmVkLFxuICAgICAgY3R4IGFzIHVua25vd24gYXMgRXhlY3V0aW9uQ29udGV4dCxcbiAgICApO1xuXG4gICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh1c2VyKTtcbiAgfSk7XG5cbiAgaXQoJ3JldHVybnMgYSBzaW5nbGUgcHJvcGVydHkgd2hlbiBrZXkgaXMgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHtcbiAgICAgIGlkOiAndXNlci0yJyxcbiAgICAgIGVtYWlsOiAndXNlcjJAZXhhbXBsZS5jb20nLFxuICAgICAgdXNlcm5hbWU6ICd0ZXN0ZXIyJyxcbiAgICB9O1xuICAgIGNvbnN0IGN0eCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KHsgcmVxdWVzdDogeyB1c2VyIH0gfSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBjdXJyZW50VXNlckZhY3RvcnkoXG4gICAgICAnZW1haWwnLFxuICAgICAgY3R4IGFzIHVua25vd24gYXMgRXhlY3V0aW9uQ29udGV4dCxcbiAgICApO1xuXG4gICAgZXhwZWN0KHJlc3VsdCkudG9CZSh1c2VyLmVtYWlsKTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==